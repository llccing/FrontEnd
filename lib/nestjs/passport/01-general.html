<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>[译]Passport 文档（一）入门 | Rowan Liu&#39;s Tech</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="just do it! ">
    
    <link rel="preload" href="/FrontEnd/assets/css/0.styles.4f2b0bb5.css" as="style"><link rel="preload" href="/FrontEnd/assets/js/app.f790006c.js" as="script"><link rel="preload" href="/FrontEnd/assets/js/2.3f4cbde9.js" as="script"><link rel="preload" href="/FrontEnd/assets/js/1.4a225f88.js" as="script"><link rel="preload" href="/FrontEnd/assets/js/237.273f32ea.js" as="script"><link rel="prefetch" href="/FrontEnd/assets/js/10.37cbd0cd.js"><link rel="prefetch" href="/FrontEnd/assets/js/100.8aa0c2e6.js"><link rel="prefetch" href="/FrontEnd/assets/js/101.522a5347.js"><link rel="prefetch" href="/FrontEnd/assets/js/102.76f68794.js"><link rel="prefetch" href="/FrontEnd/assets/js/103.b4ed2c0c.js"><link rel="prefetch" href="/FrontEnd/assets/js/104.beeff9c2.js"><link rel="prefetch" href="/FrontEnd/assets/js/105.a25be904.js"><link rel="prefetch" href="/FrontEnd/assets/js/106.fb901230.js"><link rel="prefetch" href="/FrontEnd/assets/js/107.2f4bd122.js"><link rel="prefetch" href="/FrontEnd/assets/js/108.5a1765e3.js"><link rel="prefetch" href="/FrontEnd/assets/js/109.a51336f0.js"><link rel="prefetch" href="/FrontEnd/assets/js/11.affb9d79.js"><link rel="prefetch" href="/FrontEnd/assets/js/110.eeec5ff2.js"><link rel="prefetch" href="/FrontEnd/assets/js/111.5422ec68.js"><link rel="prefetch" href="/FrontEnd/assets/js/112.46b943db.js"><link rel="prefetch" href="/FrontEnd/assets/js/113.70509f0f.js"><link rel="prefetch" href="/FrontEnd/assets/js/114.1e297f32.js"><link rel="prefetch" href="/FrontEnd/assets/js/115.5b7368b0.js"><link rel="prefetch" href="/FrontEnd/assets/js/116.959b5570.js"><link rel="prefetch" href="/FrontEnd/assets/js/117.981e1c8e.js"><link rel="prefetch" href="/FrontEnd/assets/js/118.d74fc728.js"><link rel="prefetch" href="/FrontEnd/assets/js/119.de7922aa.js"><link rel="prefetch" href="/FrontEnd/assets/js/12.c0038159.js"><link rel="prefetch" href="/FrontEnd/assets/js/120.5a88aa7a.js"><link rel="prefetch" href="/FrontEnd/assets/js/121.66983f93.js"><link rel="prefetch" href="/FrontEnd/assets/js/122.d5c2ec96.js"><link rel="prefetch" href="/FrontEnd/assets/js/123.9b1e1a7c.js"><link rel="prefetch" href="/FrontEnd/assets/js/124.332f1aac.js"><link rel="prefetch" href="/FrontEnd/assets/js/125.a10adf2c.js"><link rel="prefetch" href="/FrontEnd/assets/js/126.e2c31401.js"><link rel="prefetch" href="/FrontEnd/assets/js/127.31460a04.js"><link rel="prefetch" href="/FrontEnd/assets/js/128.026d3b74.js"><link rel="prefetch" href="/FrontEnd/assets/js/129.7e6bcb1f.js"><link rel="prefetch" href="/FrontEnd/assets/js/13.f55291aa.js"><link rel="prefetch" href="/FrontEnd/assets/js/130.3cd05573.js"><link rel="prefetch" href="/FrontEnd/assets/js/131.fb0af78e.js"><link rel="prefetch" href="/FrontEnd/assets/js/132.812fa21b.js"><link rel="prefetch" href="/FrontEnd/assets/js/133.bb6ebd86.js"><link rel="prefetch" href="/FrontEnd/assets/js/134.f12707a6.js"><link rel="prefetch" href="/FrontEnd/assets/js/135.e91178e0.js"><link rel="prefetch" href="/FrontEnd/assets/js/136.9711020d.js"><link rel="prefetch" href="/FrontEnd/assets/js/137.44016517.js"><link rel="prefetch" href="/FrontEnd/assets/js/138.70df5afa.js"><link rel="prefetch" href="/FrontEnd/assets/js/139.1a512993.js"><link rel="prefetch" href="/FrontEnd/assets/js/14.c74ee963.js"><link rel="prefetch" href="/FrontEnd/assets/js/140.94a404ac.js"><link rel="prefetch" href="/FrontEnd/assets/js/141.0a7e62f6.js"><link rel="prefetch" href="/FrontEnd/assets/js/142.28969d1c.js"><link rel="prefetch" href="/FrontEnd/assets/js/143.4b1cc58d.js"><link rel="prefetch" href="/FrontEnd/assets/js/144.8c4773f7.js"><link rel="prefetch" href="/FrontEnd/assets/js/145.6537e88f.js"><link rel="prefetch" href="/FrontEnd/assets/js/146.2774e299.js"><link rel="prefetch" href="/FrontEnd/assets/js/147.4a0641e8.js"><link rel="prefetch" href="/FrontEnd/assets/js/148.fb88aa65.js"><link rel="prefetch" href="/FrontEnd/assets/js/149.d1865813.js"><link rel="prefetch" href="/FrontEnd/assets/js/15.417ddb64.js"><link rel="prefetch" href="/FrontEnd/assets/js/150.5b6e197e.js"><link rel="prefetch" href="/FrontEnd/assets/js/151.df91307c.js"><link rel="prefetch" href="/FrontEnd/assets/js/152.9ae29a06.js"><link rel="prefetch" href="/FrontEnd/assets/js/153.05f39f0f.js"><link rel="prefetch" href="/FrontEnd/assets/js/154.474e59a0.js"><link rel="prefetch" href="/FrontEnd/assets/js/155.141d58b8.js"><link rel="prefetch" href="/FrontEnd/assets/js/156.d614b7b8.js"><link rel="prefetch" href="/FrontEnd/assets/js/157.ee4c6608.js"><link rel="prefetch" href="/FrontEnd/assets/js/158.d32d1096.js"><link rel="prefetch" href="/FrontEnd/assets/js/159.09054d9c.js"><link rel="prefetch" href="/FrontEnd/assets/js/16.7977063c.js"><link rel="prefetch" href="/FrontEnd/assets/js/160.72d197e1.js"><link rel="prefetch" href="/FrontEnd/assets/js/161.93930365.js"><link rel="prefetch" href="/FrontEnd/assets/js/162.9a7552c7.js"><link rel="prefetch" href="/FrontEnd/assets/js/163.c271f790.js"><link rel="prefetch" href="/FrontEnd/assets/js/164.6e5323d6.js"><link rel="prefetch" href="/FrontEnd/assets/js/165.11127e00.js"><link rel="prefetch" href="/FrontEnd/assets/js/166.8273ee58.js"><link rel="prefetch" href="/FrontEnd/assets/js/167.174744fc.js"><link rel="prefetch" href="/FrontEnd/assets/js/168.b20b8e2e.js"><link rel="prefetch" href="/FrontEnd/assets/js/169.aa7c80b0.js"><link rel="prefetch" href="/FrontEnd/assets/js/17.8bc1e081.js"><link rel="prefetch" href="/FrontEnd/assets/js/170.3cc86225.js"><link rel="prefetch" href="/FrontEnd/assets/js/171.35f34a01.js"><link rel="prefetch" href="/FrontEnd/assets/js/172.431ad261.js"><link rel="prefetch" href="/FrontEnd/assets/js/173.996a8d0c.js"><link rel="prefetch" href="/FrontEnd/assets/js/174.34d0ed20.js"><link rel="prefetch" href="/FrontEnd/assets/js/175.4ebb6f59.js"><link rel="prefetch" href="/FrontEnd/assets/js/176.265764b8.js"><link rel="prefetch" href="/FrontEnd/assets/js/177.3ea3ec5a.js"><link rel="prefetch" href="/FrontEnd/assets/js/178.166bdd09.js"><link rel="prefetch" href="/FrontEnd/assets/js/179.3a1beacf.js"><link rel="prefetch" href="/FrontEnd/assets/js/18.b2e30bbf.js"><link rel="prefetch" href="/FrontEnd/assets/js/180.e570050e.js"><link rel="prefetch" href="/FrontEnd/assets/js/181.2030d3a1.js"><link rel="prefetch" href="/FrontEnd/assets/js/182.dc5ffb93.js"><link rel="prefetch" href="/FrontEnd/assets/js/183.fe1ad553.js"><link rel="prefetch" href="/FrontEnd/assets/js/184.a9dc2cb2.js"><link rel="prefetch" href="/FrontEnd/assets/js/185.9c62a8e2.js"><link rel="prefetch" href="/FrontEnd/assets/js/186.fa20816f.js"><link rel="prefetch" href="/FrontEnd/assets/js/187.4d5e32e5.js"><link rel="prefetch" href="/FrontEnd/assets/js/188.c15a2884.js"><link rel="prefetch" href="/FrontEnd/assets/js/189.37133a7e.js"><link rel="prefetch" href="/FrontEnd/assets/js/19.1f8d2130.js"><link rel="prefetch" href="/FrontEnd/assets/js/190.01c5f1d9.js"><link rel="prefetch" href="/FrontEnd/assets/js/191.08f1a9f6.js"><link rel="prefetch" href="/FrontEnd/assets/js/192.772f1f17.js"><link rel="prefetch" href="/FrontEnd/assets/js/193.ff981066.js"><link rel="prefetch" href="/FrontEnd/assets/js/194.5fc4c14e.js"><link rel="prefetch" href="/FrontEnd/assets/js/195.2470368c.js"><link rel="prefetch" href="/FrontEnd/assets/js/196.eb1ba312.js"><link rel="prefetch" href="/FrontEnd/assets/js/197.e2b7ff01.js"><link rel="prefetch" href="/FrontEnd/assets/js/198.cc7702b1.js"><link rel="prefetch" href="/FrontEnd/assets/js/199.f0fa697c.js"><link rel="prefetch" href="/FrontEnd/assets/js/20.3a59b940.js"><link rel="prefetch" href="/FrontEnd/assets/js/200.a20c9e4b.js"><link rel="prefetch" href="/FrontEnd/assets/js/201.2ac94051.js"><link rel="prefetch" href="/FrontEnd/assets/js/202.41f5b1d5.js"><link rel="prefetch" href="/FrontEnd/assets/js/203.cf3ba712.js"><link rel="prefetch" href="/FrontEnd/assets/js/204.45b88ec5.js"><link rel="prefetch" href="/FrontEnd/assets/js/205.26962c2d.js"><link rel="prefetch" href="/FrontEnd/assets/js/206.f680713b.js"><link rel="prefetch" href="/FrontEnd/assets/js/207.8928f715.js"><link rel="prefetch" href="/FrontEnd/assets/js/208.d2446ad9.js"><link rel="prefetch" href="/FrontEnd/assets/js/209.f4596be1.js"><link rel="prefetch" href="/FrontEnd/assets/js/21.2a89bb55.js"><link rel="prefetch" href="/FrontEnd/assets/js/210.6b59e063.js"><link rel="prefetch" href="/FrontEnd/assets/js/211.d1c14bd6.js"><link rel="prefetch" href="/FrontEnd/assets/js/212.f5a47bf9.js"><link rel="prefetch" href="/FrontEnd/assets/js/213.8e4d2d5d.js"><link rel="prefetch" href="/FrontEnd/assets/js/214.3e9eadc9.js"><link rel="prefetch" href="/FrontEnd/assets/js/215.c4fe6f70.js"><link rel="prefetch" href="/FrontEnd/assets/js/216.714874d9.js"><link rel="prefetch" href="/FrontEnd/assets/js/217.1fa49fd4.js"><link rel="prefetch" href="/FrontEnd/assets/js/218.e26b1ae9.js"><link rel="prefetch" href="/FrontEnd/assets/js/219.0b1d09cf.js"><link rel="prefetch" href="/FrontEnd/assets/js/22.41e2387b.js"><link rel="prefetch" href="/FrontEnd/assets/js/220.13f730b6.js"><link rel="prefetch" href="/FrontEnd/assets/js/221.46d08f8f.js"><link rel="prefetch" href="/FrontEnd/assets/js/222.6d09c52e.js"><link rel="prefetch" href="/FrontEnd/assets/js/223.e152bab5.js"><link rel="prefetch" href="/FrontEnd/assets/js/224.316cfa2d.js"><link rel="prefetch" href="/FrontEnd/assets/js/225.c063fc11.js"><link rel="prefetch" href="/FrontEnd/assets/js/226.1fdced6d.js"><link rel="prefetch" href="/FrontEnd/assets/js/227.48f7b8c0.js"><link rel="prefetch" href="/FrontEnd/assets/js/228.f98c06cf.js"><link rel="prefetch" href="/FrontEnd/assets/js/229.aa334346.js"><link rel="prefetch" href="/FrontEnd/assets/js/23.19fda2ea.js"><link rel="prefetch" href="/FrontEnd/assets/js/230.bf62f254.js"><link rel="prefetch" href="/FrontEnd/assets/js/231.0b3d8896.js"><link rel="prefetch" href="/FrontEnd/assets/js/232.3598b753.js"><link rel="prefetch" href="/FrontEnd/assets/js/233.d3e7ea22.js"><link rel="prefetch" href="/FrontEnd/assets/js/234.2a2aef10.js"><link rel="prefetch" href="/FrontEnd/assets/js/235.373af961.js"><link rel="prefetch" href="/FrontEnd/assets/js/236.69c772a9.js"><link rel="prefetch" href="/FrontEnd/assets/js/238.695f9dd6.js"><link rel="prefetch" href="/FrontEnd/assets/js/239.b062675e.js"><link rel="prefetch" href="/FrontEnd/assets/js/24.35379251.js"><link rel="prefetch" href="/FrontEnd/assets/js/240.268389d4.js"><link rel="prefetch" href="/FrontEnd/assets/js/241.f0072a8e.js"><link rel="prefetch" href="/FrontEnd/assets/js/242.9d86bf89.js"><link rel="prefetch" href="/FrontEnd/assets/js/243.f72b0489.js"><link rel="prefetch" href="/FrontEnd/assets/js/244.bab233e5.js"><link rel="prefetch" href="/FrontEnd/assets/js/245.d4ae6d3e.js"><link rel="prefetch" href="/FrontEnd/assets/js/246.a38bde5e.js"><link rel="prefetch" href="/FrontEnd/assets/js/247.b5173f71.js"><link rel="prefetch" href="/FrontEnd/assets/js/248.25ced97f.js"><link rel="prefetch" href="/FrontEnd/assets/js/249.1fb1b9ea.js"><link rel="prefetch" href="/FrontEnd/assets/js/25.e8597c29.js"><link rel="prefetch" href="/FrontEnd/assets/js/250.c69f2c42.js"><link rel="prefetch" href="/FrontEnd/assets/js/251.ab6695e8.js"><link rel="prefetch" href="/FrontEnd/assets/js/252.e6551bd5.js"><link rel="prefetch" href="/FrontEnd/assets/js/253.e1399a06.js"><link rel="prefetch" href="/FrontEnd/assets/js/254.c4005992.js"><link rel="prefetch" href="/FrontEnd/assets/js/255.66e99068.js"><link rel="prefetch" href="/FrontEnd/assets/js/256.2138dc2d.js"><link rel="prefetch" href="/FrontEnd/assets/js/257.1807c189.js"><link rel="prefetch" href="/FrontEnd/assets/js/258.1e1fec62.js"><link rel="prefetch" href="/FrontEnd/assets/js/259.d98a3bc3.js"><link rel="prefetch" href="/FrontEnd/assets/js/26.ea38109f.js"><link rel="prefetch" href="/FrontEnd/assets/js/260.759e43ea.js"><link rel="prefetch" href="/FrontEnd/assets/js/261.e2cca374.js"><link rel="prefetch" href="/FrontEnd/assets/js/262.792a4cfa.js"><link rel="prefetch" href="/FrontEnd/assets/js/263.2053a8e3.js"><link rel="prefetch" href="/FrontEnd/assets/js/264.15f8742a.js"><link rel="prefetch" href="/FrontEnd/assets/js/265.207973b0.js"><link rel="prefetch" href="/FrontEnd/assets/js/266.5a0aa258.js"><link rel="prefetch" href="/FrontEnd/assets/js/267.a30465f2.js"><link rel="prefetch" href="/FrontEnd/assets/js/268.47ce3457.js"><link rel="prefetch" href="/FrontEnd/assets/js/269.f1130b85.js"><link rel="prefetch" href="/FrontEnd/assets/js/27.9addd78b.js"><link rel="prefetch" href="/FrontEnd/assets/js/270.a08ee0ad.js"><link rel="prefetch" href="/FrontEnd/assets/js/271.5c21d9ff.js"><link rel="prefetch" href="/FrontEnd/assets/js/272.f870dd53.js"><link rel="prefetch" href="/FrontEnd/assets/js/273.0bcf0096.js"><link rel="prefetch" href="/FrontEnd/assets/js/274.8eb0087f.js"><link rel="prefetch" href="/FrontEnd/assets/js/275.b8337df3.js"><link rel="prefetch" href="/FrontEnd/assets/js/276.500d6826.js"><link rel="prefetch" href="/FrontEnd/assets/js/277.14cf0134.js"><link rel="prefetch" href="/FrontEnd/assets/js/278.9c2fe889.js"><link rel="prefetch" href="/FrontEnd/assets/js/279.508cbe64.js"><link rel="prefetch" href="/FrontEnd/assets/js/28.92deab21.js"><link rel="prefetch" href="/FrontEnd/assets/js/29.3a04c87a.js"><link rel="prefetch" href="/FrontEnd/assets/js/3.f93c2d81.js"><link rel="prefetch" href="/FrontEnd/assets/js/30.b79dcd17.js"><link rel="prefetch" href="/FrontEnd/assets/js/31.f1802ecb.js"><link rel="prefetch" href="/FrontEnd/assets/js/32.99225060.js"><link rel="prefetch" href="/FrontEnd/assets/js/33.bccdc07b.js"><link rel="prefetch" href="/FrontEnd/assets/js/34.2cc8e724.js"><link rel="prefetch" href="/FrontEnd/assets/js/35.f27c12a5.js"><link rel="prefetch" href="/FrontEnd/assets/js/36.c10f3678.js"><link rel="prefetch" href="/FrontEnd/assets/js/37.3e1b386b.js"><link rel="prefetch" href="/FrontEnd/assets/js/38.b0e8a518.js"><link rel="prefetch" href="/FrontEnd/assets/js/39.7c3a0e04.js"><link rel="prefetch" href="/FrontEnd/assets/js/4.a5498e9e.js"><link rel="prefetch" href="/FrontEnd/assets/js/40.0f9eb690.js"><link rel="prefetch" href="/FrontEnd/assets/js/41.8fd35d7c.js"><link rel="prefetch" href="/FrontEnd/assets/js/42.bc836d66.js"><link rel="prefetch" href="/FrontEnd/assets/js/43.d7fd872d.js"><link rel="prefetch" href="/FrontEnd/assets/js/44.63bab8ff.js"><link rel="prefetch" href="/FrontEnd/assets/js/45.52eb86e8.js"><link rel="prefetch" href="/FrontEnd/assets/js/46.4ac377dd.js"><link rel="prefetch" href="/FrontEnd/assets/js/47.e0c42ef0.js"><link rel="prefetch" href="/FrontEnd/assets/js/48.00e2d5a1.js"><link rel="prefetch" href="/FrontEnd/assets/js/49.ce164e69.js"><link rel="prefetch" href="/FrontEnd/assets/js/5.a537d9f8.js"><link rel="prefetch" href="/FrontEnd/assets/js/50.c8492c8a.js"><link rel="prefetch" href="/FrontEnd/assets/js/51.c06c0216.js"><link rel="prefetch" href="/FrontEnd/assets/js/52.138e7075.js"><link rel="prefetch" href="/FrontEnd/assets/js/53.712893cb.js"><link rel="prefetch" href="/FrontEnd/assets/js/54.a96d8d2a.js"><link rel="prefetch" href="/FrontEnd/assets/js/55.5bbc75da.js"><link rel="prefetch" href="/FrontEnd/assets/js/56.ae0dcad1.js"><link rel="prefetch" href="/FrontEnd/assets/js/57.38afddbc.js"><link rel="prefetch" href="/FrontEnd/assets/js/58.b5c0ea06.js"><link rel="prefetch" href="/FrontEnd/assets/js/59.b44519b0.js"><link rel="prefetch" href="/FrontEnd/assets/js/6.177eb86d.js"><link rel="prefetch" href="/FrontEnd/assets/js/60.6378482e.js"><link rel="prefetch" href="/FrontEnd/assets/js/61.73d3fc82.js"><link rel="prefetch" href="/FrontEnd/assets/js/62.90b02b76.js"><link rel="prefetch" href="/FrontEnd/assets/js/63.1732a83d.js"><link rel="prefetch" href="/FrontEnd/assets/js/64.655fa393.js"><link rel="prefetch" href="/FrontEnd/assets/js/65.2e3710cc.js"><link rel="prefetch" href="/FrontEnd/assets/js/66.69343178.js"><link rel="prefetch" href="/FrontEnd/assets/js/67.a1158f3c.js"><link rel="prefetch" href="/FrontEnd/assets/js/68.7562e4f3.js"><link rel="prefetch" href="/FrontEnd/assets/js/69.58e06d9e.js"><link rel="prefetch" href="/FrontEnd/assets/js/7.e9c92e1a.js"><link rel="prefetch" href="/FrontEnd/assets/js/70.187f4032.js"><link rel="prefetch" href="/FrontEnd/assets/js/71.8441a443.js"><link rel="prefetch" href="/FrontEnd/assets/js/72.31b65af7.js"><link rel="prefetch" href="/FrontEnd/assets/js/73.64ca6294.js"><link rel="prefetch" href="/FrontEnd/assets/js/74.66689904.js"><link rel="prefetch" href="/FrontEnd/assets/js/75.1bf6206b.js"><link rel="prefetch" href="/FrontEnd/assets/js/76.8e880281.js"><link rel="prefetch" href="/FrontEnd/assets/js/77.63291292.js"><link rel="prefetch" href="/FrontEnd/assets/js/78.95a5bc57.js"><link rel="prefetch" href="/FrontEnd/assets/js/79.4bd28c33.js"><link rel="prefetch" href="/FrontEnd/assets/js/80.ec5e1299.js"><link rel="prefetch" href="/FrontEnd/assets/js/81.e2c46585.js"><link rel="prefetch" href="/FrontEnd/assets/js/82.1fbfb23d.js"><link rel="prefetch" href="/FrontEnd/assets/js/83.80f4d70b.js"><link rel="prefetch" href="/FrontEnd/assets/js/84.ffd44ae8.js"><link rel="prefetch" href="/FrontEnd/assets/js/85.fb2b5d8d.js"><link rel="prefetch" href="/FrontEnd/assets/js/86.4eb6d5cc.js"><link rel="prefetch" href="/FrontEnd/assets/js/87.16522fdf.js"><link rel="prefetch" href="/FrontEnd/assets/js/88.3f8796d9.js"><link rel="prefetch" href="/FrontEnd/assets/js/89.8defbae1.js"><link rel="prefetch" href="/FrontEnd/assets/js/90.ab290351.js"><link rel="prefetch" href="/FrontEnd/assets/js/91.41b0a779.js"><link rel="prefetch" href="/FrontEnd/assets/js/92.212b1d99.js"><link rel="prefetch" href="/FrontEnd/assets/js/93.e60012c9.js"><link rel="prefetch" href="/FrontEnd/assets/js/94.034c4347.js"><link rel="prefetch" href="/FrontEnd/assets/js/95.87dc2e8b.js"><link rel="prefetch" href="/FrontEnd/assets/js/96.474ff8ca.js"><link rel="prefetch" href="/FrontEnd/assets/js/97.e7cddd3d.js"><link rel="prefetch" href="/FrontEnd/assets/js/98.c47407ea.js"><link rel="prefetch" href="/FrontEnd/assets/js/99.261330cf.js"><link rel="prefetch" href="/FrontEnd/assets/js/vendors~docsearch.162bdabc.js">
    <link rel="stylesheet" href="/FrontEnd/assets/css/0.styles.4f2b0bb5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/FrontEnd/" class="home-link router-link-active"><!----> <span class="site-name">Rowan Liu's Tech</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/FrontEnd/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/translate/" class="nav-link">
  翻译
</a></li><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/dataStructure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/design-pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><a href="/FrontEnd/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/FrontEnd/js/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/FrontEnd/lib/" class="nav-link router-link-active">
  lib
</a></div><div class="nav-item"><a href="/FrontEnd/read/" class="nav-link">
  Read
</a></div><div class="nav-item"><a href="https://rowanliu.com/about" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/FrontEnd/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/translate/" class="nav-link">
  翻译
</a></li><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/dataStructure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/design-pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><a href="/FrontEnd/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/FrontEnd/js/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/FrontEnd/lib/" class="nav-link router-link-active">
  lib
</a></div><div class="nav-item"><a href="/FrontEnd/read/" class="nav-link">
  Read
</a></div><div class="nav-item"><a href="https://rowanliu.com/about" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/FrontEnd/lib/" aria-current="page" class="sidebar-link">框架</a></li><li><a href="/FrontEnd/lib/vue-cli/" class="sidebar-link">Vue ClI 源码探索</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vue 源码被解读</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FrontEnd/lib/vue-analysis/00-vue.html" class="sidebar-link">Vue.js技术揭秘</a></li><li><a href="/FrontEnd/lib/vue-analysis/01-flow.html" class="sidebar-link">Flow</a></li><li><a href="/FrontEnd/lib/vue-analysis/02-src-structure.html" class="sidebar-link">Vue.js源码目录设计</a></li><li><a href="/FrontEnd/lib/vue-analysis/03-compile.html" class="sidebar-link">Vue.js源码构建</a></li><li><a href="/FrontEnd/lib/vue-analysis/04-entry.html" class="sidebar-link">从入口开始</a></li><li><a href="/FrontEnd/lib/vue-analysis/10-data-driven.html" class="sidebar-link">数据驱动</a></li><li><a href="/FrontEnd/lib/vue-analysis/11-new-Vue.html" class="sidebar-link">new Vue发生了什么</a></li><li><a href="/FrontEnd/lib/vue-analysis/12-vue-mounted.html" class="sidebar-link">Vue实例挂载的实现</a></li><li><a href="/FrontEnd/lib/vue-analysis/13-render.html" class="sidebar-link">render</a></li><li><a href="/FrontEnd/lib/vue-analysis/14-virtual-DOM.html" class="sidebar-link">Virtual DOM</a></li><li><a href="/FrontEnd/lib/vue-analysis/15-createElement.html" class="sidebar-link">createElement</a></li><li><a href="/FrontEnd/lib/vue-analysis/16-update.html" class="sidebar-link">update</a></li><li><a href="/FrontEnd/lib/vue-analysis/20-components.html" class="sidebar-link">组件化</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>threejs journey</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react journey</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vuepress</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>egg</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>jQuery系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>nestjs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FrontEnd/lib/nestjs/01-OAuth_2.0.html" class="sidebar-link">OAuth 2.0</a></li><li><a href="/FrontEnd/lib/nestjs/passport/01-general.html" aria-current="page" class="active sidebar-link">[译]Passport 文档（一）入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FrontEnd/lib/nestjs/passport/01-general.html#概览" class="sidebar-link">概览</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/lib/nestjs/passport/01-general.html#认证" class="sidebar-link">认证</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/lib/nestjs/passport/01-general.html#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/lib/nestjs/passport/01-general.html#用户名-和-密码" class="sidebar-link">用户名 和 密码</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/lib/nestjs/passport/01-general.html#openid" class="sidebar-link">OpenID</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/lib/nestjs/passport/01-general.html#oauth" class="sidebar-link">OAuth</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/lib/nestjs/passport/01-general.html#用户个人信息" class="sidebar-link">用户个人信息</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/lib/nestjs/passport/01-general.html#参考" class="sidebar-link">参考</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/lib/nestjs/passport/01-general.html#感谢阅读" class="sidebar-link">感谢阅读</a></li></ul></li><li><a href="/FrontEnd/lib/nestjs/passport/02-providers.html" class="sidebar-link">[译]Passport 文档（二）提供者</a></li><li><a href="/FrontEnd/lib/nestjs/passport/03-apis.html" class="sidebar-link">[译]Passport 文档（三）基本 &amp; 摘要</a></li><li><a href="/FrontEnd/lib/nestjs/passport/04-operations.html" class="sidebar-link">[译]Passport 文档（四）操作</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="译-passport-文档-一-入门"><a href="#译-passport-文档-一-入门" class="header-anchor">#</a> [译]Passport 文档（一）入门</h1> <p><a href="http://www.passportjs.org/docs/downloads/html/" target="_blank" rel="noopener noreferrer">http://www.passportjs.org/docs/downloads/html/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 原文地址</p> <h2 id="概览"><a href="#概览" class="header-anchor">#</a> 概览</h2> <p>Passport 是 NodeJS 的认证中间件。他的唯一设计目的是：验证请求。书写模块化的、封装代码是一种美德，所以 Passport 将除了验证请求之外的功能都分发给应用程序来实现。关注点分离使代码能够更加整洁、可维护，同时也使 Passport 能够极易集成到应用中。</p> <p>现在 Web 程序，认证有多种形式。传统的，用户通过用户名、密码登录。随着社交网络使用上升，使用 OAuth 的单点登录，例如 <a href="https://www.facebook.com/" target="_blank" rel="noopener noreferrer">Facebook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或者 <a href="https://twitter.com/" target="_blank" rel="noopener noreferrer">Twitter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 已经成为了一种流行的认证方式。暴露一个 API 的服务通常需要基于 token 的证书来保护访问。</p> <p>Passport 认识到每个应用有自己独特的认证需求。认证机制，也被成为策略，被打包成单独的模块。应用能够选择采用的策略，无需创建不需要的依赖。</p> <p>不管认证的复杂性，代码能够不变的复杂。</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> passport<span class="token punctuation">.</span><span class="token function">authentication</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">successRedirect</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token literal-property property">failureRedirect</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>安装</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>npm install passport
</code></pre></div><h2 id="认证"><a href="#认证" class="header-anchor">#</a> 认证</h2> <p>认证请求就像调用 <code>passport.authenticate()</code> 和指定采用哪种策略一样简单。<code>authenticate()</code> 的函数签名是标准的 <a href="http://www.senchalabs.org/connect/" target="_blank" rel="noopener noreferrer">Connect<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中间件，所以能够方便的作为路由中间件在 <a href="http://expressjs.com/" target="_blank" rel="noopener noreferrer">Express<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 应用中使用。</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>
    passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果这个函数被调用，说明认证成功。</span>
        <span class="token comment">// `req.user` 包含认证的 user</span>
        res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>默认情况下，如果认证失败，Passport 将返回 <code>401 Unauthorized</code>，后续其他的路由处理器将不会执行。如果认证成功，下个处理器将调用，<code>req.user</code> 属性将设置为认证 user。</p> <p>注意：在路由使用策略时，一定要预先配置。继续阅读详细<a href="http://www.passportjs.org/guide/configure/" target="_blank" rel="noopener noreferrer">配置 todo <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>章节。</p> <h3 id="重定向"><a href="#重定向" class="header-anchor">#</a> 重定向</h3> <p>重定向通常是在认证请求之后发出的。</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>
    passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">successRedirect</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">failureRedirect</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>这种情况下，重定向选项将覆盖默认行为。若成功认证，用户将重定向到主页。若认证失败，用户将重定向返回到登录页去再次尝试。</p> <h3 id="即时消息-flash-messages"><a href="#即时消息-flash-messages" class="header-anchor">#</a> 即时消息（Flash Messages）</h3> <p>重定向通常和即时消息结合来展示用户的状态信息。</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>
    passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">successRedirect</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">failureRedirect</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">failureFlash</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>设置 <code>failureFlash</code> 选项为 true，指示 Passport 去发送 来自策略验证回调的 <code>error</code> 信息。这通常是最好的方法，因为验证回调能够最准确的判断为什么认证失败。</p> <p>或者，即时消息能够自定义设置。</p> <div class="language-js extra-class"><pre class="language-js"><code>passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">failureFlash</span><span class="token operator">:</span> <span class="token string">'无效用户名或者密码。'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>successFlash</code> 选项能够发送一个 <code>success</code> 的消息，在认证成功的时候。</p> <div class="language-js extra-class"><pre class="language-js"><code>passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">successFlash</span><span class="token operator">:</span> <span class="token string">'欢迎！'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>注意：使用即时消息需要 <code>req.flash()</code> 函数。Express 2.x 提供了这个功能，不过 Express 3.x 移除了。在使用 Express 3.x 时，建议使用 <a href="https://github.com/jaredhanson/connect-flash" target="_blank" rel="noopener noreferrer">connect-flash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中间件，它提供了这个功能。</p> <h3 id="禁止-sessions"><a href="#禁止-sessions" class="header-anchor">#</a> 禁止 Sessions</h3> <p>成功授权后，Passport 将建立一个持久的登录 session。对于用户通过浏览器访问 web 应用的场景这是有用的。然后，其他情况下，不需要 session 支持。例如，API 服务器通常需要每个请求携带凭证。这种情况下，session 支持能够通过设置 session 选项为 false 来安全的禁用。</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/users/me'</span><span class="token punctuation">,</span>
    passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'basic'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">session</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token literal-property property">username</span><span class="token operator">:</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="自定义回调"><a href="#自定义回调" class="header-anchor">#</a> 自定义回调</h3> <p>如果内部选项不足够处理认证请求，自定义回调能够让应用处理成功和失败的情况。</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> user<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        req<span class="token punctuation">.</span><span class="token function">logIn</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/users'</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>username<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这个例子中，注意 <code>authenticate()</code> 是在路由处理器中被调用，而不是作为路由中间件。这通过闭包给了 <code>req</code>和 <code>res</code> 对象回调权限。</p> <p>如果认证失败，<code>user</code> 将被设置为 <code>false</code>。如果发生异常，<code>err</code> 将被设置。一个可选的 <code>info</code> 参数将传入，包括策略验证回调所提供的附加的详细信息。</p> <p>这个回调能够使用提供的参数处理预期的认证结果。注意，当使用自定义回调时，需要应用来建立 session（通过调用 <code>req.login()</code>） 和发送响应。</p> <h2 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h2> <p>使用 Passport 来认证需要配置三个方面：</p> <p>1、认证策略
2、应用中间件
3、Session（可选的）</p> <h3 id="策略"><a href="#策略" class="header-anchor">#</a> 策略</h3> <p>Passport 使用被称为策略的东西来认证请求。策略从验证用户名、密码，使用 <a href="http://oauth.net/" target="_blank" rel="noopener noreferrer">OAuth<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 委托认证或者使用 <a href="http://openid.net/" target="_blank" rel="noopener noreferrer">OpenID<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 联合认证。</p> <p>在让 Passport 认证请求前，应用使用的某个策略（或者某些策略）必须要先配置。</p> <p>策略和他们的配置通过 <code>use()</code> 函数提供。例如，下面的例子使用 <code>LocalStrategy</code> 来进行用户名、密码认证。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> passport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> LocalStrategy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport-local'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Strategy<span class="token punctuation">;</span>

passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LocalStrategy</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> username <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'用户名错误'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span><span class="token function">validPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'密码错误'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="验证回调"><a href="#验证回调" class="header-anchor">#</a> 验证回调</h3> <p>这个例子引入了一个重要的概念。策略需要一个称为回调的东西。验证回调的目的是找到拥有一套凭证的用户。</p> <p>当 Passport 认证请求时，它解析请求中的凭证。然后将凭证作为调用回调函数的参数，这个例子中就是 <code>username</code> 和 <code>password</code>。如果凭证有效，回调函数将调用 <code>done</code> 将已认证的用户的信息传入 Passport。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果验证失败（本例中，比如密码错误），<code>done</code> 函数应该传入 <code>false</code> 而不是用户信息来表明认证失败。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以提供额外的消息来表明失败原因。这对于展示即时消息，来提示用户再次尝试很有用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'密码错误'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>最后，当验证凭证时发生异常（例如，数据库服务不可用），在常规的 Node 操作中 <code>done</code> 应该被调用来传入错误信息。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意，对于区分两种能够发生失败的情况是很重要的。后者是服务端异常，这种情况下 <code>err</code> 被设置为非 <code>null</code> 的值。在服务器正常运行时，认证失败也是很自然的情况。确认 <code>err</code> 包含 <code>null</code>，使用最后一个参数传递详细信息。</p> <p>验证回调通过委派的方式使 Passport 可以无需数据库支持。应用可以自己决定如何存储用户信息，没有验证层强加的任何假设。</p> <h5 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h5> <p>在基于 <a href="http://senchalabs.github.com/connect/" target="_blank" rel="noopener noreferrer">Connect<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或者 <a href="http://expressjs.com/" target="_blank" rel="noopener noreferrer">Express<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的应用中，需要使用 <code>passport.initialize()</code> 中间件来初始化 Passport。如果你的应用使用了持久化登录 Session，<code>passport.session()</code> 中间件也需要使用。</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">'keyboard cat'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>注意，开启 session 支持完全是可选的，尽管建议将其用于大多数应用中。如果开启，确认在 <code>passport.session()</code> 前使用 <code>session()</code>，从而确保登录 session 能够按正确的顺序存储。</p> <p>在 Express 4.x 中，Connect 中间件不再包含于 Express 核心模块中，app.configure() 也被移除了。相同的中间件能够在 npm 模块找到。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">'cats'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="sessions-会话"><a href="#sessions-会话" class="header-anchor">#</a> sessions 会话</h5> <p>在常规的 web 应用中，用于认证用户的凭证仅在登录请求时被发送。如果认证成功，一个session 将被建立和保持，通过设置在浏览器中的 cookie。</p> <p>每个随后的请求将不再包含凭证，但是会有唯一的 cookie 来确认 session。为了支持登录 session，Passport 将序列化和反序列化 <code>user</code> 实例经由 session。</p> <div class="language-js extra-class"><pre class="language-js"><code>passport<span class="token punctuation">.</span><span class="token function">serializeUser</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

passport<span class="token punctuation">.</span><span class="token function">deserializeUser</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>这个例子中，仅 user ID 被序列化到 session 中，从而保持存储在 session 中的数据量较小。当后续请求到达时，这个 ID 将用来找到存储在 <code>req.user</code> 中的 user。</p> <p>序列化和反序列化逻辑由应用来提供，允许应用选择一个合适的数据库和（或者）对象mapper，无需认证层强加。</p> <h2 id="用户名-和-密码"><a href="#用户名-和-密码" class="header-anchor">#</a> 用户名 和 密码</h2> <p>最广泛使用的网站认证用户的方式是通过用户名和密码。对这种机制的支持是通过提供 <a href="https://github.com/jaredhanson/passport-local" target="_blank" rel="noopener noreferrer">passport-local<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 模块。</p> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-js extra-class"><pre class="language-js"><code>npm install passport<span class="token operator">-</span>local
</code></pre></div><h3 id="配置-2"><a href="#配置-2" class="header-anchor">#</a> 配置</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> passport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    LocalStrategy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport-local'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Strategy<span class="token punctuation">;</span>

passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LocalStrategy</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> username <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'用户名错误。'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span><span class="token function">validPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'密码错误。'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>这个本地认证的验证回调接受 <code>username</code> 和 <code>password</code> 参数，通过应用的登录表单提交上来的。</p> <h3 id="表单"><a href="#表单" class="header-anchor">#</a> 表单</h3> <p>Web 页面的一个表单，允许用户输入他们凭证然后登录。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/login<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>Username:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>Password:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Log In<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h3> <p>登录表单通过 <code>POST</code> 方法提交到服务器。使用 <code>local</code> 策略的 <code>authenticate</code> 函数来处理登录请求。</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>
    passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">successRedirect</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">failureRedirect</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">failureFlash</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>设置 <code>failureFlash</code> 选项为 <code>true</code> 表明 Passport 使用验证回调提供的 <code>message</code> 选项来发送一个 <code>error</code> 消息。这对于提示用户再试一次很有用。</p> <h3 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h3> <p>默认的，<code>LocalStrategy</code> 预期在参数中找到命名为 <code>username</code> 和 <code>password</code> 的凭证。如果你的网站更喜欢用其他字段命名，有可用的选项支持修改默认值。</p> <div class="language-js extra-class"><pre class="language-js"><code>passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LocalStrategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">usernameField</span><span class="token operator">:</span> <span class="token string">'email'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">passwordField</span><span class="token operator">:</span> <span class="token string">'passwd'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="openid"><a href="#openid" class="header-anchor">#</a> OpenID</h2> <p><a href="http://openid.net/" target="_blank" rel="noopener noreferrer">OpenID<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个联合认证的开放标准。当访问网站时，用户使用 OpenID 登录。用户通过他们选择 OpenID 提供者（它发出一个断言来确认用户身份）来认证。网站验证这个断言来让用户登录。</p> <p>OpenID 的支持通过 <a href="https://github.com/jaredhanson/passport-openid" target="_blank" rel="noopener noreferrer">passport-openid<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 模块提供。</p> <h3 id="安装-2"><a href="#安装-2" class="header-anchor">#</a> 安装</h3> <div class="language-js extra-class"><pre class="language-js"><code>npm install passport<span class="token operator">-</span>openid
</code></pre></div><h3 id="配置-3"><a href="#配置-3" class="header-anchor">#</a> 配置</h3> <p>当使用 OpenID 时，返回地址和领域必须设置。 <code>returnURL</code> 是用户在使用 OpenID 提供者认证后重定向的地址。<code>realm</code> 表明 URL空间中验证有效的部分。通常它会是网站的根 URL。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> passport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    OpenIDStrategy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport-openid'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Strategy<span class="token punctuation">;</span>

passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OpenIDStrategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">returnURL</span><span class="token operator">:</span> <span class="token string">'http://www.example.com/auth/openid/return'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">realm</span><span class="token operator">:</span> <span class="token string">'http://www.example.com/'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">identifier<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    User<span class="token punctuation">.</span><span class="token function">findOrCreate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">openId</span><span class="token operator">:</span> identifier<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>OpenID认证的验证回调接受一个 <code>identifier</code> 参数，包含用户的声明识别码。</p> <h3 id="表单-2"><a href="#表单-2" class="header-anchor">#</a> 表单</h3> <p>web 页面的表单，允许用户输入 OpenID 然后登录。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/auth/openid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>OpenID:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>openid_identifier<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Sign In<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="路由-2"><a href="#路由-2" class="header-anchor">#</a> 路由</h3> <p>OpenID 认证需要2个路由。第一个路由接受表单提交中包含的 OpenId 识别码。认证期间，用户将被重定向到 OpenID 提供者。第二个路由是用户在使用 OpenID 提供者认证后，将返回的 URL。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 接受 OpenID 识别码，将用户重定向到 OpenID 提供者处去认证。完成后，提供者将用户重定向到应用：</span>
<span class="token comment">// /auth/openid/return</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/auth/openid'</span><span class="token punctuation">,</span> passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'openid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// OpenID 提供者已经将用户重定向到应用。</span>
<span class="token comment">// 通过验证断言来完成认证过程。如果有效，用户将登录。</span>
<span class="token comment">// 否则，认证失败。</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/auth/openid/return'</span><span class="token punctuation">,</span> 
    passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'openid'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">successRedirect</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">failureRedirect</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

</code></pre></div><h3 id="个人资料交换"><a href="#个人资料交换" class="header-anchor">#</a> 个人资料交换</h3> <p>OpenID 能够可选择的设置为取回已认证用户的个人信息。个人资料交换通过设置 <code>profile</code> 选项为 <code>true</code> 开启。</p> <div class="language-js extra-class"><pre class="language-js"><code>passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OpenIDStrategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">returnURL</span><span class="token operator">:</span> <span class="token string">'http://www.example.com/auth/openid/return'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">realm</span><span class="token operator">:</span> <span class="token string">'http://www.example.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">profile</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">identifier<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>当个人资料交换开启后，验证回调函数签名接收额外的 <code>profile</code> 参数，包含 OpenID 提供者提供的用户个人信息；通过 <a href="http://www.passportjs.org/guide/profile/" target="_blank" rel="noopener noreferrer">User Profile<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来了解更多信息。</p> <h2 id="oauth"><a href="#oauth" class="header-anchor">#</a> OAuth</h2> <p><a href="http://oauth.net/" target="_blank" rel="noopener noreferrer">OAuth<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是个标准协议，它允许用户授权 API 使用权给网站、桌面程序或者移动应用。一旦被授权，被授权的应用能够代表用户使用 API。OAuth 也已经成为流行的<a href="http://hueniverse.com/2009/04/introducing-sign-in-with-twitter-oauth-style-connect/" target="_blank" rel="noopener noreferrer">委托授权<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>机制。</p> <p>OAuth 有两种主要形式，两种都被广泛的部署。</p> <p>OAuth 初始版本被一群组织松散的 Web 开发者开发作为开放标准。他们开发了 <a href="http://oauth.net/core/1.0/" target="_blank" rel="noopener noreferrer">OAuth 1.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，被 <a href="http://oauth.net/core/1.0a/" target="_blank" rel="noopener noreferrer">OAuth 1.0a<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 取代。这项工作现在被 <a href="http://www.ietf.org/" target="_blank" rel="noopener noreferrer">IEFT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 作为 <a href="http://tools.ietf.org/html/rfc5849" target="_blank" rel="noopener noreferrer">RFC 5849<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 准备被标准化。</p> <p>最近的工作 -- 专注定义 <a href="http://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener noreferrer">OAuth 2.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，已经被 <a href="http://tools.ietf.org/wg/oauth/" target="_blank" rel="noopener noreferrer">web 授权协议工作组<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 承担。由于长期的标准化工作，提供者已经开始部署符合各种草案的实现，每种语义略有不同。</p> <p>谢天谢地，Passport 隔离了应用处理 OAuth 变体的复杂性。许多情况下，特定策略的提供者能够被使用。而不是下面描述的通用策略。这减少了必须的配置，并且能容纳任何提供者的特定怪癖。查看 <a href="http://www.passportjs.org/docs#facebook" target="_blank" rel="noopener noreferrer">Facebook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.passportjs.org/docs#twitter" target="_blank" rel="noopener noreferrer">Twitter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或者列表中的<a href="http://www.passportjs.org/docs/openid/" target="_blank" rel="noopener noreferrer">提供者<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的首选用法。</p> <p>OAuth 的支持通过 <a href="https://github.com/jaredhanson/passport-oauth" target="_blank" rel="noopener noreferrer">passport-oauth<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 模块实现</p> <h3 id="安装-3"><a href="#安装-3" class="header-anchor">#</a> 安装</h3> <div class="language-js extra-class"><pre class="language-js"><code>npm install passport<span class="token operator">-</span>oauth
</code></pre></div><h4 id="oauth-1-0"><a href="#oauth-1-0" class="header-anchor">#</a> OAuth 1.0</h4> <p>OAuth 1.0 是包含多个步骤的代理认证策略。首先，需要获得请求 token。然后，用户被重定向到服务提供者处授权。最后，授权后，用户被重定向回应用并且请求 token 能够用来交换访问 token。请求访问的应用程序（称为消费者）由消费者 key 和 消费者 secret 标识。</p> <h3 id="配置-4"><a href="#配置-4" class="header-anchor">#</a> 配置</h3> <p>当使用通用 OAuth 策略时，key, secret 和 endpoints 作为选项定义。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> passport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    OAuthStrategy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport-oauth'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>OAuthStrategy<span class="token punctuation">;</span>

passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'provider'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OAuthStrategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">requestTokenURL</span><span class="token operator">:</span> <span class="token string">'https://www.provider.com/oauth/request_token'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">accessTokenURL</span><span class="token operator">:</span> <span class="token string">'https://www.provider.com/oauth/access_token'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">userAuthorizationURL</span><span class="token operator">:</span> <span class="token string">'https://www.provider.com/oauth/authorize'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">consumerKey</span><span class="token operator">:</span> <span class="token string">'123-456-789'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">consumerSecret</span><span class="token operator">:</span> <span class="token string">'shhh-its-a-secret'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">callbackURL</span><span class="token operator">:</span> <span class="token string">'https://www.example.com/auth/provider/callback'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">token<span class="token punctuation">,</span> tokenSecret<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    User<span class="token punctuation">.</span><span class="token function">findOrCreate</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>基于 OAuth 策略的验证回调接受 <code>token</code>，<code>tokenSecret</code> 和 <code>profile</code> 参数。<code>token</code> 是访问 token，<code>tokenSecret</code> 是它对应的秘钥。<code>profile</code> 包含服务提供者提供的用户个人信息。通过 <a href="http://www.passportjs.org/guide/profile/" target="_blank" rel="noopener noreferrer">User Profile<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 了解更多信息。</p> <h3 id="路由-3"><a href="#路由-3" class="header-anchor">#</a> 路由</h3> <p>OAuth 认证需要2个路由。第一个路由发起一个 OAuth 交换和重定向用户到服务提供者处。第二个路由是个URL，用户在提供者认证后重定向的 URL。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 重定向用户到用于认证的 OAuth 提供者处。当认证完成后，</span>
<span class="token comment">// 提供者将重定向用户回到应用:</span>
<span class="token comment">// /auth/provider/callback</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/auth/provider'</span><span class="token punctuation">,</span> passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'provider'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// OAuth 提供者已经重定向用户回到应用。</span>
<span class="token comment">// 通过获取访问 token 来结束认证过程。如果已经授权，用户将登录。</span>
<span class="token comment">// 否则，认证失败。</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/auth/provider/callback'</span><span class="token punctuation">,</span>
    passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'provider'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">successRedirect</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">failureRedirect</span><span class="token operator">:</span> <span class="token string">'/login'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="链接"><a href="#链接" class="header-anchor">#</a> 链接</h3> <p>在网页中可以放置一个链接或者按钮，它们在点击时将开始认证过程。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/auth/provider<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>使用 OAuth 提供者登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="oauth-2-0"><a href="#oauth-2-0" class="header-anchor">#</a> OAuth 2.0</h4> <p>OAuth 2.0 是 OAuth 1.0 的接班人，被设计来克服早期版本的已知缺陷。认证流程本质上是一样的。用户首先被重定向到服务提供者处授权，授权后，用户携带一个能够获取访问 token 的码被重定向回应用。请求访问的应用（作为客户端）由 ID 和 秘钥标识。</p> <h3 id="配置-5"><a href="#配置-5" class="header-anchor">#</a> 配置</h3> <p>使用通用 OAuth 2.0 策略时，client ID，client secret 和 endpoints 作为选项定义。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> passport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    OAuth2Strategy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport-oauth'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>OAuth2Strategy<span class="token punctuation">;</span>

passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'provider'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2Strategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">authorizationURL</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tokenURL</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">clientID</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">clientSecret</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">callbackURL</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">accessToken<span class="token punctuation">,</span> refreshToken<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    User<span class="token punctuation">.</span><span class="token function">findOrCreate</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>基于 OAuth 2.0 策略的验证回调接受 <code>accessToken</code>，<code>refreshToken</code> 和 <code>profile</code> 参数。<code>refreshToken</code> 能够用来获取新的访问 token，也有可能是 <code>undefined</code> 如果提供者不发行刷新 token。<code>profile</code> 将包含服务提供者提供的用户个人信息。查看 <a href="http://www.passportjs.org/guide/profile/" target="_blank" rel="noopener noreferrer">User Profile<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 了解更多信息。</p> <h3 id="路由-4"><a href="#路由-4" class="header-anchor">#</a> 路由</h3> <p>OAuth 2.0 认证需要两个路由。第一个路由重定向用户到服务提供者。第二个路由是个 URL，用户在提供者处认证后重定向的URL。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 重定向用户到 OAuth 2.0 认证提供者。</span>
<span class="token comment">// 认证完成后，提供者将重定向用户返回应用：</span>
<span class="token comment">// /auth/provider/callback</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/auth/provider'</span><span class="token punctuation">,</span> passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'provider'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// OAuth 2.0 提供者已经重定向用户到应用中。</span>
<span class="token comment">// 通过尝试获取访问 token 来完成认证过程。</span>
<span class="token comment">// 如果已授权，用户将登录。</span>
<span class="token comment">// 否则，认证失败。</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/auth/provider/callback'</span><span class="token punctuation">,</span> 
    passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'provider'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">successRedirect</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">failureRedirect</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

</code></pre></div><h3 id="作用域"><a href="#作用域" class="header-anchor">#</a> 作用域</h3> <p>当使用 OAuth 2.0 请求访问时，访问的作用域通过 scope 选项控制。</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/auth/provider'</span><span class="token punctuation">,</span>
    passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'provider'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">scope</span><span class="token operator">:</span> <span class="token string">'email'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>能够使用数组定义多个作用域。</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/auth/provider'</span><span class="token punctuation">,</span>
    passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'provider'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">scope</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token string">'sms'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p><code>scope</code> 选项的值时提供者特定的。详情参考提供者文档，了解支持的作用域。</p> <h3 id="链接-2"><a href="#链接-2" class="header-anchor">#</a> 链接</h3> <p>Web 页面的链接或者按钮，当点击的时候能够开始认证过程。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;/auth/provider&quot;</span><span class="token operator">&gt;</span>使用 OAuth <span class="token number">2.0</span> 提供者登录<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
</code></pre></div><h2 id="用户个人信息"><a href="#用户个人信息" class="header-anchor">#</a> 用户个人信息</h2> <p>当使用第三方服务，例如 Facebook 或者 Twitter 认证时，用户个人信息通常会可用。每个服务倾向于有个不同的方式编码这些信息。为了更易集成，Passport 尽可能规范化个人信息。</p> <p>规范化个人信息符合 [Joseph Smarr][schema-author] 建立的<a href="https://tools.ietf.org/html/draft-smarr-vcarddav-portable-contacts-00" target="_blank" rel="noopener noreferrer">联系模式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。下表概述了可用的公共字段。</p> <p><code>provider</code> {String}</p> <p>  提供者，用户认证的地方（<code>facebook</code>, <code>twitter</code>, 等）。</p> <p><code>id</code> {String}</p> <p>  用户的唯一标识，通常由服务提供者生成。</p> <p><code>displayName</code> {String}</p> <p>  用户名，适合展示</p> <p><code>name</code> {Object}</p> <p><code>familyName</code> 用户的 family name，或者大多数西方语言的 “last name”。</p> <p><code>givenName</code> 用户的 given name，或者大多数西方语言的 “first name”。</p> <p><code>middleName</code> 用户的 middle name。</p> <p><code>emails</code> {Array} [n]</p> <p><code>value</code> {String} 地址的 email 地址。</p> <p><code>type</code> {String} email 地址的类型（家里、工作单位，等）。</p> <p><code>photos</code> {Array} [n]</p> <p><code>value</code> {String} 图片地址</p> <p>注意，上面的字段不是全部都能从每个服务提供者处获得。一些提供者可能包含没在这列出的其他信息。参考特定提供者的文档来了解更多详细信息。</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Signature/Function" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/zh-CN/docs/Glossary/Signature/Function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> function signature</li></ul> <h2 id="感谢阅读"><a href="#感谢阅读" class="header-anchor">#</a> 感谢阅读</h2> <p>感谢你阅读到这里，翻译的不好的地方，还请指点。希望我的内容能让你受用，再次感谢。<a href="https://llccing.github.io/FrontEnd/" target="_blank" rel="noopener noreferrer">by llccing 千里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2025-03-22 06:51:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/FrontEnd/lib/nestjs/01-OAuth_2.0.html" class="prev">
        OAuth 2.0
      </a></span> <span class="next"><a href="/FrontEnd/lib/nestjs/passport/02-providers.html">
        [译]Passport 文档（二）提供者
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/FrontEnd/assets/js/app.f790006c.js" defer></script><script src="/FrontEnd/assets/js/2.3f4cbde9.js" defer></script><script src="/FrontEnd/assets/js/1.4a225f88.js" defer></script><script src="/FrontEnd/assets/js/237.273f32ea.js" defer></script>
  </body>
</html>

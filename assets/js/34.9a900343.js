(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{237:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"è¯‘-åœ¨-angular-ä¸­ä½¿ç”¨æ‹¦æˆªå™¨çš„æ–¹å¼-top-10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¯‘-åœ¨-angular-ä¸­ä½¿ç”¨æ‹¦æˆªå™¨çš„æ–¹å¼-top-10","aria-hidden":"true"}},[t._v("#")]),t._v(" [è¯‘]åœ¨ Angular ä¸­ä½¿ç”¨æ‹¦æˆªå™¨çš„æ–¹å¼ Top 10")]),t._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://medium.com/angular-in-depth/top-10-ways-to-use-interceptors-in-angular-db450f8a62d6",target:"_blank",rel:"noopener noreferrer"}},[t._v("åŸæ–‡åœ¨æ­¤ï¼Œä¹Ÿå¯ä»¥çœ‹åŸæ–‡å“¦"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("æœ‰è®¸å¤šç§æ–¹å¼ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œæˆ‘ç¡®å®šæˆ‘ä»¬å¤§å¤šæ•°äººä½¿ç”¨çš„å¾ˆæµ…æ˜¾ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä»‹ç»åœ¨ Angular ä¸­æˆ‘æœ€å–œæ¬¢çš„ 10 ç§ä½¿ç”¨æ‹¦æˆªå™¨çš„æ–¹å¼ã€‚")]),t._v(" "),a("p",[t._v("æˆ‘ä½¿ä¾‹å­å°½å¯èƒ½çš„ç®€æ´ã€‚æˆ‘å¸Œæœ›ä»–ä»¬èƒ½å¤Ÿå¯å‘ä½ ä»¬å»æ€è€ƒä½¿ç”¨æ‹¦æˆªå™¨çš„æ–°æ–¹å¼ã€‚è¿™ç¯‡æ–‡ç« ä¸æ˜¯å…³äºæ‹¦æˆªå™¨æ•™å­¦çš„ï¼Œå› ä¸ºå·²ç»æœ‰å¾ˆå¤šå¥½çš„æ–‡ç« äº†ã€‚ä½†æ˜¯ï¼Œåœ¨å¼€å§‹å€’æ•°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ä»¥ä¸€äº›åŸºç¡€çš„çŸ¥è¯†ç‚¹å¼€å§‹ã€‚")]),t._v(" "),a("h2",{attrs:{id:"httpinterceptor-101"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#httpinterceptor-101","aria-hidden":"true"}},[t._v("#")]),t._v(" HttpInterceptor 101")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://angular.io/api/common/http/HttpInterceptor",target:"_blank",rel:"noopener noreferrer"}},[t._v("HttpInterceptor"),a("OutboundLink")],1),t._v(" æ˜¯åœ¨ Angular 4.3 å¼•å…¥ã€‚å®ƒæä¾›ä¸€ç§æ–¹å¼æ‹¦æˆª HTTP è¯·æ±‚å’Œå“åº”ï¼Œåœ¨ä¼ é€’ä»–ä»¬ä¹‹å‰è½¬æ¢æˆ–è€…å¤„ç†ä»–ä»¬ã€‚")]),t._v(" "),a("blockquote",[a("p",[t._v("å°½ç®¡æ‹¦æˆªå™¨èƒ½å¤Ÿæ”¹å˜è¯·æ±‚å’Œå“åº”ï¼Œä½†æ˜¯ "),a("a",{attrs:{href:"https://angular.io/api/common/http/HttpRequest",target:"_blank",rel:"noopener noreferrer"}},[t._v("HttpRequest"),a("OutboundLink")],1),t._v(" å’Œ "),a("a",{attrs:{href:"https://angular.io/api/common/http/HttpResponse",target:"_blank",rel:"noopener noreferrer"}},[t._v("HttpResponse"),a("OutboundLink")],1),t._v(" å®ä¾‹å±æ€§æ˜¯ "),a("code",[t._v("åªè¯»")]),t._v(" çš„ï¼Œä»è€Œä½¿å®ƒä»¬åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¸å¯å˜ã€‚ â€” Angular Docs")])]),t._v(" "),a("p",[t._v("è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¯èƒ½æƒ³è¦åœ¨æŸä¸ªè¯·æ±‚ç¬¬ä¸€æ¬¡æ²¡æˆåŠŸåé‡è¯•ã€‚ä¸å˜æ€§ç¡®ä¿äº†æ‹¦æˆªå™¨é“¾èƒ½å¤Ÿå¤šæ¬¡é‡æ–°å¤„ç†ç›¸åŒçš„è¯·æ±‚ã€‚")]),t._v(" "),a("p",[t._v("ä½ å¯ä»¥ä½¿ç”¨å¤šä¸ªæ‹¦æˆªå™¨ï¼Œä½†æ˜¯è¿™ä¸ªè®°å¿ƒä¸­ï¼š")]),t._v(" "),a("blockquote",[a("p",[t._v("Angular é€šè¿‡ä½ å®šä¹‰ä»–ä»¬çš„é¡ºåºåº”ç”¨æ‹¦æˆªå™¨ã€‚å¦‚æœä½ å®šä¹‰çš„æ‹¦æˆªå™¨çš„é¡ºåºæ˜¯ A->B->Cï¼Œè¯·æ±‚å°†æŒ‰ A->B->C çš„é¡ºåºæµå…¥ï¼Œå“åº”å°†æŒ‰ C->B->A çš„é¡ºåºæµå…¥ã€‚")])]),t._v(" "),a("blockquote",[a("p",[t._v("ä¹‹åï¼Œä¸èƒ½æ”¹å˜é¡ºåºæˆ–è€…ç§»é™¤æ‹¦æˆªå™¨ã€‚å¦‚æœä½ éœ€è¦åŠ¨æ€å¯ç”¨ã€ç¦ç”¨æ‹¦æˆªå™¨ï¼Œä½ ä¸å¾—ä¸åœ¨æ‹¦æˆªå™¨æœ¬èº«å¢åŠ è¿™ä¸ªåŠŸèƒ½ã€‚â€” Angular Docs")])]),t._v(" "),a("p",[t._v("åœ¨ç¤ºä¾‹ APP ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†å…¨éƒ¨æ‹¦æˆªå™¨ï¼Œä½†æ˜¯ä¸€æ¬¡ä»…ä½¿ç”¨ä¸€ä¸ªã€‚è¿™é€šè¿‡æ£€æŸ¥è·¯å¾„å®ç°ï¼ˆ"),a("a",{attrs:{href:"https://github.com/melcor76/interceptors/blob/172be0444d505c6164ff506ab311a4966ce8c78f/src/app/interceptors/auth.interceptor.ts#L30",target:"_blank",rel:"noopener noreferrer"}},[t._v("ä»£ç åœ¨è¿™é‡Œ"),a("OutboundLink")],1),t._v("ï¼‰ã€‚å¦‚æœä¸æ˜¯æˆ‘ä»¬æ‰¾çš„è¯·æ±‚ï¼Œæˆ‘ä»¬é€šè¿‡ "),a("code",[t._v("next.handle(req)")]),t._v(" ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ã€‚")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/01.png",alt:"01"}})]),t._v(" "),a("p",[t._v("æ‹¦æˆªå™¨çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ä»–ä»¬èƒ½å¤Ÿ"),a("code",[t._v("ä¸€èµ·å¤„ç†è¯·æ±‚å’Œå“åº”")]),t._v("ã€‚æˆ‘ä»¬å°†çœ‹åˆ°ï¼Œè¿™ç»™æˆ‘ä»¬å¾ˆå¥½çš„å¯èƒ½æ€§ã€‚")]),t._v(" "),a("p",[t._v("æ›´å¤šæ·±åº¦çŸ¥è¯†ï¼Œå¯ä»¥çœ‹ "),a("a",{attrs:{href:"https://medium.com/u/bd29063a4857?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("Max Koretskyi aka Wizard"),a("OutboundLink")],1),t._v("  è¿™ç¯‡å¾ˆæ£’çš„æ–‡ç« :")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://medium.com/angular-in-depth/insiders-guide-into-interceptors-and-httpclient-mechanics-in-angular-103fbdb397bf",target:"_blank",rel:"noopener noreferrer"}},[t._v("Angular æ‹¦æˆªå™¨å†…éƒ¨æŒ‡å—å’Œ HttpClient æœºåˆ¶"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("åœ¨ç¤ºä¾‹çš„ HTTP è¯·æ±‚ä¸­ï¼Œæˆ‘ä½¿ç”¨äº† "),a("a",{attrs:{href:"https://jsonplaceholder.typicode.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSONPlaceholder"),a("OutboundLink")],1),t._v(" è¿™ä¸ªç½‘ç«™ã€‚å¦‚æœä½ æƒ³çœ‹ä»£ç ï¼Œä½ å¯ä»¥ä»è¿™é‡Œæ‰¾åˆ°ï¼š")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("10.x ç‰ˆæœ¬ï¼Œè¯‘è€…ç‰ˆæœ¬\n"),a("a",{attrs:{href:"https://github.com/llccing-demo/ng-interceptors",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub ç¤ºä¾‹ä»£ç  10.xç‰ˆæœ¬"),a("OutboundLink")],1),t._v(" ğŸ“œ\n"),a("a",{attrs:{href:"https://stackblitz.com/github/",target:"_blank",rel:"noopener noreferrer"}},[t._v("StackBlitz çº¿ä¸Šè¿è¡Œ"),a("OutboundLink")],1),t._v(" ğŸƒ")])]),t._v(" "),a("li",[a("p",[t._v("8.x ç‰ˆæœ¬ï¼Œä½œè€…ç‰ˆæœ¬\n"),a("a",{attrs:{href:"https://github.com/melcor76/interceptors",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub ç¤ºä¾‹ä»£ç  8.xç‰ˆæœ¬"),a("OutboundLink")],1),t._v(" ğŸ“œ\n"),a("a",{attrs:{href:"https://stackblitz.com/github/melcor76/interceptors",target:"_blank",rel:"noopener noreferrer"}},[t._v("StackBlitz çº¿ä¸Šè¿è¡Œ"),a("OutboundLink")],1),t._v(" ğŸƒ")])])]),t._v(" "),a("p",[t._v("ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¼€å§‹å€’æ•°å§ï¼")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/02.jfif",alt:"02"}})]),t._v(" "),a("h2",{attrs:{id:"_10-url"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-url","aria-hidden":"true"}},[t._v("#")]),t._v(" 10.URL")]),t._v(" "),a("p",[t._v("æ“çºµ URLã€‚å½“æˆ‘å¤§å£°è¯´å‡ºæ¥æ—¶ï¼Œå¬èµ·æ¥æœ‰äº›é£é™©ï¼Œä½†æ˜¯è®©æˆ‘ä»¬çœ‹ä¸‹åœ¨æ‹¦æˆªå™¨ä¸‹åšè¿™ä¸ªäº‹æƒ…æ˜¯å¤šä¹ˆç®€å•ã€‚")]),t._v(" "),a("p",[t._v("ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³ä» HTTP å˜ä¸º HTTPSã€‚")]),t._v(" "),a("p",[t._v("å°±åƒå…‹éš†è¯·æ±‚åŒæ—¶ä½¿ç”¨ https:// æ›¿æ¢ http:// ä¸€æ ·ç®€å•ã€‚ç„¶åæˆ‘ä»¬å°†å…‹éš†çš„ HTTPS è¯·æ±‚å‘é€åˆ°ä¸‹ä¸€ä¸ª handlerã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å…‹éš†è¯·æ±‚ï¼ŒåŒæ—¶ä½¿ç”¨ https:// æ›¿æ¢ http://")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" httpsReq "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("httpsReq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¾ç½® URL ä¸º HTTPï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ£€æŸ¥è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬èƒ½çœ‹è§å®ƒå·²ç»å˜æˆäº† HTTPSã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("http://jsonplaceholder.typicode.com/todos/1")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/03.png",alt:"03"}})]),t._v(" "),a("p",[t._v("è‡ªåŠ¨åŒ–é­”æœ¯ httpsï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªä¸é«˜æ˜å‘¢ã€‚é€šå¸¸ä½ å¯ä»¥é€šè¿‡ web æœåŠ¡å™¨è®¾ç½®è¿™äº›äº‹æƒ…ã€‚æˆ–è€…ä½ æƒ³åœ¨å¼€å‘ç¯å¢ƒä» HTTP åˆ‡æ¢åˆ° HTTPSï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ª "),a("a",{attrs:{href:"https://angular.io/cli/serve",target:"_blank",rel:"noopener noreferrer"}},[t._v("CLI"),a("OutboundLink")],1),t._v(":")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("ng serve "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ssl\n")])])]),a("p",[t._v("ç±»ä¼¼ï¼Œä½ å¯ä»¥ä¿®æ”¹ä¸€ç‚¹ URLï¼Œå¹¶ä¸”æˆå®ƒä¸º API å‰ç¼€æ‹¦æˆªå™¨ï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" environment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serverUrl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("æˆ–è€…ä½ å¯ä»¥å†æ¬¡é€šè¿‡ CLI æ¥å®ç°ï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("ng serve "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" serve"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" base"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("href "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n")])])]),a("p",[t._v("æ„Ÿè°¢ "),a("a",{attrs:{href:"https://medium.com/u/d91c7d086b4b?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("David Herges"),a("OutboundLink")],1),t._v(" çš„ CLI æç¤ºã€‚")]),t._v(" "),a("h2",{attrs:{id:"_9-loader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-loader","aria-hidden":"true"}},[t._v("#")]),t._v(" 9.Loader")]),t._v(" "),a("p",[t._v("å½“æˆ‘ä»¬ç­‰å¾…å“åº”æ—¶ï¼Œæ¯ä¸ªäººéƒ½å¸Œæœ›çœ‹è§å‘½è¿çš„çººçº±è½®ï¼ˆè¡¨ç¤ºæ—‹è½¬çš„loadingï¼‰ã€‚åªè¦åœ¨è¯·æ±‚æ´»è·ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨æ‹¦æˆªå™¨ä¸­ç»Ÿä¸€è®¾ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿçœ‹è§ loader äº†ã€‚")]),t._v(" "),a("p",[t._v("é¦–å…ˆï¼Œæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ loader æœåŠ¡ï¼Œè¿™æ ·å°±æœ‰äº†å±•ç¤ºå’Œéšè— loader çš„åŠŸèƒ½ã€‚åœ¨å¤„ç†è¯·æ±‚å‰ï¼Œæˆ‘ä»¬è°ƒç”¨"),a("code",[t._v("å±•ç¤º")]),t._v("æ–¹æ³•å¹¶é€šè¿‡ finalize å®Œæˆå"),a("code",[t._v("éšè—")]),t._v(" loaderã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" loaderService "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("injector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LoaderService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nloaderService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("show")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("finalize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" loaderService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hide")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("è¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œåœ¨çœŸå®çš„è§£å†³æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘åˆ°ä¼šæœ‰å¤šä¸ª HTTP è¯·æ±‚è¢«æ‹¦æˆªã€‚è¿™å¯ä»¥é€šè¿‡ä¸€ä¸ªè¯·æ±‚ï¼ˆ+1ï¼‰å“åº”ï¼ˆ-1ï¼‰çš„è®¡æ•°å™¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚")]),t._v(" "),a("p",[t._v("å½“ç„¶ï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ªå»¶è¿Ÿæ¥è®©æˆ‘ä»¬æœ‰æ—¶é—´èƒ½å¤Ÿçœ‹åˆ° loaderã€‚")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/04.gif",alt:"04"}})]),t._v(" "),a("p",[t._v("å…¨å±€çš„ loader å¬èµ·æ¥æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ï¼Œä½†æ˜¯è¿™ä¸ªä¸ºä»€ä¹ˆä¸åœ¨åˆ—è¡¨ä¸­å‘¢ï¼Ÿå¯èƒ½å®ƒé€‚åˆç‰¹å®šçš„åº”ç”¨ï¼Œä½†æ˜¯å¦‚æœä½ åŒæ—¶åŠ è½½å¤šä¸ªï¼Œä½ å¯èƒ½æƒ³è¦å¯¹ loader å®šåˆ¶åŒ–ã€‚")]),t._v(" "),a("p",[t._v("æˆ‘å°†ç»™ä½ ç•™ä¸‹ä¸€äº›æ€è€ƒçš„ç©ºé—´ã€‚å¦‚æœä½ ç”¨ "),a("a",{attrs:{href:"https://www.learnrxjs.io/operators/transformation/switchmap.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("switchMap"),a("OutboundLink")],1),t._v(" å»å–æ¶ˆè¯·æ±‚å°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ")]),t._v(" "),a("h2",{attrs:{id:"_8-è½¬æ¢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-è½¬æ¢","aria-hidden":"true"}},[t._v("#")]),t._v(" 8.è½¬æ¢")]),t._v(" "),a("p",[t._v("å½“ API è¿”å›ä¸€ä¸ªæˆ‘ä»¬ä¸èµåŒçš„æ ¼å¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨æ‹¦æˆªå™¨å»æ ¼å¼åŒ–æˆæˆ‘ä»¬æƒ³è¦çš„æ ·å­ã€‚")]),t._v(" "),a("p",[t._v("è¿™èƒ½å¤Ÿä» XML è½¬æ¢åˆ° JSONï¼Œæˆ–è€…åƒä¾‹å­ä¸­çš„å±æ€§åå­—ä»å¤§é©¼å³°æ‹¼å†™åˆ°å°é©¼å³°æ‹¼å†™ã€‚å¦‚æœåç«¯ä¸å…³å¿ƒ JSON/JS è½¬æ¢ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨æ‹¦æˆªå™¨å°†å…¨éƒ¨å±æ€§åé‡å‘½åä¸ºå°é©¼å³°ã€‚")]),t._v(" "),a("p",[t._v("æ£€æŸ¥æ˜¯å¦æœ‰ npm åŒ…èƒ½å¤Ÿä¸ºä½ å®Œæˆç¹é‡çš„å·¥ä½œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä½¿ç”¨ "),a("a",{attrs:{href:"https://www.npmjs.com/package/lodash",target:"_blank",rel:"noopener noreferrer"}},[t._v("loadsh"),a("OutboundLink")],1),t._v(" çš„ "),a("a",{attrs:{href:"https://lodash.com/docs#mapKeys",target:"_blank",rel:"noopener noreferrer"}},[t._v("mapKeys"),a("OutboundLink")],1),t._v(" å’Œ "),a("a",{attrs:{href:"https://lodash.com/docs#camelCase",target:"_blank",rel:"noopener noreferrer"}},[t._v("camelCase"),a("OutboundLink")],1),t._v("ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpEvent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" camelCaseObject "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mapKeys")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("k")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("camelCase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" modEvent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" camelCaseObjec "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" modEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("è¿™ä¸ªäº‹æƒ…é€šå¸¸æ˜¯åç«¯æ¥åšï¼Œæ‰€ä»¥æˆ‘é€šå¸¸ä¸è¿™ä¹ˆåšã€‚ä½†æ˜¯å°†è¿™ä¸ªåŠ å…¥åˆ°çš„å…µå™¨åº“ï¼Œè¿™æ ·ä½ éœ€è¦çš„æ—¶å€™å°±èƒ½å¤Ÿä½¿ç”¨äº†ã€‚")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/05.gif",alt:"05"}})]),t._v(" "),a("h2",{attrs:{id:"_7-headers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-headers","aria-hidden":"true"}},[t._v("#")]),t._v(" 7.Headers")]),t._v(" "),a("p",[t._v("é€šè¿‡æ“çºµ headers æˆ‘ä»¬èƒ½å¤Ÿåšè®¸å¤šäº‹ï¼Œä¾‹å¦‚ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("è®¤è¯ï¼ˆauthenticationï¼‰/ æˆæƒï¼ˆauthorizationï¼‰")]),t._v(" "),a("li",[t._v("ç¼“å­˜è¡Œä¸ºï¼›ä¾‹å¦‚ï¼ŒIf-Modified-Since")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Cross-site_request_forgery",target:"_blank",rel:"noopener noreferrer"}},[t._v("XSRF"),a("OutboundLink")],1),t._v(" ä¿æŠ¤")])]),t._v(" "),a("p",[t._v("æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡æ‹¦æˆªå™¨è½»è€Œæ˜“ä¸¾çš„æ·»åŠ  headersã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("cosnt modified "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    setHeaders"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-Man"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wolverine"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("modified"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("ç„¶åæˆ‘ä»¬åœ¨å¼€å‘è€…å·¥å…·ä¸­å°±èƒ½å¤Ÿçœ‹åˆ°å®ƒè¢«æ·»åŠ åˆ°äº†è¯·æ±‚å¤´ä¸­ã€‚")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/06.png",alt:"06"}})]),t._v(" "),a("p",[t._v("Angular ä½¿ç”¨æ‹¦æˆªå™¨æ¥é˜²èŒƒ "),a("a",{attrs:{href:"https://angular.io/guide/http#security-xsrf-protection",target:"_blank",rel:"noopener noreferrer"}},[t._v("è·¨ç«™è¯·æ±‚ä¼ªé€ "),a("OutboundLink")],1),t._v("ï¼ˆXSRFï¼‰ã€‚é€šè¿‡è¯»å– cookie ä¸­çš„ "),a("code",[t._v("XSRF-TOKEN")]),t._v(" å¹¶è®¾ç½®ä¸€ä¸ª "),a("code",[t._v("X-XSRF-TOKEN")]),t._v(" è¯·æ±‚å¤´æ¥å®ç°ã€‚ä»…ä»…è¿è¡Œåœ¨ä½ çš„åŸŸåä¸­çš„ä»£ç æ‰èƒ½å¤Ÿè¯»å– cookieï¼Œè¿™æ ·åç«¯èƒ½å¤Ÿç¡®å®š HTTP è¯·æ±‚æ¥è‡ªå·±å®¢æˆ·ç«¯ç¨‹åºè€Œä¸æ˜¯æ”»å‡»è€…ã€‚")]),t._v(" "),a("p",[t._v("å¦‚ä½ æ‰€è§ï¼Œåœ¨æ‹¦æˆªå™¨ä¸­èƒ½å¤Ÿç›´æ¥æ“çºµ headersã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†çœ‹åˆ°æ›´å¤šæ“çºµ headers çš„ä¾‹å­ã€‚")]),t._v(" "),a("h2",{attrs:{id:"_6-é€šçŸ¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-é€šçŸ¥","aria-hidden":"true"}},[t._v("#")]),t._v(" 6.é€šçŸ¥")]),t._v(" "),a("p",[t._v("è¿™é‡Œæœ‰å¾ˆå¤šä¸åŒçš„ä¾‹å­ç”¨äºå±•ç¤ºæ¶ˆæ¯ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæ¯æ¬¡ä»æœåŠ¡å™¨è·å¾— 201 åˆ›å»ºçŠ¶æ€æ—¶ï¼Œæˆ‘ä¼šå±•ç¤ºâ€œObject created.â€ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hadle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpEvent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpResponse")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("201")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("toastr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("success")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Object created.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("æˆ–è€…æˆ‘ä»¬æ£€æŸ¥å¯¹è±¡çš„ç±»å‹æ¥å±•ç¤ºâ€œType createdâ€ã€‚æˆ–è€…é€šè¿‡å°†æ•°æ®å’Œæ¶ˆæ¯åŒ…è£¹åˆ°å¯¹è±¡ä¸­åˆ›å»ºä¸€ä¸ªå®šåˆ¶çš„æ¶ˆæ¯ã€‚")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    message"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/08.gif",alt:"08"}})]),t._v(" "),a("p",[t._v("å½“å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ‹¦æˆªå™¨å±•ç¤ºé€šçŸ¥ã€‚")]),t._v(" "),a("h2",{attrs:{id:"_5-errors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-errors","aria-hidden":"true"}},[t._v("#")]),t._v(" 5.Errors")]),t._v(" "),a("p",[t._v("åœ¨è¿™ä¸ªæ‹¦æˆªå™¨ä¸­æˆ‘ä»¬å®ç°äº†ä¸¤ä¸ªå…³äºé”™è¯¯çš„ç”¨ä¾‹ã€‚")]),t._v(" "),a("p",[t._v("é¦–å…ˆï¼Œæˆ‘ä»¬èƒ½å¤Ÿ"),a("code",[t._v("é‡è¯• HTTP è¯·æ±‚")]),t._v("ã€‚ä¾‹å¦‚ï¼Œç½‘ç»œä¸­æ–­åœ¨ç§»åŠ¨ç«¯åœºæ™¯å¾ˆå¸¸è§ï¼Œå†è¯•ä¸€æ¬¡å¯èƒ½ä¼šæˆåŠŸã€‚å€¼å¾—è€ƒè™‘çš„äº‹æƒ…æ˜¯åœ¨æ”¾å¼ƒä¹‹å‰çš„é‡è¯•æ¬¡æ•°ã€‚æˆ‘ä»¬åº”è¯¥åœ¨é‡è¯•å‰ç­‰å¾…å—ï¼Œæˆ–è€…ç«‹å³é‡è¯•ï¼Ÿ")]),t._v(" "),a("p",[t._v("å¯¹äºè¿™ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ RxJS ä¸­çš„ "),a("a",{attrs:{href:"https://rxjs-dev.firebaseapp.com/api/operators/retry",target:"_blank",rel:"noopener noreferrer"}},[t._v("retry"),a("OutboundLink")],1),t._v(" æ“ä½œç¬¦é‡æ–°è®¢é˜… observableã€‚HttpClient æ–¹æ³•è°ƒç”¨çš„é‡æ–°è®¢é˜…å…·æœ‰å†æ¬¡å‘å‡º HTTP è¯·æ±‚çš„æ•ˆæœã€‚")]),t._v(" "),a("p",[t._v("è¿™ç§è¡Œä¸ºçš„æ›´é«˜çº§çš„ç¤ºä¾‹ï¼š")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.learnrxjs.io/operators/error_handling/retrywhen.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("å½“å‘ç”Ÿé”™è¯¯æ—¶ï¼ŒåŸºäºè‡ªå®šä¹‰æ ‡å‡†é‡è¯• observable åºåˆ—"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://medium.com/angular-in-depth/power-of-rxjs-when-using-exponential-backoff-a4b8bde276b0",target:"_blank",rel:"noopener noreferrer"}},[t._v("å½“ä½¿ç”¨å¹‚ç­‰å›é€€æ—¶ rxjs çš„èƒ½åŠ›"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("ç¬¬äºŒç‚¹ï¼Œæ£€æŸ¥å¼‚å¸¸çš„çŠ¶æ€ã€‚åŸºäºçŠ¶æ€ï¼Œå†³å®šåº”è¯¥åšä»€ä¹ˆã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("retry")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("catchError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpErrorResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("401")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 401 åœ¨ auth.interceptor ä¸­å¤„ç†äº†")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("toastr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("throwError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨æ£€æŸ¥é”™è¯¯çŠ¶æ€å‰ï¼Œæˆ‘ä»¬é‡è¯•äº†ä¸¤æ¬¡ã€‚å¦‚æœçŠ¶æ€ä¸æ˜¯ 401ï¼Œæˆ‘ä»¬å·²å¼¹å‡ºï¼ˆtoastrï¼‰çš„å½¢å¼å±•ç¤ºé”™è¯¯ã€‚æ‰€æœ‰çš„é”™è¯¯å°†é‡æ–°æŠ›å‡ºæ¥è¿›ä¸€æ­¥å¤„ç†ã€‚")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/09.png",alt:"09"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/10.png",alt:"10"}})]),t._v(" "),a("p",[t._v("æ›´å¤šçš„é”™è¯¯å¤„ç†çš„çŸ¥è¯†ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æˆ‘æ—©æœŸçš„æ–‡ç« ï¼š")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://medium.com/angular-in-depth/expecting-the-unexpected-best-practices-for-error-handling-in-angular-21c3662ef9e4",target:"_blank",rel:"noopener noreferrer"}},[t._v("æœŸå¾…æ„å¤– -- Angular é”™è¯¯å¤„ç†çš„æœ€ä½³å®è·µ"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"_4-åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-åˆ†æ","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.åˆ†æ")]),t._v(" "),a("p",[t._v("å› ä¸ºæ‹¦æˆªå™¨èƒ½å¤ŸåŒæ—¶å¤„ç†è¯·æ±‚å’Œå“åº”ï¼Œèƒ½å¤Ÿåœ¨ä¸€æ¬¡å®Œæ•´çš„ HTTP æ“ä½œä¸­è®¡æ—¶å’Œè®°æ—¥å¿—ã€‚æ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿæ•è·è¯·æ±‚å’Œå“åº”æ—¶é—´ï¼Œè®°å½•ç»è¿‡çš„æ—¶é—´ç»“æœã€‚")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" started "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ok"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpEvent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" ok "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpResponse")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'successed'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpEventResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" ok "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'failed'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å“åº” observable ç»“æŸæˆ–è€…å®Œæˆçš„æ—¶å€™è®°æ—¥å¿—")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("finalize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" elapsed "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" started"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(' "')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urlWithParams"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" ')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("ok"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" in ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("elapsed"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" ms.")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("è¿™æœ‰è®¸å¤šä¸­å¯èƒ½ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬èƒ½è®°å½•åˆ†ææ—¥å¿—åˆ°æ•°æ®åº“ä¸­åšç»Ÿè®¡ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¾“å‡ºåˆ° consoleã€‚")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/11.png",alt:"11"}})]),t._v(" "),a("h2",{attrs:{id:"_3-ä¼ªé€ åç«¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä¼ªé€ åç«¯","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. ä¼ªé€ åç«¯")]),t._v(" "),a("p",[t._v("å½“æ²¡æœ‰åç«¯æœåŠ¡æ—¶ï¼Œå¯ä»¥åœ¨å¼€å‘ä¸­æ¨¡æ‹Ÿæˆ–è€…ä¼ªè£…åç«¯ã€‚ä½ ä¹Ÿå¯ä»¥å°†å…¶ç”¨äº StackBlitz ä¸­æ‰˜ç®¡çš„ä»£ç ã€‚")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬åŸºäºè¯·æ±‚æ¨¡æ‹Ÿè¿”å›ï¼Œç„¶åè¿”å›ä¸€ä¸ª HttpResponse observableã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    firstName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mock'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    lastName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Faker'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" status"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" body "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/12.gif",alt:"12"}})]),t._v(" "),a("h2",{attrs:{id:"_2-ç¼“å­˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç¼“å­˜","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. ç¼“å­˜")]),t._v(" "),a("p",[t._v("å› ä¸ºæ‹¦æˆªå™¨èƒ½å¤Ÿè‡ªå·±å¤„ç†è¯·æ±‚ï¼Œæ²¡æœ‰è½¬å‘åˆ° "),a("code",[t._v("next.handle()")]),t._v("ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨è¿™ä¸€ç‚¹æ¥ç¼“å­˜è¯·æ±‚ã€‚")]),t._v(" "),a("p",[t._v("åœ¨ key-value map æ„æˆçš„ç¼“å­˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ URL ä½œä¸º keyã€‚å¦‚æœæˆ‘ä»¬å“åº”åœ¨ map ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ "),a("code",[t._v("next")]),t._v(" handler è¿”å›è¿™ä¸ª observable å“åº”ã€‚")]),t._v(" "),a("p",[t._v("å½“ä½ å·²ç»æœ‰å“åº”ç¼“å­˜æ—¶ï¼Œä½ ä¸éœ€è¦ä¸€è·¯èµ°åˆ°åç«¯ï¼Œè¿™ä¸ªæå‡äº†æ€§èƒ½ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Injectable "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@angular/core'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" HttpEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HttpRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HttpHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HttpInterceptor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HttpResponse "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@angular/common/http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rxjs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" tap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" shareReplay "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rxjs/operators'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n@"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Injectable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CacheInterceptor")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpInterceptor")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" cache "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" any"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("intercept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpRequest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Observable"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("HttpEvent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cacheResponse "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("å¦‚æœæˆ‘ä»¬è¿è¡Œè¿™ä¸ªè¯·æ±‚ï¼Œæ¸…ç©ºå“åº”ç„¶åå†æ¬¡è¿è¡Œå°†ä½¿ç”¨ç¼“å­˜ã€‚")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/13.gif",alt:"13"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/14.png",alt:"14"}})]),t._v(" "),a("p",[t._v("å¦‚æœæ•°æ®æ›´æ–°äº†ï¼Œä½ éœ€è¦ä½¿ç¼“å­˜å¤±æ•ˆï¼Œè¿™ä¼šå¼•å…¥ä¸€äº›å¤æ‚æ€§ã€‚ä½†æ˜¯ç°åœ¨ä¸ç”¨æ‹…å¿ƒï¼ç¼“å­˜ç”Ÿæ•ˆçš„æ—¶å€™æ˜¯çœŸçš„çˆ½ï¼")]),t._v(" "),a("p",[t._v("å…³äºç¼“å­˜çš„æ›´å¤šçŸ¥è¯†å¯ä»¥è¯» "),a("a",{attrs:{href:"https://medium.com/u/6317765dd4e6?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("Dominic E."),a("OutboundLink")],1),t._v(" çš„è¿™ç¯‡å¾ˆå¸®çš„æ–‡ç« ï¼š")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.thoughtram.io/angular/2018/03/05/advanced-caching-with-rxjs.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("RxJS é«˜çº§ç¼“å­˜"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"_1-è®¤è¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-è®¤è¯","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.è®¤è¯")]),t._v(" "),a("p",[t._v("æ¸…å•ä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯è®¤è¯ï¼å¯¹äºå¾ˆå¤šåº”ç”¨æ¥è¯´ä»–æ˜¯åŸºæœ¬çš„ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†é€‚å½“çš„è®¤è¯ç³»ç»Ÿã€‚è¿™æ˜¯æ‹¦æˆªå™¨æœ€å¸¸è§çš„ç”¨ä¾‹ä¹‹ä¸€ï¼Œæœ‰å……åˆ†çš„ç†ç”±ã€‚æ°åˆ°å¥½å¤„ï¼")]),t._v(" "),a("p",[t._v("æœ‰å‡ ä¸ªå’Œæƒé™ç›¸å…³çš„äº‹æƒ…æˆ‘ä»¬èƒ½åšï¼š")]),t._v(" "),a("ol",[a("li",[t._v("æ·»åŠ  bearer token")]),t._v(" "),a("li",[t._v("é‡æ–°åˆ·æ–° token")]),t._v(" "),a("li",[t._v("é‡å®šå‘åˆ°ç™»å½•é¡µ")])]),t._v(" "),a("p",[t._v("å½“æˆ‘ä»¬å‘é€ bearer token æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥æœ‰äº›è¿‡æ»¤ã€‚å¦‚æœæˆ‘ä»¬è¿˜æ²¡ tokenï¼Œæˆ‘ä»¬å¯èƒ½åœ¨ç™»å½•ï¼Œå¹¶ä¸éœ€è¦æ·»åŠ  tokenã€‚æˆ–è€…å¦‚æœæˆ‘ä»¬è°ƒç”¨å…¶ä»–åŸŸåï¼Œæˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›æ·»åŠ  tokenã€‚ä¾‹å¦‚ï¼Œå¦‚æœ"),a("a",{attrs:{href:"https://medium.com/dailyjs/how-to-send-errors-into-slack-dc552e30506f",target:"_blank",rel:"noopener noreferrer"}},[t._v("å‘ Slack å‘é€é”™è¯¯ä¿¡æ¯"),a("OutboundLink")],1),t._v("ã€‚")]),t._v(" "),a("p",[t._v("ç›¸æ¯”äºå…¶ä»–æ‹¦æˆªå™¨è¿™ä¸ªä¼šæœ‰ç‚¹å¤æ‚ã€‚è¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰ä¸€äº›è§£é‡Šæ€§æ³¨é‡Šçš„ä¾‹å­ï¼š")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Injectable "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@angular/core'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" HttpEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HttpInterceptor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HttpHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HttpRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HttpErrorResponse "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@angular/common/http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" throwError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BehaviorSubject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rxjs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" catchError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" take"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" switchMap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rxjs/operators'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n@"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Injectable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthInterceptor")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpInterceptor")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AUTH_HEADER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" token "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'secrettoken'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" refreshTokenInProgress "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" refreshTokenSubject"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" BehaviorSubject"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BehaviorSubject"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("intercept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpRequest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Observable"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("HttpEvent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("has")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-type'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            req "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        req "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAuthenticationToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cacheError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpErrorResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("401")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("refreshTokenInProgress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("refreshTokenSubject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("take")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("switchMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAuthenticationToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("refreshTokenInProgress "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è®¾ç½® refreshTokenSubject ä¸º nullï¼Œè¿™æ ·éšåçš„ API å°†ç­‰åˆ°æ–°çš„ token è¢«å–å›æ—¶æ‰è°ƒç”¨ã€‚")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("refreshTokenSubject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("refreshAccessToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("switchMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("success"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("boolean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("refreshTokenSubject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("success"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAuthenticationToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“æˆ‘ä»¬è°ƒç”¨åˆ·æ–° token æ–¹æ³•å®Œæˆæ—¶ï¼Œé‡ç½® refreshTokenInProgress ä¸º falseï¼Œ")]),t._v("\n                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿™æ˜¯ä¸ºäº†ä¸‹æ¬¡ token éœ€è¦å†æ¬¡è¢«åˆ·æ–°")]),t._v("\n                            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("finalize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("refreshTokenInProgress "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("throwError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("refreshAccessToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Observable"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'secret token'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAuthenticationToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpRequest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HttpRequest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœè¿˜æ²¡æœ‰ tokenï¼Œä¸åº”è¯¥åœ¨ header ä¸­è®¾ç½® tokenã€‚")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é¦–å…ˆæˆ‘ä»¬åº”è¯¥ä»å­˜å‚¨ token çš„åœ°æ–¹å–å›")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœè®¿é—®å¤–éƒ¨åŸŸåä¸åº”è¯¥æ·»åŠ  token")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("www.mydomain.com\\/")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AUTH_HEADER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Bearer '")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("å¤§å‰å¤§åˆ©ï¼Œä»Šæ™šåƒé¸¡ï¼ğŸš€")]),t._v(" "),a("h2",{attrs:{id:"æ€»ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“","aria-hidden":"true"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),a("p",[t._v("æ‹¦æˆªå™¨æ˜¯ Angular 4.3 ä¸­ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†å¾ˆå¤šå¾ˆæ£’çš„åŠŸèƒ½ã€‚ç°åœ¨å‘æŒ¥ä½ çš„åˆ›é€ åŠ›ï¼Œæˆ‘ç›¸ä¿¡ä½ å¯ä»¥æƒ³å‡ºä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ï¼")]),t._v(" "),a("p",[t._v("è®°ä½ï¼Œé€šè¿‡ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œä½ å¯ä»¥åƒè™è ä¾ ä¸€æ ·æ£’ï¼")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/15.jfif",alt:"15"}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("10.x ç‰ˆæœ¬ï¼Œè¯‘è€…ç‰ˆæœ¬\n"),a("a",{attrs:{href:"https://github.com/llccing-demo/ng-interceptors",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub ç¤ºä¾‹ä»£ç  10.xç‰ˆæœ¬"),a("OutboundLink")],1),t._v(" ğŸ“œ\n"),a("a",{attrs:{href:"https://stackblitz.com/github/",target:"_blank",rel:"noopener noreferrer"}},[t._v("StackBlitz çº¿ä¸Šè¿è¡Œ"),a("OutboundLink")],1),t._v(" ğŸƒ")])]),t._v(" "),a("li",[a("p",[t._v("8.x ç‰ˆæœ¬ï¼Œä½œè€…ç‰ˆæœ¬\n"),a("a",{attrs:{href:"https://github.com/melcor76/interceptors",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub ç¤ºä¾‹ä»£ç  8.xç‰ˆæœ¬"),a("OutboundLink")],1),t._v(" ğŸ“œ\n"),a("a",{attrs:{href:"https://stackblitz.com/github/melcor76/interceptors",target:"_blank",rel:"noopener noreferrer"}},[t._v("StackBlitz çº¿ä¸Šè¿è¡Œ"),a("OutboundLink")],1),t._v(" ğŸƒ")])])]),t._v(" "),a("p",[t._v("æ„Ÿè°¢ Angular In Depth æä¾›æƒ³æ³•å’Œå¸®åŠ©ç¼–è¾‘æ–‡æ¡£ã€‚å¸Œæœ›æˆ‘æ²¡æœ‰å¿˜è®°ä»»ä½•ä¸€ä¸ªäººï¼Œè°¢è°¢ "),a("a",{attrs:{href:"https://medium.com/u/bd29063a4857?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("Max Koretskyi aka Wizard"),a("OutboundLink")],1),t._v("ï¼Œ"),a("a",{attrs:{href:"https://medium.com/u/802a7996f6b6?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tim Deschryver"),a("OutboundLink")],1),t._v("ï¼Œ"),a("a",{attrs:{href:"https://medium.com/u/f7828ad40c7c?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("Alex Okrushko"),a("OutboundLink")],1),t._v("ï¼Œ"),a("a",{attrs:{href:"https://medium.com/u/ae97ac398bf9?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("Alexander Poshtaruk"),a("OutboundLink")],1),t._v("ï¼Œ"),a("a",{attrs:{href:"https://medium.com/u/f0e7507974eb?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("Lars Gyrup Brink Nielsen"),a("OutboundLink")],1),t._v("ï¼Œ"),a("a",{attrs:{href:"https://medium.com/u/e0ccd74b3326?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nacho Vazquez Calleja"),a("OutboundLink")],1),t._v("ï¼Œ"),a("a",{attrs:{href:"https://medium.com/u/73c42fbc4665?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("thekiba"),a("OutboundLink")],1),t._v(" & "),a("a",{attrs:{href:"https://medium.com/u/d59a9e801370?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("Alexey Zuev"),a("OutboundLink")],1),t._v("!")]),t._v(" "),a("h2",{attrs:{id:"èµ„æº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#èµ„æº","aria-hidden":"true"}},[t._v("#")]),t._v(" èµ„æº")]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://medium.com/angular-in-depth/insiders-guide-into-interceptors-and-httpclient-mechanics-in-angular-103fbdb397bf",target:"_blank",rel:"noopener noreferrer"}},[t._v("Angular æ‹¦æˆªå™¨å†…éƒ¨æŒ‡å—å’Œ HttpClient æœºåˆ¶"),a("OutboundLink")],1),t._v(" by "),a("a",{attrs:{href:"https://medium.com/u/bd29063a4857?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("Max Koretskyi"),a("OutboundLink")],1),t._v("ï¼Œ"),a("a",{attrs:{href:"https://medium.com/u/bd29063a4857?source=post_page-----db450f8a62d6--------------------------------",target:"_blank",rel:"noopener noreferrer"}},[t._v("aka Wizard"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://angular.io/guide/http#intercepting-requests-and-responses",target:"_blank",rel:"noopener noreferrer"}},[t._v("Angular æ–‡æ¡£"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[t._v("è®¸å¤šå…¶ä»–å¥½æ–‡ç« ä¸­çš„ç‚¹ç‚¹æ»´æ»´")])])]),t._v(" "),a("h2",{attrs:{id:"è¯‘è€…å‚è€ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¯‘è€…å‚è€ƒ","aria-hidden":"true"}},[t._v("#")]),t._v(" è¯‘è€…å‚è€ƒ")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2007/06/camelcase.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("é©¼å³°æ‹¼å†™æ³•"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0",target:"_blank",rel:"noopener noreferrer"}},[t._v("XSRF/CSRF"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"æ„Ÿè°¢é˜…è¯»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ„Ÿè°¢é˜…è¯»","aria-hidden":"true"}},[t._v("#")]),t._v(" æ„Ÿè°¢é˜…è¯»")]),t._v(" "),a("p",[t._v("æ„Ÿè°¢ä½ é˜…è¯»åˆ°è¿™é‡Œï¼Œç¿»è¯‘çš„ä¸å¥½çš„åœ°æ–¹ï¼Œè¿˜è¯·æŒ‡ç‚¹ã€‚å¸Œæœ›æˆ‘çš„å†…å®¹èƒ½è®©ä½ å—ç”¨ï¼Œå†æ¬¡æ„Ÿè°¢ã€‚"),a("a",{attrs:{href:"https://llccing.github.io/FrontEnd/",target:"_blank",rel:"noopener noreferrer"}},[t._v("by llccing åƒé‡Œ"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);
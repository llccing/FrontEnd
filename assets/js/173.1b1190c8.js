(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{412:function(e,t,r){"use strict";r.r(t);var s=r(14),a=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"core-js-3-babel展望未来"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#core-js-3-babel展望未来"}},[e._v("#")]),e._v(" core-js@3, babel展望未来")]),e._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://github.com/zloirock/core-js/blob/master/docs/2019-03-19-core-js-3-babel-and-a-look-into-the-future.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/zloirock/core-js/blob/master/docs/2019-03-19-core-js-3-babel-and-a-look-into-the-future.md"),t("OutboundLink")],1),e._v(" 原文链接")])]),e._v(" "),t("p",[e._v("经过一年半的开发，数十个版本，许多不眠之夜，"),t("strong",[t("a",{attrs:{href:"https://github.com/zloirock/core-js",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("core-js@3")]),t("OutboundLink")],1)]),e._v(" 终于发布了。这是 "),t("code",[e._v("core-js")]),e._v(" 和 "),t("strong",[t("a",{attrs:{href:"https://babeljs.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("babel"),t("OutboundLink")],1)]),e._v(" \b补丁相关的功能的最大的一次变化。")]),e._v(" "),t("p",[e._v("什么是 "),t("code",[e._v("core-js")]),e._v("?")]),e._v(" "),t("ul",[t("li",[e._v("它是JavaScript标准库的 polyfill，它支持\n"),t("ul",[t("li",[e._v("最新的 "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/ECMAScript",target:"_blank",rel:"noopener noreferrer"}},[e._v("ECMAScript"),t("OutboundLink")],1),e._v(" 标准")]),e._v(" "),t("li",[e._v("ECMAScript 标准库提案")]),e._v(" "),t("li",[e._v("一些 "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/WHATWG",target:"_blank",rel:"noopener noreferrer"}},[e._v("WHATGW"),t("OutboundLink")],1),e._v("  / "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/World_Wide_Web_Consortium",target:"_blank",rel:"noopener noreferrer"}},[e._v("W3C"),t("OutboundLink")],1),e._v(" 标准（跨平台或者 ECMAScript 相关）")])])]),e._v(" "),t("li",[e._v("它最大限度的模块化：你能仅仅加载你想要使用的功能")]),e._v(" "),t("li",[e._v("它能够不污染全局命名空间")]),e._v(" "),t("li",[e._v("它"),t("a",{attrs:{href:"https://github.com/zloirock/core-js/blob/master/docs/2019-03-19-core-js-3-babel-and-a-look-into-the-future.md#Babel",target:"_blank",rel:"noopener noreferrer"}},[e._v("和babel紧密集成"),t("OutboundLink")],1),e._v("：这能够优化"),t("code",[e._v("core-js")]),e._v("的导入")])]),e._v(" "),t("p",[e._v("它是最普遍、"),t("a",{attrs:{href:"https://www.npmtrends.com/core-js-vs-es5-shim-vs-es6-shim-vs-airbnb-js-shims-vs-polyfill-library-vs-polyfill-service-vs-js-polyfills",target:"_blank",rel:"noopener noreferrer"}},[e._v("最流行"),t("OutboundLink")],1),e._v("给 JavaScript 标准库打补丁的方式，但是有很大一部分开发者并不知道他们间接的使用了"),t("code",[e._v("core-js")]),e._v("🙂")]),e._v(" "),t("h2",{attrs:{id:"贡献"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#贡献"}},[e._v("#")]),e._v(" 贡献")]),e._v(" "),t("p",[t("code",[e._v("core-js")]),e._v(" 是我自己爱好的项目，没有给我带来任何利润。它花了我很长的时间，真的很昂贵：为了完成 "),t("code",[e._v("core-js@3")]),e._v("，我在几个月之前已经离开我的工作。这个项目对许多人和公司起到了促进作用。因为这些，筹集资金去支持 "),t("code",[e._v("core-js")]),e._v(" 的维护是说得通的。")]),e._v(" "),t("p",[e._v("如果你对 "),t("code",[e._v("core-js")]),e._v(" 感兴趣或者在你每天的工作中有使用到，你可以在 "),t("a",{attrs:{href:"https://opencollective.com/core-js#sponsor",target:"_blank",rel:"noopener noreferrer"}},[e._v("Open Collective"),t("OutboundLink")],1),e._v(" 或者 "),t("a",{attrs:{href:"https://www.patreon.com/zloirock",target:"_blank",rel:"noopener noreferrer"}},[e._v("Patreon"),t("OutboundLink")],1),e._v(" 成为赞助者。")]),e._v(" "),t("p",[e._v("你可以给"),t("a",{attrs:{href:"http://zloirock.ru/",target:"_blank",rel:"noopener noreferrer"}},[e._v("我"),t("OutboundLink")],1),e._v("提供一个好的工作，和我现在做的相关的。")]),e._v(" "),t("p",[e._v("或者你可以以另一种方式贡献，你可以帮助去改进代码、测试或者文档（现在，"),t("code",[e._v("core-js")]),e._v(" 的文档还很糟糕！）。")]),e._v(" "),t("h2",{attrs:{id:"core-js-3有哪些变化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#core-js-3有哪些变化"}},[e._v("#")]),e._v(" "),t("code",[e._v("core-js@3")]),e._v("有哪些变化？")]),e._v(" "),t("h3",{attrs:{id:"javascript-标准库中变化的内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#javascript-标准库中变化的内容"}},[e._v("#")]),e._v(" JavaScript 标准库中变化的内容")]),e._v(" "),t("p",[e._v("由于以下两个原因，这个版本包含丰富的、新的 JavaScript 补丁：")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("core-js")]),e._v(" 只在 major（主）版本更新时才有 break changes，即使需要和提案的内容对齐。")]),e._v(" "),t("li",[t("code",[e._v("core-js@2")]),e._v(" 在一年半前已经进入功能冻结阶段了；所有新的功能只能够添加到 "),t("code",[e._v("core-js@3")]),e._v(" 这个分支。")])]),e._v(" "),t("h4",{attrs:{id:"稳定的-ecmascript-功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#稳定的-ecmascript-功能"}},[e._v("#")]),e._v(" 稳定的 ECMAScript 功能")]),e._v(" "),t("p",[e._v("稳定的 ECMAScript 功能在 "),t("code",[e._v("core-js")]),e._v(" 中已经几乎完全支持有很长一段时间了，除此之外，"),t("code",[e._v("core-js@3")]),e._v(" 引进了一些新功能：")]),e._v(" "),t("ul",[t("li",[e._v("增加支持 ECMAScript 2015 引入的两个知名标志 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/isConcatSpreadable",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("@@isConcatSpreadable")]),t("OutboundLink")],1),e._v(" 和 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/species",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("@@species")]),t("OutboundLink")],1),e._v("，给所有使用他们的方法。")]),e._v(" "),t("li",[e._v("增加来自 ECMAScript 2018 的 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/flat",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Array.prototype.flat")]),t("OutboundLink")],1),e._v(" 和 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/flatMap",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Array.prototype.flatMap")]),t("OutboundLink")],1),e._v("（ "),t("code",[e._v("core-js@2")]),e._v(" 针对 "),t("code",[e._v("Array.prototype.flatten")]),e._v(" 这个老版本的提案提供了补丁）。")]),e._v(" "),t("li",[e._v("增加来自 ECMAScript 2019 的 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/fromEntries",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Object.fromEntries")]),t("OutboundLink")],1),e._v(" 方法")]),e._v(" "),t("li",[e._v("增加来自 ECMAScript 2019 的 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/description",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Symbol.prototype.description")]),t("OutboundLink")],1),e._v(" 访问器")])]),e._v(" "),t("p",[e._v("一些在 ES2016-ES2019 中作为提案被接受且已经使用很长时间的功能，现在被标记为稳定：")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Array.prototype.includes")]),t("OutboundLink")],1),e._v(" 和 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray/includes",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("TypedArray.prototype.includes")]),t("OutboundLink")],1),e._v(" 方法（ ESMAScript 2016 ）")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/values",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Object.values")]),t("OutboundLink")],1),e._v(" 和 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Object.entries")]),t("OutboundLink")],1),e._v(" 方法( ECMAScript 2017 )")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptors",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Object.getOwnPropertyDescriptors")]),t("OutboundLink")],1),e._v(" 方法 ( ECMAScript 2017 )")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/padStart",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("String.prototype.padStart")]),t("OutboundLink")],1),e._v(" 和 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/padEnd",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("String.prototype.padEnd")]),t("OutboundLink")],1),e._v(" 方法（ ECMAScript 2017 ）")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/finally",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Promise.prototype.finally")]),t("OutboundLink")],1),e._v(" 方法（ ECMAScript 2018 ）")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/asyncIterator",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Symbol.asyncIterator")]),t("OutboundLink")],1),e._v(" 知名标志（ ECMAScript 2018 ）")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/__defineGetter__",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Object.prototype.__define(Getter|Setter)__")]),t("OutboundLink")],1),e._v(" 和 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/__lookupGetter__",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Object.prototype.__lookup(Getter|Setter)__")]),t("OutboundLink")],1),e._v(" 方法（ ECMAScript 2018 ）")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/trimStart",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("String.prototype.trim(Start|End|Left|Right)")]),t("OutboundLink")],1),e._v(" 方法（ ECMAScript 2019 ）")])]),e._v(" "),t("p",[e._v("修复了针对浏览器的许多问题，例如，"),t("a",{attrs:{href:"https://bugs.webkit.org/show_bug.cgi?id=188794",target:"_blank",rel:"noopener noreferrer"}},[e._v("Safari 12.0 "),t("code",[e._v("Array.prototype.reverse")]),e._v(" bug"),t("OutboundLink")],1),e._v(" 已经被修复了。")]),e._v(" "),t("h4",{attrs:{id:"ecmascript-提案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ecmascript-提案"}},[e._v("#")]),e._v(" ECMAScript 提案")]),e._v(" "),t("p",[e._v("除了上文提到的支持内容，"),t("code",[e._v("core-js@3")]),e._v(" 现在还支持下面的 ECMAScript 提案：")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/tc39/proposal-global",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("globalThis")]),t("OutboundLink")],1),e._v(" stage 3（ 现在是 stage 4 ）的提案 - 之前，已经有了 "),t("code",[e._v("global")]),e._v(" 和 "),t("code",[e._v("System.global")])]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/tc39/proposal-promise-allSettled",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Promise.allSettled")]),t("OutboundLink")],1),e._v(" stage 2（ 现在是 stage 4 ）提案")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/tc39/proposal-set-methods",target:"_blank",rel:"noopener noreferrer"}},[e._v("新 "),t("code",[e._v("Set")]),e._v(" 方法"),t("OutboundLink")],1),e._v(" stage 2 提案：\n"),t("ul",[t("li",[e._v("Set.prototype.difference")]),e._v(" "),t("li",[e._v("Set.prototype.intersection")]),e._v(" "),t("li",[e._v("Set.prototype.isDisjoinFrom")]),e._v(" "),t("li",[e._v("Set.prototype.isSubsetOf")]),e._v(" "),t("li",[e._v("Set.prototype.isSupersetOf")]),e._v(" "),t("li",[e._v("Set.prototype.symmetricDifference")]),e._v(" "),t("li",[e._v("Set.prototype.union")])])]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/tc39/proposal-collection-methods",target:"_blank",rel:"noopener noreferrer"}},[e._v("新 collections 方法"),t("OutboundLink")],1),e._v(" stage 1 提案，包函许多新的有用的方法：\n"),t("ul",[t("li",[e._v("Map.groupBy")]),e._v(" "),t("li",[e._v("Map.keyBy")]),e._v(" "),t("li",[e._v("Map.prototype.deleteAll")]),e._v(" "),t("li",[e._v("Map.prototype.every")]),e._v(" "),t("li",[e._v("Map.prototype.filter")]),e._v(" "),t("li",[e._v("Map.prototype.find")]),e._v(" "),t("li",[e._v("Map.prototype.findKey")]),e._v(" "),t("li",[e._v("Map.prototype.includes")]),e._v(" "),t("li",[e._v("Map.prototype.keyOf")]),e._v(" "),t("li",[e._v("Map.prototype.mapKeys")]),e._v(" "),t("li",[e._v("Map.prototype.mapValues")]),e._v(" "),t("li",[e._v("Map.prototype.merge")]),e._v(" "),t("li",[e._v("Map.prototype.reduce")]),e._v(" "),t("li",[e._v("Map.prototype.some")]),e._v(" "),t("li",[e._v("Map.prototype.update")]),e._v(" "),t("li",[e._v("Set.prototype.addAll")]),e._v(" "),t("li",[e._v("Set.prototype.deleteAll")]),e._v(" "),t("li",[e._v("Set.prototype.every")]),e._v(" "),t("li",[e._v("Set.prototype.filter")]),e._v(" "),t("li",[e._v("Set.prototype.find")]),e._v(" "),t("li",[e._v("Set.prototype.join")]),e._v(" "),t("li",[e._v("Set.prototype.map")]),e._v(" "),t("li",[e._v("Set.prototype.reduce")]),e._v(" "),t("li",[e._v("Set.prototype.some")]),e._v(" "),t("li",[e._v("WeakMap.prototype.deleteAll")]),e._v(" "),t("li",[e._v("WeakSet.prototype.addAll")]),e._v(" "),t("li",[e._v("WeakSet.prototype.deleteAll")])])]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/tc39/proposal-string-replace-all",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("String.prototype.replaceAll")]),t("OutboundLink")],1),e._v(" stage 1（ 现在是 stage 3 ） 提案")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/tc39/proposal-string-prototype-codepoints",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("String.prototype.codePoints")]),t("OutboundLink")],1),e._v(" stage 1 提案")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/tc39-transfer/proposal-array-last",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Array.prototype.last(Item|Index)")]),t("OutboundLink")],1),e._v(" stage 1 提案")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/bmeck/proposal-richer-keys/tree/master/compositeKey",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("compositeKey")]),e._v(" 和 "),t("code",[e._v("compositeSymbol")]),e._v(" 方法"),t("OutboundLink")],1),e._v(" stage 1 提案")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/tc39/proposal-number-fromstring",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Number.fromString")]),t("OutboundLink")],1),e._v(" stage 1 提案")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/tc39/proposal-seeded-random",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Math.seededPRNG")]),t("OutboundLink")],1),e._v(" stage 1 提案")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/tc39/proposal-promise-any",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Promise.any")]),e._v(" (合并的错误)"),t("OutboundLink")],1),e._v(" stage 0（ 现在是stage 3 ）提案")])]),e._v(" "),t("p",[e._v("一些提案的变化很大，"),t("code",[e._v("core-js")]),e._v(" 也将相应的更新：")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/tc39/proposal-string-matchall",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("String.prototype.matchAll")]),t("OutboundLink")],1),e._v(" stage 3 提案")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/tc39/proposal-observable",target:"_blank",rel:"noopener noreferrer"}},[e._v("Observable"),t("OutboundLink")],1),e._v(" stage 1 提案")])]),e._v(" "),t("h4",{attrs:{id:"web-标准"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web-标准"}},[e._v("#")]),e._v(" web 标准")]),e._v(" "),t("p",[e._v("许多有用的功能被添加到这个类别中。")]),e._v(" "),t("p",[e._v("最重要的一个是 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/URL",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("URL")]),t("OutboundLink")],1),e._v(" 和 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("URLSearchParams")]),t("OutboundLink")],1),e._v("。他是"),t("a",{attrs:{href:"https://github.com/zloirock/core-js/issues/117",target:"_blank",rel:"noopener noreferrer"}},[e._v("最受欢迎的功能请求之一"),t("OutboundLink")],1),e._v("。增加 "),t("code",[e._v("URL")]),e._v(" 和 "),t("code",[e._v("URLSearchParams")]),e._v("，并保证他们最大限度的符合规范，保持源代码足够紧凑来支撑任何环境是 "),t("code",[e._v("core-js@3")]),e._v(" 开发中"),t("a",{attrs:{href:"https://github.com/zloirock/core-js/pull/454/files",target:"_blank",rel:"noopener noreferrer"}},[e._v("最困难的任务之一"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("p",[t("code",[e._v("core-js@3")]),e._v(" 包函在JavaScript中创建微任务（ microtask ）的标准方法："),t("a",{attrs:{href:"https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#microtask-queuing",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("queueMicrotask")]),t("OutboundLink")],1),e._v(" 。"),t("code",[e._v("core-js@2")]),e._v(" 提供了  "),t("code",[e._v("asap")]),e._v(" 函数，提供了同样功能的老的提案。"),t("code",[e._v("queueMicrotask")]),e._v(" 被定义在 HTML 标准中，它已经能够在现代浏览器比如 Chromium 或者 NodeJS 中使用。")]),e._v(" "),t("p",[e._v("另一个受欢迎的功能请求是支持 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/NodeList/forEach",target:"_blank",rel:"noopener noreferrer"}},[e._v("DOM集合的 "),t("code",[e._v(".forEach")]),e._v(" 方法"),t("OutboundLink")],1),e._v("。由于 "),t("code",[e._v("core-js")]),e._v(" 已经针对DOM集合迭代器做了polyfill，为什么不给 "),t("code",[e._v("节点列表")]),e._v(" 和 "),t("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/DOMTokenList",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("DOMTokenList")]),t("OutboundLink")],1),e._v(" 也增加 "),t("code",[e._v(".forEach")]),e._v(" 呢？")]),e._v(" "),t("h4",{attrs:{id:"移除过时的功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#移除过时的功能"}},[e._v("#")]),e._v(" 移除过时的功能：")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Reflect.enumrate")]),e._v(" 因为他已经从标准中移除了")]),e._v(" "),t("li",[t("code",[e._v("System.global")]),e._v(" 和 "),t("code",[e._v("global")]),e._v(" 现在他们已经被 "),t("code",[e._v("globalThis")]),e._v(" 代替")]),e._v(" "),t("li",[t("code",[e._v("Array.prototype.flatten")]),e._v(" 现在被 "),t("code",[e._v("Array.prototype.flat")]),e._v(" 代替")]),e._v(" "),t("li",[t("code",[e._v("asap")]),e._v(" 被 "),t("code",[e._v("queueMicrotask")]),e._v(" 代替")]),e._v(" "),t("li",[t("code",[e._v("Error.isError")]),e._v(" 被撤销很长时间了")]),e._v(" "),t("li",[t("code",[e._v("RegExp.escape")]),e._v(" 很久之前被拒绝了")]),e._v(" "),t("li",[t("code",[e._v("Map.prototype.toJSON")]),e._v(" 和 "),t("code",[e._v("Set.prototype.toJSON")]),e._v(" 也是很久前被拒绝了")]),e._v(" "),t("li",[e._v("不必要并且被错误添加的迭代器方法："),t("code",[e._v("CSSRuleList")]),e._v("，"),t("code",[e._v("MediaList")]),e._v("，"),t("code",[e._v("StyleSheetList")]),e._v("。")])]),e._v(" "),t("h4",{attrs:{id:"不再有非标准、非提案的功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#不再有非标准、非提案的功能"}},[e._v("#")]),e._v(" 不再有非标准、非提案的功能")]),e._v(" "),t("p",[e._v("许多年前，我开始写一个库，他是我的JavaScript程序的核心：这个库包函 polyfills 和一些我需要的工具函数。一段时间后，这个库以 "),t("code",[e._v("core-js")]),e._v(" 命名发布。我认为现在大多数 "),t("code",[e._v("core-js")]),e._v(" 用户不需要非标准的 "),t("code",[e._v("core-js")]),e._v(" 功能，他们大多已经在早期版本移除了，现在是时候将剩余部分从 "),t("code",[e._v("core-js")]),e._v(" 中移除。从这个版本开始，"),t("code",[e._v("core-js")]),e._v(" 可以被称为  polyfill 了。")]),e._v(" "),t("h3",{attrs:{id:"包、入口和模块名字"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#包、入口和模块名字"}},[e._v("#")]),e._v(" 包、入口和模块名字")]),e._v(" "),t("p",[e._v("一个issue里提了 "),t("code",[e._v("core-js")]),e._v(" 包的很大（ ~2MB ），有很多重复文件。因为这个原因，"),t("code",[e._v("core-js")]),e._v(" 分成了3个包：")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.npmjs.com/package/core-js",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("core-js")]),t("OutboundLink")],1),e._v(" 定义全局的 polyfills。（ ~500KB，"),t("a",{attrs:{href:"https://bundlephobia.com/result?p=core-js@3.0.0-beta.20",target:"_blank",rel:"noopener noreferrer"}},[e._v("压缩并且 gzipped 处理后 40KB"),t("OutboundLink")],1),e._v(" ）")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.npmjs.com/package/core-js-pure",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("core-js-pure")]),t("OutboundLink")],1),e._v("，提供了不污染全局变量的 polyfills。它和 "),t("code",[e._v("core-js@2")]),e._v(" 中的 "),t("code",[e._v("core-js/library")]),e._v(" 相当。（~440KB）")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.npmjs.com/package/core-js-bundle",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("core-js-bundle")]),t("OutboundLink")],1),e._v("：定义了全局填充的打包版本")])]),e._v(" "),t("p",[t("code",[e._v("core-js")]),e._v(" 的早期版本中，稳定的 ECMAScript 功能和 ECMAScript 提案的 polyfill 模块化需要分别加 "),t("code",[e._v("es6.")]),e._v(" 和 "),t("code",[e._v("es7.")]),e._v(" 前缀。这是在 2014 年做的决定，那时将 ES6 之后的所有功能都视为 ES7。在 "),t("code",[e._v("core-js@3")]),e._v(" 中所有稳定的 ECMAScript 功能都增加 "),t("code",[e._v("es.")]),e._v(" 前缀，ECMAScript 提案增加 "),t("code",[e._v("esnext.")]),e._v(" 前缀。")]),e._v(" "),t("p",[e._v("几乎所有的 CommonJS 入口都改变了。"),t("code",[e._v("core-js@3")]),e._v(" 相比于 "),t("code",[e._v("core-js@2")]),e._v(" 有更多的入口：这带来的最大限度的灵活性，使你能够仅仅引入你的应用需要的依赖。")]),e._v(" "),t("p",[e._v("这里是一些例子关于如何使用新的入口：")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 使用 `core-js` 全部功能打补丁：")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 仅仅使用稳定的 `core-js` 功能 - ES 和 web 标准：")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/stable"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 仅仅使用稳定的 ES 功能")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/es"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 如果你想用 `Set` 的补丁")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 所有 `Set`- ES 提案中，相关的功能：")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/features/set"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 稳定的 `Set` ES 功能和来自web标准的功能")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// （DOM 集合迭代器）")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/stable/set"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 只有 `Set` 所需的稳定的 ES 功能")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/es/set"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 与上面一致，但不会污染全局命名空间")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" Set "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js-pure/features/set"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" Set "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js-pure/stable/set"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" Set "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js-pure/es/set"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 仅仅为需要的方法打补丁")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/feature/set/intersection"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/stable/queque-microtask"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/es/array/from"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 为 reflect metadata 提案打补丁")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/proposals/reflect-metadata"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 为所有 stage 2+ 的提案打补丁")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/stage/2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("h3",{attrs:{id:"其他重要的变化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他重要的变化"}},[e._v("#")]),e._v(" 其他重要的变化")]),e._v(" "),t("p",[t("code",[e._v("core-js")]),e._v(" polyfill 能够 "),t("a",{attrs:{href:"https://github.com/zloirock/core-js/blob/master/README.md#configurable-level-of-aggressiveness",target:"_blank",rel:"noopener noreferrer"}},[e._v("配置侵入等级"),t("OutboundLink")],1),e._v("。如果你认为有些情境 "),t("code",[e._v("core-js")]),e._v(" 功能检测侵入性太强，原生实现对你来说已经足够，或者一个错误的实现没有被 "),t("code",[e._v("core-js")]),e._v(" 检测到，你可以修改 "),t("code",[e._v("core-js")]),e._v(" 的默认行为。")]),e._v(" "),t("p",[e._v("如果无法安装规范的每个细节实现某个功能，"),t("code",[e._v("core-js")]),e._v(" 增加了一个 "),t("code",[e._v(".sham")]),e._v(" 属性，例如，IE11中 "),t("code",[e._v("Symbol.sham")]),e._v(" 是 "),t("code",[e._v("true")]),e._v("。")]),e._v(" "),t("p",[e._v("不再有 LiveScript! 当我开始写 "),t("code",[e._v("core-js")]),e._v(" 时，我主要使用的是 "),t("a",{attrs:{href:"http://livescript.net/",target:"_blank",rel:"noopener noreferrer"}},[e._v("LiveScript"),t("OutboundLink")],1),e._v(" ；一段时间后，我用 JavaScript 重写了全部的 polyfills 。在 "),t("code",[e._v("core-js@2")]),e._v(" 中测试和帮助的工具函数仍然使用 LiveScript ：它是非常有趣的像 CoffeeScript 一样的语言，有强大的语法糖使你能够写非常紧凑的代码，但是它几乎已经死了。除此之外，它也是为 "),t("code",[e._v("core-js")]),e._v(" 贡献的屏障，因为大多数 "),t("code",[e._v("core-js")]),e._v(" 用户不知道这个语言。"),t("code",[e._v("core-js@3")]),e._v(" 测试和工具函数使用现代 ES 语法：它将成为为 "),t("code",[e._v("core-js")]),e._v(" 贡献的好时机🙂。")]),e._v(" "),t("p",[e._v("对于大多数用户，为了优化 "),t("code",[e._v("core-js")]),e._v(" 导入，我建议使用 "),t("a",{attrs:{href:"#Babel"}},[e._v("babel")]),e._v("。当然，有些情况下 "),t("a",{attrs:{href:"http://npmjs.com/package/core-js-builder",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("core-js-builder")]),t("OutboundLink")],1),e._v(" 仍然有用。现在它支持 "),t("code",[e._v("target")]),e._v(" 参数，使用带有目标引擎的"),t("a",{attrs:{href:"https://github.com/browserslist/browserslist",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("浏览器列表")]),t("OutboundLink")],1),e._v(" 查询 - 你能够创建一个 bundle，仅仅包含目标引擎需要的 polyfills。对于这种情况，我做了 "),t("a",{attrs:{href:"https://www.npmjs.com/package/core-js-compat",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("core-js-compat")]),t("OutboundLink")],1),e._v("，更多关于它的信息，你能够从 "),t("a",{attrs:{href:"#babelpreset-env"}},[e._v("这篇文章的 "),t("code",[e._v("@babel/preset-env")]),e._v(" 部分")]),e._v("了解到。")]),e._v(" "),t("hr"),e._v(" "),t("p",[e._v("这仅仅是冰山一角，更多的变化在内部。更多关于 "),t("code",[e._v("core-js")]),e._v(" 变化可以在 "),t("a",{attrs:{href:"https://github.com/zloirock/core-js/blob/master/CHANGELOG.md#300",target:"_blank",rel:"noopener noreferrer"}},[e._v("changelog"),t("OutboundLink")],1),e._v(" 中找到。")]),e._v(" "),t("h2",{attrs:{id:"babel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#babel"}},[e._v("#")]),e._v(" Babel")]),e._v(" "),t("p",[e._v("正如上文提到的，"),t("code",[e._v("babel")]),e._v(" 和 "),t("code",[e._v("core-js")]),e._v(" 是紧密集成的："),t("code",[e._v("babel")]),e._v(" 提供了优化 "),t("code",[e._v("core-js")]),e._v(" 优化导入的可能性。"),t("code",[e._v("core-js@3")]),e._v(" 开发中很重要的一部分是改进 "),t("code",[e._v("core-js")]),e._v(" 相关的 "),t("code",[e._v("babel")]),e._v(" 功能（看"),t("a",{attrs:{href:"https://github.com/babel/babel/pull/7646",target:"_blank",rel:"noopener noreferrer"}},[e._v("这个PR"),t("OutboundLink")],1),e._v("）。这些变化在 "),t("a",{attrs:{href:"https://babeljs.io/blog/2019/03/19/7.4.0",target:"_blank",rel:"noopener noreferrer"}},[e._v("Babel 7.4.0"),t("OutboundLink")],1),e._v(" 发布了。")]),e._v(" "),t("h3",{attrs:{id:"babel-polyfill"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#babel-polyfill"}},[e._v("#")]),e._v(" babel/polyfill")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://babeljs.io/docs/en/next/babel-polyfill.html",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("@babel/polyfill")]),t("OutboundLink")],1),e._v(" 是一个包裹的包，里面仅仅包含 "),t("code",[e._v("core-js")]),e._v(" 稳定版的引入（在Babel 6 中也包含提案）和 "),t("code",[e._v("regenerator-runtime/runtime")]),e._v("，用来转译 generators 和 async 函数。这个包没有提供从 "),t("code",[e._v("core-js@2")]),e._v(" 到 "),t("code",[e._v("core-js@3")]),e._v(" 平滑升级路径：因为这个原因，决定弃用 "),t("code",[e._v("@babel/polyfill")]),e._v(" 代之以分别引入需要的 "),t("code",[e._v("core-js")]),e._v(" 和 "),t("code",[e._v("regenerator-runtime")]),e._v(" 。")]),e._v(" "),t("p",[e._v("原来")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"@babel/polyfill"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("现在使用两行代替：")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/stable"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"regenerator-runtime/runtime"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("别忘记直接安装这两个依赖！")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[e._v("npm i "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("save core"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("js regenerator"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("runtime\n")])])]),t("h3",{attrs:{id:"babe-preset-env"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#babe-preset-env"}},[e._v("#")]),e._v(" @babe/preset-env")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://babeljs.io/docs/en/next/babel-preset-env#usebuiltins",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("@babel/preset-env")]),t("OutboundLink")],1),e._v(" 有两种不同的模式，通过 "),t("code",[e._v("useBuiltIns")]),e._v(" 选项："),t("code",[e._v("entry")]),e._v(" 和 "),t("code",[e._v("usage")]),e._v(" 优化 "),t("code",[e._v("core-js")]),e._v("的导入。")]),e._v(" "),t("p",[e._v("Babel 7.4.0 引入了两种模式的共同更改，以及每种模式的特定的修改。")]),e._v(" "),t("p",[e._v("由于现在 "),t("code",[e._v("@babel/preset-env")]),e._v(" 支持 "),t("code",[e._v("core-js@2")]),e._v(" 和 "),t("code",[e._v("core-js@3")]),e._v("，因此 "),t("code",[e._v("useBuiltIns")]),e._v(" 需要新的选项 -- "),t("code",[e._v("corejs")]),e._v("，这个选项用来定义使用 "),t("code",[e._v("core-js")]),e._v(" 的版本（"),t("code",[e._v("corejs: 2")]),e._v(" 或者 "),t("code",[e._v("corejs: 3")]),e._v("）。如果没有设置，"),t("code",[e._v("corejs: 2")]),e._v(" 是默认值并且会有警告提示。")]),e._v(" "),t("p",[e._v("为了使 babel 支持将来的次要版本中引入的 "),t("code",[e._v("core-js")]),e._v(" 的新功能，你可以在项目中定义明确的次要版本号。例如，你想使用 "),t("code",[e._v("core-js@3.1")]),e._v(" 使用这个版本的新特性，你可以设置 "),t("code",[e._v("corejs")]),e._v(" 选项为 "),t("code",[e._v("3.1")]),e._v("："),t("code",[e._v("corejs: '3.1'")]),e._v(" 或者 "),t("code",[e._v("corejs: {version: '3.1'}")]),e._v("。")]),e._v(" "),t("p",[t("code",[e._v("@babel/preset-env")]),e._v(" 最重要的一个功能就是提供不同浏览器支持特性的数据来源，用来确定是否需要 "),t("code",[e._v("core-js")]),e._v(" 填充某些内容。 "),t("a",{attrs:{href:"https://caniuse.com/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("caniuse")]),t("OutboundLink")],1),e._v("，"),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("mdn")]),t("OutboundLink")],1),e._v(" 和 "),t("a",{attrs:{href:"http://kangax.github.io/compat-table/es6/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("compat-table")]),t("OutboundLink")],1),e._v(" 是很好的教育资源，但是并不意味着他们能够作为数据源被开发者使用：只有 "),t("code",[e._v("compat-table")]),e._v(" 包函好的 ES 相关数据集，它被 "),t("code",[e._v("@babel/preset-env")]),e._v(" 使用，但是仍有些限制：")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("它包含的数据仅仅关于 ECMAScript 特性和提案，和 web 平台特性例如 "),t("code",[e._v("setImmediate")]),e._v(" 或者 DOM 集合迭代器没有关系。所以直到现在，"),t("code",[e._v("@babel/preset-env")]),e._v(" 仍然通过 "),t("code",[e._v("core-js")]),e._v(" 添加全部的 web 平台特性即使他们已经支持了。")])]),e._v(" "),t("li",[t("p",[e._v("它他不包含任何浏览器（甚至是严重的）bug 信息：例如，上文提到的在 Safari 12 中 "),t("code",[e._v("Array#reverse")]),e._v("，但是 "),t("code",[e._v("compat-table")]),e._v(" 并没有将它标记为不支持。另一方面，"),t("code",[e._v("core-js")]),e._v(" 已经修复了这个错误实现，但是因为 "),t("code",[e._v("compat-table")]),e._v(" 关系，并不能使用它。")])]),e._v(" "),t("li",[t("p",[e._v("它仅包函一些基础的、幼稚的测试，没有检查功能在真实环境下是否可以正常工作。例如，老版本 Safari 的破坏的迭代器没有 "),t("code",[e._v(".next")]),e._v(" 方法，但是 "),t("code",[e._v("compat-table")]),e._v(" 表明 Safari 支持，因为它用 "),t("code",[e._v("typeof")]),e._v(" 方法检测迭代器方法返回了 "),t("code",[e._v('"function"')]),e._v("。一些像 typed arrays 的功能几乎没有覆盖。")])]),e._v(" "),t("li",[t("p",[t("code",[e._v("compat-table")]),e._v(" 不是为了向工具提供数据而设计的。我是 "),t("code",[e._v("compat-table")]),e._v(" 的维护者之一，但是"),t("a",{attrs:{href:"https://github.com/kangax/compat-table/pull/1312",target:"_blank",rel:"noopener noreferrer"}},[e._v("其他的维护者反对为维护这个功能"),t("OutboundLink")],1),e._v("。")])])]),e._v(" "),t("p",[e._v("因为这个原因，我创建了 "),t("a",{attrs:{href:"https://github.com/zloirock/core-js/tree/master/packages/core-js-compat",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("core-js-compat")]),t("OutboundLink")],1),e._v("：它提供了对于不同浏览器 "),t("code",[e._v("core-js")]),e._v(" 模块的必要性数据。当使用 "),t("code",[e._v("core-js@3")]),e._v(" 时，"),t("code",[e._v("@babel/preset-env")]),e._v(" 将使用新的包取代 "),t("code",[e._v("compat-table")]),e._v("。"),t("a",{attrs:{href:"https://github.com/zloirock/core-js/blob/master/CONTRIBUTING.md#updating-core-js-compat-data",target:"_blank",rel:"noopener noreferrer"}},[e._v("请帮助我们测试并提供缺少的引擎的数据的映射关系！"),t("OutboundLink")],1),e._v("😊。")]),e._v(" "),t("p",[e._v("在 Babel 7.3 之前，"),t("code",[e._v("@babel/preset-env")]),e._v(" 有一些与 polyfills 注入顺序有关的问题。从 7.4.0开始，"),t("code",[e._v("@babel/preset-env")]),e._v(" 只按推荐顺序增加需要的 polyfills 。")]),e._v(" "),t("h4",{attrs:{id:"usebuiltins-entry-with-corejs-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#usebuiltins-entry-with-corejs-3"}},[e._v("#")]),e._v(" "),t("code",[e._v("useBuiltIns: entry")]),e._v(" with "),t("code",[e._v("corejs: 3")])]),e._v(" "),t("p",[e._v("当使用这个选项时，"),t("code",[e._v("@babel/preset-env")]),e._v(" 代替直接引用 "),t("code",[e._v("core-js")]),e._v(" 而是引入目标环境特定需要的模块。")]),e._v(" "),t("p",[e._v("在这个变化前，"),t("code",[e._v("@babel/preset")]),e._v(" 仅替换 "),t("code",[e._v("import '@babel/polyfill'")]),e._v(" 和 "),t("code",[e._v("import 'core-js'")]),e._v("，他们是同义词用来 polyfill 所有稳定的 JavaScript 特性。")]),e._v(" "),t("p",[e._v("现在 "),t("code",[e._v("@babel/polyfill")]),e._v(" 弃用了，当 "),t("code",[e._v("corejs")]),e._v(" 设置为 3 时 "),t("code",[e._v("@babel/preset-env")]),e._v(" 不会转译他。")]),e._v(" "),t("p",[t("code",[e._v("core-js@3")]),e._v(" 中等价替换 "),t("code",[e._v("@babel/polyfill")]),e._v(" 是")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/stable"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"regenerator-runtime/runtime"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("当目标浏览器是 "),t("code",[e._v("chrome 72")]),e._v(" 时，上面的内容将被 "),t("code",[e._v("@babel/preset-env")]),e._v(" 转换为")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/es.array.unscopables.flat"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/es.array.unscopaables.flat-map"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/es.object.from-entries"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modlues/web.immediate"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("当目标浏览器是 "),t("code",[e._v("chrome 73")]),e._v("（它完全支持 ES2019 标准库），他将变为很少的引入：")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/web.immediate"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("自从 "),t("code",[e._v("@babel/polyfill")]),e._v(" 被弃用，转而使用分开的 "),t("code",[e._v("core-js")]),e._v(" 和 "),t("code",[e._v("regenerator-runtime")]),e._v("，我们能够优化 "),t("code",[e._v("regenerator-runtime")]),e._v(" 的导入。因为这个原因，如果目标浏览器原生支持 generators ，那么 "),t("code",[e._v("regenerator-runtime")]),e._v(" 的导入将从源代码中移除。")]),e._v(" "),t("p",[e._v("现在，设置 "),t("code",[e._v("useBuiltIns: entry")]),e._v(" 模式的 "),t("code",[e._v("@babel/preset-env")]),e._v(" 编译所有能够获得的 "),t("code",[e._v("core-js")]),e._v(" 入口和他们的组合。这意味着你能够自定义，通过使用不同的 "),t("code",[e._v("core-js")]),e._v(" 入口，它将根据的目标环境优化。")]),e._v(" "),t("p",[e._v("例如，目标环境是 "),t("code",[e._v("chrome 72")]),e._v("，")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/es"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/proposals/set-methods"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/features/set/map"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("将被替换为")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/es.array.unscopables.flat"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/es.array.unscopables.flat-map"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/es.object.from-entries"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/esnext.set.difference"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/esnext.set.intersection"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/esnext.set.is-disjoint-from"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/esnext.set.is-subset-of"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/esnext.set.is-superset-of"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/esnext.set.map"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/esnext.set.symmetric-difference"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/esnext.set.union"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("h4",{attrs:{id:"usebuiltins-usage-with-corejs-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#usebuiltins-usage-with-corejs-3"}},[e._v("#")]),e._v(" "),t("code",[e._v("useBuiltIns: usage")]),e._v(" with "),t("code",[e._v("corejs: 3")])]),e._v(" "),t("p",[e._v("当使用这个选项时，"),t("code",[e._v("@babel/preset-env")]),e._v(" 在每个文件的开头引入目标环境不支持、仅在当前文件中使用的 polyfills。")]),e._v(" "),t("p",[e._v("例如，")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" set "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("includes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("当目标环境是老的浏览器例如 "),t("code",[e._v("ie 11")]),e._v("，将转换为")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/es.array.includes"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/es.array.iterator"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/es.object.to-string"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"core-js/modules/es.set"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" set "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("includes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("当目标是 "),t("code",[e._v("chrome 72")]),e._v(" 时不需要导入，因为这个环境需要 polyfills：")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" set "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("includes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Babel 7.3 之前，"),t("code",[e._v("useBuiltIns: usage")]),e._v(" 不稳定且不是足够可靠：许多 polyfills 不包函，并且添加了许多不是必须依赖的 polyfills。在 Babel 7.4 中，我尝试使它理解每种可能的使用模式。")]),e._v(" "),t("p",[e._v("在属性访问器、对象解构、"),t("code",[e._v("in")]),e._v(" 操作符、全局对象属性访问方面，我改进了确定使用哪个 polyfills 的技术。")]),e._v(" "),t("p",[t("code",[e._v("@babel/preset-env")]),e._v(" 现在注入语法特性所需的 polyfills：使用 "),t("code",[e._v("for-of")]),e._v(" 时的迭代器，解构、扩展运算符和 "),t("code",[e._v("yield")]),e._v(" 委托；使用动态 "),t("code",[e._v("import")]),e._v(" 时的 promises，异步函数和 generators，等。")]),e._v(" "),t("p",[e._v("Babel 7.4 支持注入提案 polyfills。默认，"),t("code",[e._v("@babel/preset-env")]),e._v(" 不会注入他们，但是你能够通过 "),t("code",[e._v("proposals")]),e._v(" 标志设置："),t("code",[e._v("corejs: { version: 3, proposals: true }")]),e._v("。")]),e._v(" "),t("h3",{attrs:{id:"babel-runtime"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#babel-runtime"}},[e._v("#")]),e._v(" @babel/runtime")]),e._v(" "),t("p",[e._v("当使用 "),t("code",[e._v("core-js@3")]),e._v(" 时， "),t("a",{attrs:{href:"https://babeljs.io/docs/en/next/babel-plugin-transform-runtime#corejs",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("@babel/transform-runtime")]),t("OutboundLink")],1),e._v(" 现在通过 "),t("code",[e._v("core-js-pure")]),e._v("（"),t("code",[e._v("core-js")]),e._v("的一个版本，不会污染全局变量） 注入 polyfills。")]),e._v(" "),t("p",[e._v("通过将 "),t("code",[e._v("@babel/transform-runtime")]),e._v(" 设置 "),t("code",[e._v("corejs: 3")]),e._v(" 选项和创建 "),t("code",[e._v("@babel/runtime-corejs3")]),e._v(" 包，已经将 "),t("code",[e._v("core-js@3")]),e._v(" 和 "),t("code",[e._v("@babel/runtime")]),e._v(" 集成在一起。但是这将带来什么好处呢？")]),e._v(" "),t("p",[t("code",[e._v("@babel/runtime")]),e._v(" 的一个受欢迎的 issue 是：不支持实例方法。从 "),t("code",[e._v("@babel/runtime-corejs3")]),e._v(" 开始，这个问题已经解决。例如，")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[e._v("array"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("includes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("something"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("将被编译为")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" _includesInstanceProperty "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"@babel/runtime-corejs3/core-js-stable/instance/includes"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("_includesInstanceProperty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("array"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("call")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("array"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" something"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("另一个值得关注的变化是支持 ECMAScript 提案。默认情况下的，"),t("code",[e._v("@babel/plugin-transform-runtime")]),e._v(" 不会为提案注入 polyfills 并使用不包含提案的入口。但是正如你在 "),t("code",[e._v("@babel/preset-env")]),e._v(" 中做的那样，你可以设置 "),t("code",[e._v("proposals")]),e._v(" 标志去开启："),t("code",[e._v("corejs: { version: 3, proposals: true }")]),e._v("。")]),e._v(" "),t("p",[e._v("没有 "),t("code",[e._v("proposals")]),e._v(" 标志，")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstring"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("matchAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[e._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[e._v("something")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[e._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-flags"}},[e._v("g")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("将被编译为：")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" _Set "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"@babel/runtime-corejs/core-js-stable/set"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("_set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstring"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("matchAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[e._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[e._v("something")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[e._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-flags"}},[e._v("g")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("当设置 "),t("code",[e._v("proposals")]),e._v(" 后，将变为：")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" _Set "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"@babel/runtime-corejs3/core-js/set"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" _matchAllInstanceProperty "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"@babel/runtime-corejs/core-js/instance/match-all"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("_Set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("_matchAllInstanceProperty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("call")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[e._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[e._v("something")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[e._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-flags"}},[e._v("g")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("有些老的问题已经被修复了。例如，下面这种流行的模式在 "),t("code",[e._v("@babel/runtime-corejs2")]),e._v(" 不工作，但是在 "),t("code",[e._v("@babel/runtime-corejs3")]),e._v(" 被支持。")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[e._v("myArrayLikeObject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Symbol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("tierator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Array")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("prototype"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Symbol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("iterator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("尽管 "),t("code",[e._v("@babel/runtime")]),e._v(" 早期版本不支持实例方法，但是使用一些自定义的帮助函数能够支持迭代（"),t("code",[e._v("[Symbol.iterator]()")]),e._v(" 和他的presence）。之前不支持提取 "),t("code",[e._v("[Symbol.iterator]")]),e._v(" 方法，但是现在支持了。")]),e._v(" "),t("p",[e._v("作为意外收获，"),t("code",[e._v("@babel/runtime")]),e._v(" 现在支持IE8-，但是有些限制，例如，IE8- 不支持访问器、模块转换应该用松散的方式，"),t("code",[e._v("regenerator-runtime")]),e._v("（内部使用 ES5+ 实现）需要通过这个插件转译。")]),e._v(" "),t("h2",{attrs:{id:"畅享未来"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#畅享未来"}},[e._v("#")]),e._v(" 畅享未来")]),e._v(" "),t("p",[e._v("做了许多工作，但是 "),t("code",[e._v("core-js")]),e._v(" 距离完美还很远。这个库和工具将来应该如何改进？语言的变化将会如何影响它？")]),e._v(" "),t("h3",{attrs:{id:"老的引擎支持"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#老的引擎支持"}},[e._v("#")]),e._v(" 老的引擎支持")]),e._v(" "),t("p",[e._v("现在，"),t("code",[e._v("core-js")]),e._v(" 试图去支持所有可能的引擎或者我们能够测试到的平台：甚至是IE8-，或者例如，早期版本的 Firefox。虽然它对某些用户有用，但是仅有一小部分使用 "),t("code",[e._v("core-js")]),e._v(" 的开发者需要它。对于大多数用户，它将引起像包体积过大或者执行缓慢的问题。")]),e._v(" "),t("p",[e._v("主要的问题源自于支持 ES3 引擎（首先是 IE8- ）：多数现代 ES 特性是基于 ES5，这些功能在老版本浏览器中均不可用。")]),e._v(" "),t("p",[e._v("最大的缺失特性是属性描述符：当它缺失时，一些功能不能 polyfill，因为他们要么是访问器（像 "),t("code",[e._v("RegExp.prototype.flags")]),e._v(" 或 "),t("code",[e._v("URL")]),e._v(" 属性的 setters ）要么就是基于访问器（像 typed array polyfill）。为了解决这个不足，我们需要使用不同的解决方法（例如，保持 "),t("code",[e._v("Set.prototype.size")]),e._v(" 更新）。维护这些解决方法有时很痛苦，移除他们将极大的简化许多 polyfills。")]),e._v(" "),t("p",[e._v("然而，描述符仅仅是问题的一部分。ES5 标准库包含了很多其他特性，他们被认为是现代 JavaScript 的基础："),t("code",[e._v("Object.create")]),e._v("，"),t("code",[e._v("Object.getPrototypeOf")]),e._v("，"),t("code",[e._v("Array.prototype.forEach")]),e._v("，"),t("code",[e._v("Function.prototype.bind")]),e._v("，等等。和多数现代特性不同，"),t("code",[e._v("core-js")]),e._v(" 内部依赖他们并且"),t("a",{attrs:{href:"https://github.com/babel/babel/pull/7646#discussion_r179333093",target:"_blank",rel:"noopener noreferrer"}},[e._v("为了实现一个简单的现代函数，"),t("code",[e._v("core-js")]),e._v(' 需要加载其中一些"建筑模块"的实现'),t("OutboundLink")],1),e._v("。对于想要创建一个足够小的构建包和仅仅想要引入部分 "),t("code",[e._v("core-js")]),e._v(" 的用户来说，这是个问题。")]),e._v(" "),t("p",[e._v("在一些国家 IE8 仍很流行，但是为了让 web 向前发展，浏览器到了某些时候就应该消失了。 "),t("code",[e._v("IE8")]),e._v(" 在 2009 年 3 月 19 日发布，到今天已经 10 年了。IE6 已经 18 岁了：几个月前新版的 "),t("code",[e._v("core-js")]),e._v(" 已经不再测试 IE6 了。")]),e._v(" "),t("p",[e._v("在 "),t("code",[e._v("core-js@4")]),e._v(" 我们应该舍弃 IE8- 和其他不知道 ES5 的引擎。")]),e._v(" "),t("h3",{attrs:{id:"ecmascript-模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ecmascript-模块"}},[e._v("#")]),e._v(" ECMAScript 模块")]),e._v(" "),t("p",[t("code",[e._v("core-js")]),e._v(" 使用 "),t("code",[e._v("CommonJS")]),e._v(" 模块规范。长期以来，他是最受欢迎的 JavaScript 模块规范，但是现在 ECMAScript 提供了他自己的模块规范。许多引擎已经支持它了。一些构建工具（像 rollup ）基于它，其他的构建工具提供它作为 "),t("code",[e._v("CommonJS")]),e._v(" 的替代。这意味提供了一个可选择的使用 ESMAScript 模块规范版本的 "),t("code",[e._v("core-js")]),e._v(" 行得通。")]),e._v(" "),t("h3",{attrs:{id:"支持-web-标准扩展"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#支持-web-标准扩展"}},[e._v("#")]),e._v(" 支持 web 标准扩展？")]),e._v(" "),t("p",[t("code",[e._v("core-js")]),e._v(" 当前专注在 ECMAScript 支持，但是也支持少量的跨平台以及和 ECMAScript 紧密联系的 web 标准功能。为 web 标准添加像 "),t("code",[e._v("fetch")]),e._v(" 的这种的 polyfill 是受欢迎的功能请求。")]),e._v(" "),t("p",[t("code",[e._v("core-js")]),e._v(" 没有增加他们的主要原因是，他们将严重的增加构建包大小并且将强制 "),t("code",[e._v("core-js")]),e._v(" 用户载入他们可能用不到的功能。现在 "),t("code",[e._v("core-js")]),e._v(" 是最大限度的模块化，用户能够仅选择他们需要的功能，这就像 "),t("code",[e._v("@babel/preset-env")]),e._v(" 和 "),t("code",[e._v("@babel/runtime")]),e._v(" 能够帮助用户去减少没用到和不必要的 polyfills。")]),e._v(" "),t("p",[e._v("现在是时候重新审视这个决定了？")]),e._v(" "),t("h3",{attrs:{id:"针对目标环境的-babel-runtime"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#针对目标环境的-babel-runtime"}},[e._v("#")]),e._v(" 针对目标环境的 "),t("code",[e._v("@babel/runtime")])]),e._v(" "),t("p",[e._v("目前，我们不能像对 "),t("code",[e._v("@babel/preset-env")]),e._v(" 那样为 "),t("code",[e._v("@babel/runtimne")]),e._v(" 设置目标加环境。这意味即使目标是现代浏览器， "),t("code",[e._v("@babel/runtime")]),e._v(" 也将注所有可能的 polyfills：这不必要的增加了最终构建包的大小。")]),e._v(" "),t("p",[e._v("现在 "),t("code",[e._v("core-js-compat")]),e._v(" 包函全部必要数据，将来，可以在 "),t("code",[e._v("@babel/runtime")]),e._v(" 中添加对目标环境的编译支持，并且在 "),t("code",[e._v("@babel/preset-env")]),e._v(" 中添加 "),t("code",[e._v("useBuiltIns: runtime")]),e._v(" 选项。")]),e._v(" "),t("h3",{attrs:{id:"更好的优化-polyfill-加载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更好的优化-polyfill-加载"}},[e._v("#")]),e._v(" 更好的优化 polyfill 加载")]),e._v(" "),t("p",[e._v("正如上面解释的，Babel 插件给了我们不同的方式去优化 "),t("code",[e._v("core-js")]),e._v(" 的使用，但是他并不完美：我们可以改进他们。")]),e._v(" "),t("p",[e._v("通过 "),t("code",[e._v("useBuiltIns: usage")]),e._v(" 选项，"),t("code",[e._v("@babe/preset-env")]),e._v(" 能够做的比之前更好，但是针对一些不寻常的例子他们仍然会失败：当代码不能被静态分析。针对这个问题，我们需要为库开发者寻找一个方式去确定哪种 polyfill 是他们的库需要的，而不是直接载入他们：某种元数据 -- 将在创建最终构建包时注入 polyfill。")]),e._v(" "),t("p",[e._v("另一个针对 "),t("code",[e._v("useBuiltIns: usage")]),e._v(" 的问题是重复的 polyfills 导入。"),t("code",[e._v("useBuiltIns: usage")]),e._v(" 能够在每个文件中注入许多 "),t("code",[e._v("core-js")]),e._v(" 的导入。但如果我们的项目有数千个文件或者即使十分之一会怎么样呢？这种情况下，与导入 "),t("code",[e._v("core-js")]),e._v(" 自身相比，导入 "),t("code",[e._v("core-js/...")]),e._v(" 将有更多代码行：我们需要一种方式去收集所有的导入到一个文件中，这样才能够删除重复的。")]),e._v(" "),t("p",[e._v("几乎每一个需要支持像 "),t("code",[e._v("IE11")]),e._v(" 浏览器的 "),t("code",[e._v("@babel/preset-env")]),e._v(" 用户都为每个浏览器使用同一个构建包。这意味着完全支持 ES2019 的现代浏览器将加载不必要的、仅仅是 IE11 需要的 polyfills。当然，我们可以为不同的浏览器创建不同的构建包来使用，例如，"),t("code",[e._v("type=module")]),e._v(" /\n"),t("code",[e._v("nomodules")]),e._v(" 属性：一个构建包给支持模块化的现代浏览器，另一个给传统浏览器。不幸的是，这不是针对这个问题的完整的解决方案：基于用户代理打包目标浏览器需要的 polyfill 的服务非常有用。我们已经有了一个 - "),t("a",{attrs:{href:"https://github.com/Financial-Times/polyfill-service",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("polyfill-service")]),t("OutboundLink")],1),e._v("。尽管很有趣也很流行，但是 polyfill 的质量还有很多不足。它不像几年前那么差：项目团队积极工作去改变它，但是如果你想用他们匹配原生实现，我不建议你通过这个项目使用 polyfill。许多年前我尝试通过这个项目将 "),t("code",[e._v("core-js")]),e._v(" 作为 polyfill 的源，但是这不可能。因为 "),t("code",[e._v("polyfill-service")]),e._v(" 依赖文件嵌套而不是模块化（就像 "),t("code",[e._v("core-js")]),e._v(" 发布后的前几个月 😊）。")]),e._v(" "),t("p",[e._v("像这样一个集成了一个很棒的 polyfill 源 -- "),t("code",[e._v("core-js")]),e._v(" 的服务，通过像 Babel 的 "),t("code",[e._v("useBuiltIns: usage")]),e._v(" 选项，静态分析源代码真的能够引起我们对于 polyfill 思考方式的革命。")]),e._v(" "),t("h3",{attrs:{id:"来自-tc39-的新功能预案和-core-js-可能的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#来自-tc39-的新功能预案和-core-js-可能的问题"}},[e._v("#")]),e._v(" 来自 TC39 的新功能预案和 "),t("code",[e._v("core-js")]),e._v(" 可能的问题")]),e._v(" "),t("p",[e._v("TC39 一直在努力工作去改进 ECMAScript：你可以通过查看 "),t("code",[e._v("core-js")]),e._v(" 中实现所有新提案查看进度。然而，我认为有些新的提案功能在 polyfill 或者转译时可能引起严重的问题。关于这个足够可以写一篇新的文章，但是我将尝试在这总结一下我的想法。")]),e._v(" "),t("h4",{attrs:{id:"标准库提案-stage-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#标准库提案-stage-1"}},[e._v("#")]),e._v(" 标准库提案，stage 1")]),e._v(" "),t("p",[e._v("现在，TC39 考虑给 ECMAScript 增加"),t("a",{attrs:{href:"https://github.com/tc39/proposal-javascript-standard-library",target:"_blank",rel:"noopener noreferrer"}},[e._v("内置模块"),t("OutboundLink")],1),e._v("：一个模块化的标准库。它将成为 JavaScript 的最佳补充，而 "),t("code",[e._v("core-js")]),e._v(" 是它可以被 polyfill 的最佳位置。根据 "),t("code",[e._v("@babel/preset-env")]),e._v(" 和 "),t("code",[e._v("@babel/runtime")]),e._v(" 用到的技术，理论上我们可以通过一种简单的方式注入内置模块需要的 polyfill。然而，这个提案的当前版本会导致一些严重问题，这些问题并没有使其简单明了。")]),e._v(" "),t("p",[e._v("内置模块的 polyfill，"),t("a",{attrs:{href:"https://github.com/tc39/proposal-javascript-standard-library/issues/2",target:"_blank",rel:"noopener noreferrer"}},[e._v("根据作者的提案"),t("OutboundLink")],1),e._v("，仅仅意味着退回到分层 API 或者 导入 maps。这表明如果原生模块缺失，它将能够通过提供的 url 载入一个polyfill。这绝对不是 polyfill 需要的，并且它与 "),t("code",[e._v("core-js")]),e._v(" 的架构以及其他流行的 polyfill 都不兼容。导入 maps 不应该是 polyfill 内置模块的唯一方式。")]),e._v(" "),t("p",[e._v("我们通过一个特定前缀使用 ES 模块语法就能够得到内置模块。这个语法在语言的早期版本并没有对等的 - 转译模块不可能在现在浏览器中与未转译的交互 - 这会导致包分发的问题。")]),e._v(" "),t("p",[e._v("更进一步讲，他将异步工作。对于功能检测这是个严重的问题 - 当你要检测一个功能并且加载 polyfill 时脚本不会等待 - 功能检测应该同步的做。")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://developers.google.com/web/updates/2019/03/kv-storage",target:"_blank",rel:"noopener noreferrer"}},[e._v("在没有转译和 polyfill 的情况下第一次实现内置模块"),t("OutboundLink")],1),e._v("。如果没有修改，在当前的 "),t("code",[e._v("core-js")]),e._v(" 格式下内置模块将不可能 polyfill。建议的 polyfill 方式将使开发变得严重复杂。")]),e._v(" "),t("p",[e._v("这个标准库的问题能够通过添加一个新的全局变量解决（这将是最后一个吗？）：一个内置模块的注册表将允许异步的设置和获取，例如：")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[e._v("StandardLibraryRegistry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("moduleName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nStandardLibraryRegistry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("moduleName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("异步回调，比如分层API应该全局注册表之后使用。")]),e._v(" "),t("p",[e._v("值得一提的是，它将简化将本地模块导入到老的语法的转换。")]),e._v(" "),t("h4",{attrs:{id:"装饰器提案-新的迭代器语法-stage-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#装饰器提案-新的迭代器语法-stage-2"}},[e._v("#")]),e._v(" 装饰器提案，新的迭代器语法，stage 2")]),e._v(" "),t("p",[e._v("这个提案中的 "),t("a",{attrs:{href:"https://github.com/tc39/proposal-decorators",target:"_blank",rel:"noopener noreferrer"}},[e._v("新迭代器"),t("OutboundLink")],1),e._v("，他被很认真的重做了。装饰器定义不再是语法糖，就像内置模块，我们不能在老版本的语言中编写装饰器并将其用作原生装饰器。除此之外，装饰器不仅仅是普通的标识符 - 他们生活在平行的词汇范围内：这意味着已经编译的装饰器不能喝原生装饰器交互。")]),e._v(" "),t("p",[e._v("提案作者建议使用未编译的装饰器发布包，让包的使用者选择去编译他们的依赖。然而，在不同的情况下是不可能的。当他们被添加到 JS 标准库时，这个方法将阻止 "),t("code",[e._v("core-js")]),e._v(" polyfill 新的内置装饰器。")]),e._v(" "),t("p",[e._v("装饰器应该是在某些东西上应用功能的一种方法，他们应该仅仅是包裹的语法糖。为什么要复杂化呢？")]),e._v(" "),t("hr"),e._v(" "),t("p",[e._v("如果引入的一个语言功能不是从根本上是新的，在语言的早期版本什么不应该实现是可以选择的，我们能够转译或者 polyfill 它，被转译或者 polyfill 的代码应该能够和支持这个功能的浏览器原生交互。")]),e._v(" "),t("p",[e._v("我希望根据提案作者和委员会的智慧，这些提案能够被采纳，这样才能够合理的转译或者 polyfill 他们。")]),e._v(" "),t("hr"),e._v(" "),t("p",[e._v("如果你对 "),t("code",[e._v("core-js")]),e._v(" 项目感兴趣，或者你在你日常工作中使用它，你可以成为 "),t("a",{attrs:{href:"https://opencollective.com/core-js#sponsor",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenCollective"),t("OutboundLink")],1),e._v(" 或者 "),t("a",{attrs:{href:"https://www.patreon.com/zloirock",target:"_blank",rel:"noopener noreferrer"}},[e._v("Patreon"),t("OutboundLink")],1),e._v(" 捐赠者。"),t("code",[e._v("core-js")]),e._v(" 的背后不是一个公司：他的将来要靠你。")]),e._v(" "),t("hr"),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/zloirock/core-js/issues/496",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里"),t("OutboundLink")],1),e._v(" 可以评论这篇文章。")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/zloirock",target:"_blank",rel:"noopener noreferrer"}},[e._v("Denis Pushkarev"),t("OutboundLink")],1),e._v("，2019年3月19日，感谢 "),t("a",{attrs:{href:"https://github.com/nicolo-ribaudo",target:"_blank",rel:"noopener noreferrer"}},[e._v("Nicolò Ribaudo"),t("OutboundLink")],1),e._v(" 编辑。")]),e._v(" "),t("h2",{attrs:{id:"可能用到的资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#可能用到的资料"}},[e._v("#")]),e._v(" 可能用到的资料")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://javascript.ruanyifeng.com/nodejs/module.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("CommonJS 模块规范"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"http://es6.ruanyifeng.com/#docs/module",target:"_blank",rel:"noopener noreferrer"}},[e._v("ECMAScript 模块规范"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"感谢阅读"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#感谢阅读"}},[e._v("#")]),e._v(" 感谢阅读")]),e._v(" "),t("p",[e._v("感谢你阅读到这里，翻译的不好的地方，还请指点。希望我的内容能让你受用，再次感谢。"),t("a",{attrs:{href:"https://llccing.github.io/FrontEnd/",target:"_blank",rel:"noopener noreferrer"}},[e._v("by llccing 千里"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=a.exports}}]);
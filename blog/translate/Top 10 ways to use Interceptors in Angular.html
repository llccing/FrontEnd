<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>[译]在 Angular 中使用拦截器的方式 Top 10 | Rowan Liu&#39;s Tech</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="just do it! ">
    
    <link rel="preload" href="/FrontEnd/assets/css/0.styles.4f2b0bb5.css" as="style"><link rel="preload" href="/FrontEnd/assets/js/app.563b61d9.js" as="script"><link rel="preload" href="/FrontEnd/assets/js/2.8adb25ba.js" as="script"><link rel="preload" href="/FrontEnd/assets/js/1.2b7865a3.js" as="script"><link rel="preload" href="/FrontEnd/assets/js/158.09162440.js" as="script"><link rel="prefetch" href="/FrontEnd/assets/js/10.baa43bc8.js"><link rel="prefetch" href="/FrontEnd/assets/js/100.afac3f2d.js"><link rel="prefetch" href="/FrontEnd/assets/js/101.f5620fd5.js"><link rel="prefetch" href="/FrontEnd/assets/js/102.89aadcc5.js"><link rel="prefetch" href="/FrontEnd/assets/js/103.279283cf.js"><link rel="prefetch" href="/FrontEnd/assets/js/104.b41948ca.js"><link rel="prefetch" href="/FrontEnd/assets/js/105.f362e4af.js"><link rel="prefetch" href="/FrontEnd/assets/js/106.b7f34a89.js"><link rel="prefetch" href="/FrontEnd/assets/js/107.4f9036c7.js"><link rel="prefetch" href="/FrontEnd/assets/js/108.24d98371.js"><link rel="prefetch" href="/FrontEnd/assets/js/109.7738eee9.js"><link rel="prefetch" href="/FrontEnd/assets/js/11.b0d9eefe.js"><link rel="prefetch" href="/FrontEnd/assets/js/110.2ce9f0da.js"><link rel="prefetch" href="/FrontEnd/assets/js/111.9f1522c1.js"><link rel="prefetch" href="/FrontEnd/assets/js/112.2571a0b1.js"><link rel="prefetch" href="/FrontEnd/assets/js/113.c14a7f35.js"><link rel="prefetch" href="/FrontEnd/assets/js/114.3863b008.js"><link rel="prefetch" href="/FrontEnd/assets/js/115.2f7f2513.js"><link rel="prefetch" href="/FrontEnd/assets/js/116.6b9c2a4f.js"><link rel="prefetch" href="/FrontEnd/assets/js/117.792a4806.js"><link rel="prefetch" href="/FrontEnd/assets/js/118.1b401733.js"><link rel="prefetch" href="/FrontEnd/assets/js/119.bbcfdace.js"><link rel="prefetch" href="/FrontEnd/assets/js/12.9a6eeb9a.js"><link rel="prefetch" href="/FrontEnd/assets/js/120.da047b29.js"><link rel="prefetch" href="/FrontEnd/assets/js/121.bf3c829e.js"><link rel="prefetch" href="/FrontEnd/assets/js/122.699bbf40.js"><link rel="prefetch" href="/FrontEnd/assets/js/123.0a34a2d8.js"><link rel="prefetch" href="/FrontEnd/assets/js/124.a3c86372.js"><link rel="prefetch" href="/FrontEnd/assets/js/125.4a953554.js"><link rel="prefetch" href="/FrontEnd/assets/js/126.10b0f467.js"><link rel="prefetch" href="/FrontEnd/assets/js/127.4ef65c90.js"><link rel="prefetch" href="/FrontEnd/assets/js/128.33a663ac.js"><link rel="prefetch" href="/FrontEnd/assets/js/129.8b57563e.js"><link rel="prefetch" href="/FrontEnd/assets/js/13.16a23682.js"><link rel="prefetch" href="/FrontEnd/assets/js/130.6344a4f0.js"><link rel="prefetch" href="/FrontEnd/assets/js/131.6166157b.js"><link rel="prefetch" href="/FrontEnd/assets/js/132.17b2ccff.js"><link rel="prefetch" href="/FrontEnd/assets/js/133.edb26cee.js"><link rel="prefetch" href="/FrontEnd/assets/js/134.ecc809fb.js"><link rel="prefetch" href="/FrontEnd/assets/js/135.3f15b6f2.js"><link rel="prefetch" href="/FrontEnd/assets/js/136.b3ecf38e.js"><link rel="prefetch" href="/FrontEnd/assets/js/137.d619d803.js"><link rel="prefetch" href="/FrontEnd/assets/js/138.649e8dbd.js"><link rel="prefetch" href="/FrontEnd/assets/js/139.9a200d80.js"><link rel="prefetch" href="/FrontEnd/assets/js/14.8cce3f57.js"><link rel="prefetch" href="/FrontEnd/assets/js/140.a058d22d.js"><link rel="prefetch" href="/FrontEnd/assets/js/141.39ec1428.js"><link rel="prefetch" href="/FrontEnd/assets/js/142.507e28c6.js"><link rel="prefetch" href="/FrontEnd/assets/js/143.8d156464.js"><link rel="prefetch" href="/FrontEnd/assets/js/144.d534b12c.js"><link rel="prefetch" href="/FrontEnd/assets/js/145.ef3d9119.js"><link rel="prefetch" href="/FrontEnd/assets/js/146.aa429949.js"><link rel="prefetch" href="/FrontEnd/assets/js/147.83112fce.js"><link rel="prefetch" href="/FrontEnd/assets/js/148.a1545f96.js"><link rel="prefetch" href="/FrontEnd/assets/js/149.0086c1a2.js"><link rel="prefetch" href="/FrontEnd/assets/js/15.fa3112c7.js"><link rel="prefetch" href="/FrontEnd/assets/js/150.ab67bca3.js"><link rel="prefetch" href="/FrontEnd/assets/js/151.7e6e58e7.js"><link rel="prefetch" href="/FrontEnd/assets/js/152.d9164a3f.js"><link rel="prefetch" href="/FrontEnd/assets/js/153.c383c96d.js"><link rel="prefetch" href="/FrontEnd/assets/js/154.16ac157a.js"><link rel="prefetch" href="/FrontEnd/assets/js/155.91c68711.js"><link rel="prefetch" href="/FrontEnd/assets/js/156.0e1df5f2.js"><link rel="prefetch" href="/FrontEnd/assets/js/157.cdd030e8.js"><link rel="prefetch" href="/FrontEnd/assets/js/159.ce44bf37.js"><link rel="prefetch" href="/FrontEnd/assets/js/16.f0decbe5.js"><link rel="prefetch" href="/FrontEnd/assets/js/160.cae584c1.js"><link rel="prefetch" href="/FrontEnd/assets/js/161.90dd090d.js"><link rel="prefetch" href="/FrontEnd/assets/js/162.edb4a1bb.js"><link rel="prefetch" href="/FrontEnd/assets/js/163.2feae9bc.js"><link rel="prefetch" href="/FrontEnd/assets/js/164.c7f4d175.js"><link rel="prefetch" href="/FrontEnd/assets/js/165.7ff6e5ad.js"><link rel="prefetch" href="/FrontEnd/assets/js/166.b1240869.js"><link rel="prefetch" href="/FrontEnd/assets/js/167.95928926.js"><link rel="prefetch" href="/FrontEnd/assets/js/168.f2c822ad.js"><link rel="prefetch" href="/FrontEnd/assets/js/169.70aaafcf.js"><link rel="prefetch" href="/FrontEnd/assets/js/17.be7efba3.js"><link rel="prefetch" href="/FrontEnd/assets/js/170.d84c6531.js"><link rel="prefetch" href="/FrontEnd/assets/js/171.b9f301d9.js"><link rel="prefetch" href="/FrontEnd/assets/js/172.44f5ba28.js"><link rel="prefetch" href="/FrontEnd/assets/js/173.846aee1a.js"><link rel="prefetch" href="/FrontEnd/assets/js/174.903fd0c9.js"><link rel="prefetch" href="/FrontEnd/assets/js/175.c9c81853.js"><link rel="prefetch" href="/FrontEnd/assets/js/176.a0dc6d4d.js"><link rel="prefetch" href="/FrontEnd/assets/js/177.73a6d2b9.js"><link rel="prefetch" href="/FrontEnd/assets/js/178.2c38c340.js"><link rel="prefetch" href="/FrontEnd/assets/js/179.0646642b.js"><link rel="prefetch" href="/FrontEnd/assets/js/18.824d6e67.js"><link rel="prefetch" href="/FrontEnd/assets/js/180.2f318e4f.js"><link rel="prefetch" href="/FrontEnd/assets/js/181.e5375771.js"><link rel="prefetch" href="/FrontEnd/assets/js/182.4377e458.js"><link rel="prefetch" href="/FrontEnd/assets/js/183.7d3cb81d.js"><link rel="prefetch" href="/FrontEnd/assets/js/184.b236475a.js"><link rel="prefetch" href="/FrontEnd/assets/js/185.20a2c471.js"><link rel="prefetch" href="/FrontEnd/assets/js/186.f5e1ffd9.js"><link rel="prefetch" href="/FrontEnd/assets/js/187.0119d30d.js"><link rel="prefetch" href="/FrontEnd/assets/js/188.17a19e9f.js"><link rel="prefetch" href="/FrontEnd/assets/js/189.bfc7f56d.js"><link rel="prefetch" href="/FrontEnd/assets/js/19.237a99ea.js"><link rel="prefetch" href="/FrontEnd/assets/js/190.5b9d9731.js"><link rel="prefetch" href="/FrontEnd/assets/js/191.0446fe95.js"><link rel="prefetch" href="/FrontEnd/assets/js/192.02212e07.js"><link rel="prefetch" href="/FrontEnd/assets/js/193.755f948a.js"><link rel="prefetch" href="/FrontEnd/assets/js/194.738a14f1.js"><link rel="prefetch" href="/FrontEnd/assets/js/195.989962c1.js"><link rel="prefetch" href="/FrontEnd/assets/js/196.5a4db9a8.js"><link rel="prefetch" href="/FrontEnd/assets/js/197.fafe7440.js"><link rel="prefetch" href="/FrontEnd/assets/js/198.a359d408.js"><link rel="prefetch" href="/FrontEnd/assets/js/199.a767a6ef.js"><link rel="prefetch" href="/FrontEnd/assets/js/20.815bbc82.js"><link rel="prefetch" href="/FrontEnd/assets/js/200.64c3ebe6.js"><link rel="prefetch" href="/FrontEnd/assets/js/201.b2fc8ed7.js"><link rel="prefetch" href="/FrontEnd/assets/js/202.cb8385ed.js"><link rel="prefetch" href="/FrontEnd/assets/js/203.db1f0f75.js"><link rel="prefetch" href="/FrontEnd/assets/js/204.acf79eb3.js"><link rel="prefetch" href="/FrontEnd/assets/js/205.6813917b.js"><link rel="prefetch" href="/FrontEnd/assets/js/206.0d38fc3a.js"><link rel="prefetch" href="/FrontEnd/assets/js/207.60d33d90.js"><link rel="prefetch" href="/FrontEnd/assets/js/208.cbd11d57.js"><link rel="prefetch" href="/FrontEnd/assets/js/209.04ab29ed.js"><link rel="prefetch" href="/FrontEnd/assets/js/21.e078518e.js"><link rel="prefetch" href="/FrontEnd/assets/js/210.fed85662.js"><link rel="prefetch" href="/FrontEnd/assets/js/211.639f097a.js"><link rel="prefetch" href="/FrontEnd/assets/js/212.292f3fb2.js"><link rel="prefetch" href="/FrontEnd/assets/js/213.b715d67a.js"><link rel="prefetch" href="/FrontEnd/assets/js/214.be5fc930.js"><link rel="prefetch" href="/FrontEnd/assets/js/215.4c7c501a.js"><link rel="prefetch" href="/FrontEnd/assets/js/216.625750c7.js"><link rel="prefetch" href="/FrontEnd/assets/js/217.5e9ace81.js"><link rel="prefetch" href="/FrontEnd/assets/js/218.c9e5b136.js"><link rel="prefetch" href="/FrontEnd/assets/js/219.bc8d3eb9.js"><link rel="prefetch" href="/FrontEnd/assets/js/22.f55ebfb7.js"><link rel="prefetch" href="/FrontEnd/assets/js/220.1c6df0a2.js"><link rel="prefetch" href="/FrontEnd/assets/js/221.db78c2e2.js"><link rel="prefetch" href="/FrontEnd/assets/js/222.ca2407c4.js"><link rel="prefetch" href="/FrontEnd/assets/js/223.92913972.js"><link rel="prefetch" href="/FrontEnd/assets/js/224.76e84dd8.js"><link rel="prefetch" href="/FrontEnd/assets/js/225.0114d849.js"><link rel="prefetch" href="/FrontEnd/assets/js/226.8d474d50.js"><link rel="prefetch" href="/FrontEnd/assets/js/227.36f8c4cc.js"><link rel="prefetch" href="/FrontEnd/assets/js/228.5262e110.js"><link rel="prefetch" href="/FrontEnd/assets/js/229.1b70fbce.js"><link rel="prefetch" href="/FrontEnd/assets/js/23.f3b97037.js"><link rel="prefetch" href="/FrontEnd/assets/js/230.96a47133.js"><link rel="prefetch" href="/FrontEnd/assets/js/231.f2db7533.js"><link rel="prefetch" href="/FrontEnd/assets/js/232.0f873508.js"><link rel="prefetch" href="/FrontEnd/assets/js/233.a4546af6.js"><link rel="prefetch" href="/FrontEnd/assets/js/234.dea3d535.js"><link rel="prefetch" href="/FrontEnd/assets/js/235.16f9d78b.js"><link rel="prefetch" href="/FrontEnd/assets/js/236.646eb749.js"><link rel="prefetch" href="/FrontEnd/assets/js/237.93b7c444.js"><link rel="prefetch" href="/FrontEnd/assets/js/238.ff86f6a6.js"><link rel="prefetch" href="/FrontEnd/assets/js/239.8462ce89.js"><link rel="prefetch" href="/FrontEnd/assets/js/24.3bc95e7e.js"><link rel="prefetch" href="/FrontEnd/assets/js/240.76529ec3.js"><link rel="prefetch" href="/FrontEnd/assets/js/241.5c293e5e.js"><link rel="prefetch" href="/FrontEnd/assets/js/242.0ae047b9.js"><link rel="prefetch" href="/FrontEnd/assets/js/243.995ec2d1.js"><link rel="prefetch" href="/FrontEnd/assets/js/244.0f56178d.js"><link rel="prefetch" href="/FrontEnd/assets/js/245.6f159c3c.js"><link rel="prefetch" href="/FrontEnd/assets/js/246.a8e64966.js"><link rel="prefetch" href="/FrontEnd/assets/js/247.def92372.js"><link rel="prefetch" href="/FrontEnd/assets/js/248.6d87548b.js"><link rel="prefetch" href="/FrontEnd/assets/js/249.fce5bbc7.js"><link rel="prefetch" href="/FrontEnd/assets/js/25.2c574b16.js"><link rel="prefetch" href="/FrontEnd/assets/js/250.b03e9418.js"><link rel="prefetch" href="/FrontEnd/assets/js/251.e13cfca3.js"><link rel="prefetch" href="/FrontEnd/assets/js/26.404bd7b0.js"><link rel="prefetch" href="/FrontEnd/assets/js/27.f9d07935.js"><link rel="prefetch" href="/FrontEnd/assets/js/28.f2c29f05.js"><link rel="prefetch" href="/FrontEnd/assets/js/29.66c9e6d6.js"><link rel="prefetch" href="/FrontEnd/assets/js/3.7cb89d46.js"><link rel="prefetch" href="/FrontEnd/assets/js/30.2a8e3c0d.js"><link rel="prefetch" href="/FrontEnd/assets/js/31.9ac3c86d.js"><link rel="prefetch" href="/FrontEnd/assets/js/32.ed49514b.js"><link rel="prefetch" href="/FrontEnd/assets/js/33.ca977b94.js"><link rel="prefetch" href="/FrontEnd/assets/js/34.9a84ba15.js"><link rel="prefetch" href="/FrontEnd/assets/js/35.ae1b4ed3.js"><link rel="prefetch" href="/FrontEnd/assets/js/36.67b8c365.js"><link rel="prefetch" href="/FrontEnd/assets/js/37.ee3d3382.js"><link rel="prefetch" href="/FrontEnd/assets/js/38.2aa4d464.js"><link rel="prefetch" href="/FrontEnd/assets/js/39.94d8de4c.js"><link rel="prefetch" href="/FrontEnd/assets/js/4.98d3141a.js"><link rel="prefetch" href="/FrontEnd/assets/js/40.46ce0764.js"><link rel="prefetch" href="/FrontEnd/assets/js/41.1c0d781c.js"><link rel="prefetch" href="/FrontEnd/assets/js/42.973fa131.js"><link rel="prefetch" href="/FrontEnd/assets/js/43.507baa0a.js"><link rel="prefetch" href="/FrontEnd/assets/js/44.452d54e6.js"><link rel="prefetch" href="/FrontEnd/assets/js/45.a5df2cfd.js"><link rel="prefetch" href="/FrontEnd/assets/js/46.ede8c56c.js"><link rel="prefetch" href="/FrontEnd/assets/js/47.a6f5a861.js"><link rel="prefetch" href="/FrontEnd/assets/js/48.3549d856.js"><link rel="prefetch" href="/FrontEnd/assets/js/49.90107382.js"><link rel="prefetch" href="/FrontEnd/assets/js/5.b67bc082.js"><link rel="prefetch" href="/FrontEnd/assets/js/50.9f7001a4.js"><link rel="prefetch" href="/FrontEnd/assets/js/51.705e2c4c.js"><link rel="prefetch" href="/FrontEnd/assets/js/52.531bf36c.js"><link rel="prefetch" href="/FrontEnd/assets/js/53.3ec56643.js"><link rel="prefetch" href="/FrontEnd/assets/js/54.18ab22c1.js"><link rel="prefetch" href="/FrontEnd/assets/js/55.75e5d770.js"><link rel="prefetch" href="/FrontEnd/assets/js/56.a9e7f021.js"><link rel="prefetch" href="/FrontEnd/assets/js/57.df37d1a9.js"><link rel="prefetch" href="/FrontEnd/assets/js/58.7491723b.js"><link rel="prefetch" href="/FrontEnd/assets/js/59.b886d977.js"><link rel="prefetch" href="/FrontEnd/assets/js/6.591c95cc.js"><link rel="prefetch" href="/FrontEnd/assets/js/60.e7e0ff29.js"><link rel="prefetch" href="/FrontEnd/assets/js/61.c3994964.js"><link rel="prefetch" href="/FrontEnd/assets/js/62.843024f2.js"><link rel="prefetch" href="/FrontEnd/assets/js/63.a0e47c2e.js"><link rel="prefetch" href="/FrontEnd/assets/js/64.f169ee62.js"><link rel="prefetch" href="/FrontEnd/assets/js/65.82f74e78.js"><link rel="prefetch" href="/FrontEnd/assets/js/66.57f0d87b.js"><link rel="prefetch" href="/FrontEnd/assets/js/67.1f957a20.js"><link rel="prefetch" href="/FrontEnd/assets/js/68.70ba2bbf.js"><link rel="prefetch" href="/FrontEnd/assets/js/69.32e094e3.js"><link rel="prefetch" href="/FrontEnd/assets/js/7.25cc85f1.js"><link rel="prefetch" href="/FrontEnd/assets/js/70.889a8939.js"><link rel="prefetch" href="/FrontEnd/assets/js/71.1697942c.js"><link rel="prefetch" href="/FrontEnd/assets/js/72.d66f7c55.js"><link rel="prefetch" href="/FrontEnd/assets/js/73.fefa8263.js"><link rel="prefetch" href="/FrontEnd/assets/js/74.c7e62258.js"><link rel="prefetch" href="/FrontEnd/assets/js/75.72fbb890.js"><link rel="prefetch" href="/FrontEnd/assets/js/76.607d88ae.js"><link rel="prefetch" href="/FrontEnd/assets/js/77.7ee2c207.js"><link rel="prefetch" href="/FrontEnd/assets/js/78.137b2dc7.js"><link rel="prefetch" href="/FrontEnd/assets/js/79.0f3a499a.js"><link rel="prefetch" href="/FrontEnd/assets/js/80.22a31dae.js"><link rel="prefetch" href="/FrontEnd/assets/js/81.632b2704.js"><link rel="prefetch" href="/FrontEnd/assets/js/82.eb747c07.js"><link rel="prefetch" href="/FrontEnd/assets/js/83.2d78a760.js"><link rel="prefetch" href="/FrontEnd/assets/js/84.df371cc8.js"><link rel="prefetch" href="/FrontEnd/assets/js/85.6c8bedaf.js"><link rel="prefetch" href="/FrontEnd/assets/js/86.7e11067b.js"><link rel="prefetch" href="/FrontEnd/assets/js/87.6519614b.js"><link rel="prefetch" href="/FrontEnd/assets/js/88.7cb416d1.js"><link rel="prefetch" href="/FrontEnd/assets/js/89.49c9200f.js"><link rel="prefetch" href="/FrontEnd/assets/js/90.2db382a0.js"><link rel="prefetch" href="/FrontEnd/assets/js/91.1b2cf86e.js"><link rel="prefetch" href="/FrontEnd/assets/js/92.ca279eb4.js"><link rel="prefetch" href="/FrontEnd/assets/js/93.54a41290.js"><link rel="prefetch" href="/FrontEnd/assets/js/94.b41c6e43.js"><link rel="prefetch" href="/FrontEnd/assets/js/95.3d3bb864.js"><link rel="prefetch" href="/FrontEnd/assets/js/96.4815df39.js"><link rel="prefetch" href="/FrontEnd/assets/js/97.955b7339.js"><link rel="prefetch" href="/FrontEnd/assets/js/98.f63ef305.js"><link rel="prefetch" href="/FrontEnd/assets/js/99.50642c97.js"><link rel="prefetch" href="/FrontEnd/assets/js/vendors~docsearch.162bdabc.js">
    <link rel="stylesheet" href="/FrontEnd/assets/css/0.styles.4f2b0bb5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/FrontEnd/" class="home-link router-link-active"><!----> <span class="site-name">Rowan Liu's Tech</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/FrontEnd/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/translate/" class="nav-link router-link-active">
  翻译
</a></li><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/dataStructure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/design-pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><a href="/FrontEnd/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/FrontEnd/js/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/FrontEnd/lib/" class="nav-link">
  lib
</a></div><div class="nav-item"><a href="/FrontEnd/read/" class="nav-link">
  Read
</a></div><div class="nav-item"><a href="https://rowanliu.com/about" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/FrontEnd/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/translate/" class="nav-link router-link-active">
  翻译
</a></li><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/dataStructure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/FrontEnd/blog/design-pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><a href="/FrontEnd/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/FrontEnd/js/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/FrontEnd/lib/" class="nav-link">
  lib
</a></div><div class="nav-item"><a href="/FrontEnd/read/" class="nav-link">
  Read
</a></div><div class="nav-item"><a href="https://rowanliu.com/about" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/FrontEnd/blog/" aria-current="page" class="sidebar-link">在专精的路上走的一发不可收拾</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>生活有感</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FrontEnd/blog/life/lerna.html" class="sidebar-link">lerna</a></li><li><a href="/FrontEnd/blog/life/jQuery.html" class="sidebar-link">jQuery实践</a></li><li><a href="/FrontEnd/blog/life/gzip.html" class="sidebar-link">gzip</a></li><li><a href="/FrontEnd/blog/life/2018-dev-guide.html" class="sidebar-link">2018 Web开发,实用指南</a></li><li><a href="/FrontEnd/blog/life/for.html" class="sidebar-link">for 追求</a></li><li><a href="/FrontEnd/blog/life/ci.html" class="sidebar-link">Travis CI</a></li><li><a href="/FrontEnd/blog/life/useGulp.html" class="sidebar-link">前端基础设施(gulp)</a></li><li><a href="/FrontEnd/blog/life/FrontEndLive.html" class="sidebar-link">知乎Live--前端工程师的职业规划</a></li><li><a href="/FrontEnd/blog/life/architecture.html" class="sidebar-link">前端架构演进</a></li><li><a href="/FrontEnd/blog/life/vueComponent.html" class="sidebar-link">组件的重写</a></li><li><a href="/FrontEnd/blog/life/vue-cli2-to-vue-cli3.html" class="sidebar-link">vue-cli2 to vue-cli3</a></li><li><a href="/FrontEnd/blog/life/vue3.html" class="sidebar-link">vue3</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>翻译</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FrontEnd/blog/translate/" aria-current="page" class="sidebar-link">开篇</a></li><li><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html" class="active sidebar-link">[译]在 Angular 中使用拦截器的方式 Top 10</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#httpinterceptor-101" class="sidebar-link">HttpInterceptor 101</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#_10-url" class="sidebar-link">10.URL</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#_9-loader" class="sidebar-link">9.Loader</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#_8-转换" class="sidebar-link">8.转换</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#_7-headers" class="sidebar-link">7.Headers</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#_6-通知" class="sidebar-link">6.通知</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#_5-errors" class="sidebar-link">5.Errors</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#_4-分析" class="sidebar-link">4.分析</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#_3-伪造后端" class="sidebar-link">3. 伪造后端</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#_2-缓存" class="sidebar-link">2. 缓存</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#_1-认证" class="sidebar-link">1.认证</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#资源" class="sidebar-link">资源</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#译者参考" class="sidebar-link">译者参考</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/blog/translate/Top 10 ways to use Interceptors in Angular.html#感谢阅读" class="sidebar-link">感谢阅读</a></li></ul></li><li><a href="/FrontEnd/blog/translate/what-you-need-know-about-Vue-3-in-2020.html" class="sidebar-link">2020年关于 Vue 3 你需要知道的事</a></li><li><a href="/FrontEnd/blog/translate/core-js@3, babel and a look into the future.html" class="sidebar-link">core-js@3, babel展望未来</a></li><li><a href="/FrontEnd/blog/translate/vue-cli-plugin-dev.html" class="sidebar-link">Vue CLI 插件开发指南</a></li><li><a href="/FrontEnd/blog/translate/vue-cli-plugin-typescript-readme.html" class="sidebar-link">@vue/cli-plugin-typescript README</a></li><li><a href="/FrontEnd/blog/translate/vue-cli-plugin-eslint-readme.html" class="sidebar-link">@vue/cli-plugin-eslint</a></li><li><a href="/FrontEnd/blog/translate/making-vue-3.html" class="sidebar-link">Vue 3 的开发进展</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>那些年我面过的试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FrontEnd/blog/interview/" class="sidebar-link">开篇</a></li><li><a href="/FrontEnd/blog/interview/js.html" class="sidebar-link">JavaScript</a></li><li><a href="/FrontEnd/blog/interview/css.html" class="sidebar-link">css</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据结构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FrontEnd/blog/dataStructure/" class="sidebar-link">排序</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FrontEnd/blog/design-pattern/" class="sidebar-link">开篇</a></li><li><a href="/FrontEnd/blog/design-pattern/OOP.html" class="sidebar-link">OOP</a></li><li><a href="/FrontEnd/blog/design-pattern/validateForm.html" class="sidebar-link">表单验证</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="译-在-angular-中使用拦截器的方式-top-10"><a href="#译-在-angular-中使用拦截器的方式-top-10" class="header-anchor">#</a> [译]在 Angular 中使用拦截器的方式 Top 10</h1> <blockquote><p><a href="https://medium.com/angular-in-depth/top-10-ways-to-use-interceptors-in-angular-db450f8a62d6" target="_blank" rel="noopener noreferrer">原文在此，也可以看原文哦<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>有许多种方式使用拦截器，我确定我们大多数人使用的很浅显。在这篇文章中，我将介绍在 Angular 中我最喜欢的 10 种使用拦截器的方式。</p> <p>我使例子尽可能的简洁。我希望他们能够启发你们去思考使用拦截器的新方式。这篇文章不是关于拦截器教学的，因为已经有很多好的文章了。但是，在开始倒数之前，让我们以一些基础的知识点开始。</p> <h2 id="httpinterceptor-101"><a href="#httpinterceptor-101" class="header-anchor">#</a> HttpInterceptor 101</h2> <p><a href="https://angular.io/api/common/http/HttpInterceptor" target="_blank" rel="noopener noreferrer">HttpInterceptor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是在 Angular 4.3 引入。它提供一种方式拦截 HTTP 请求和响应，在传递他们之前转换或者处理他们。</p> <blockquote><p>尽管拦截器能够改变请求和响应，但是 <a href="https://angular.io/api/common/http/HttpRequest" target="_blank" rel="noopener noreferrer">HttpRequest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://angular.io/api/common/http/HttpResponse" target="_blank" rel="noopener noreferrer">HttpResponse<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实例属性是 <code>只读</code> 的，从而使它们在很大程度上不可变。 — Angular Docs</p></blockquote> <p>这是因为我们可能想要在某个请求第一次没成功后重试。不变性确保了拦截器链能够多次重新处理相同的请求。</p> <p>你可以使用多个拦截器，但是这个记心中：</p> <blockquote><p>Angular 通过你定义他们的顺序应用拦截器。如果你定义的拦截器的顺序是 A-&gt;B-&gt;C，请求将按 A-&gt;B-&gt;C 的顺序流入，响应将按 C-&gt;B-&gt;A 的顺序流入。</p></blockquote> <blockquote><p>之后，不能改变顺序或者移除拦截器。如果你需要动态启用、禁用拦截器，你不得不在拦截器本身增加这个功能。— Angular Docs</p></blockquote> <p>在示例 APP 中，我们提供了全部拦截器，但是一次仅使用一个。这通过检查路径实现（<a href="https://github.com/melcor76/interceptors/blob/172be0444d505c6164ff506ab311a4966ce8c78f/src/app/interceptors/auth.interceptor.ts#L30" target="_blank" rel="noopener noreferrer">代码在这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）。如果不是我们找的请求，我们通过 <code>next.handle(req)</code> 传递给下一个拦截器。</p> <p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/01.png" alt="01"></p> <p>拦截器的另一个好处是他们能够<code>一起处理请求和响应</code>。我们将看到，这给我们很好的可能性。</p> <p>更多深度知识，可以看 <a href="https://medium.com/u/bd29063a4857?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">Max Koretskyi aka Wizard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  这篇很棒的文章:</p> <ul><li><a href="https://medium.com/angular-in-depth/insiders-guide-into-interceptors-and-httpclient-mechanics-in-angular-103fbdb397bf" target="_blank" rel="noopener noreferrer">Angular 拦截器内部指南和 HttpClient 机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>在示例的 HTTP 请求中，我使用了 <a href="https://jsonplaceholder.typicode.com/" target="_blank" rel="noopener noreferrer">JSONPlaceholder<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这个网站。如果你想看代码，你可以从这里找到：</p> <ul><li><p>10.x 版本，译者版本
<a href="https://github.com/llccing-demo/ng-interceptors" target="_blank" rel="noopener noreferrer">GitHub 示例代码 10.x版本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 📜
<a href="https://stackblitz.com/github/" target="_blank" rel="noopener noreferrer">StackBlitz 线上运行<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 🏃</p></li> <li><p>8.x 版本，作者版本
<a href="https://github.com/melcor76/interceptors" target="_blank" rel="noopener noreferrer">GitHub 示例代码 8.x版本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 📜
<a href="https://stackblitz.com/github/melcor76/interceptors" target="_blank" rel="noopener noreferrer">StackBlitz 线上运行<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 🏃</p></li></ul> <p>现在，让我们开始倒数吧！</p> <p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/02.jfif" alt="02"></p> <h2 id="_10-url"><a href="#_10-url" class="header-anchor">#</a> 10.URL</h2> <p>操纵 URL。当我大声说出来时，听起来有些风险，但是让我们看下在拦截器下做这个事情是多么简单。</p> <p>例如，我们想从 HTTP 变为 HTTPS。</p> <p>就像克隆请求同时使用 https:// 替换 http:// 一样简单。然后我们将克隆的 HTTPS 请求发送到下一个 handler。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 克隆请求，同时使用 https:// 替换 http://</span>
<span class="token keyword">const</span> httpsReq <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> req<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'http://'</span><span class="token punctuation">,</span> <span class="token string">'https://'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>httpsReq<span class="token punctuation">)</span>
</code></pre></div><p>这个例子中，我们设置 URL 为 HTTP，但是当我们检查请求时，我们能看见它已经变成了 HTTPS。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://jsonplaceholder.typicode.com/todos/1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>response <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/03.png" alt="03"></p> <p>自动化魔术 https，为什么这个不高明呢。通常你可以通过 web 服务器设置这些事情。或者你想在开发环境从 HTTP 切换到 HTTPS，你可以使用这个 <a href="https://angular.io/cli/serve" target="_blank" rel="noopener noreferrer">CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-js extra-class"><pre class="language-js"><code>ng serve <span class="token operator">-</span>ssl
</code></pre></div><p>类似，你可以修改一点 URL，并且成它为 API 前缀拦截器：</p> <div class="language-js extra-class"><pre class="language-js"><code>req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> environment<span class="token punctuation">.</span>serverUrl <span class="token operator">+</span> request<span class="token punctuation">.</span>url
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者你可以再次通过 CLI 来实现：</p> <div class="language-js extra-class"><pre class="language-js"><code>ng serve <span class="token operator">-</span> serve<span class="token operator">-</span>path<span class="token operator">=</span><span class="token operator">&lt;</span>path<span class="token operator">&gt;</span> <span class="token operator">-</span> base<span class="token operator">-</span>href <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span><span class="token operator">/</span>
</code></pre></div><p>感谢 <a href="https://medium.com/u/d91c7d086b4b?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">David Herges<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 CLI 提示。</p> <h2 id="_9-loader"><a href="#_9-loader" class="header-anchor">#</a> 9.Loader</h2> <p>当我们等待响应时，每个人都希望看见命运的纺纱轮（表示旋转的loading）。只要在请求活跃的时候，我们在拦截器中统一设置，这样我们就能够看见 loader 了。</p> <p>首先，我们能够使用 loader 服务，这样就有了展示和隐藏 loader 的功能。在处理请求前，我们调用<code>展示</code>方法并通过 finalize 完成后<code>隐藏</code> loader。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> loaderService <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>injector<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>LoaderService<span class="token punctuation">)</span><span class="token punctuation">;</span>

loaderService<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> loaderService<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>这个例子很简单，在真实的解决方案中，我们应该考虑到会有多个 HTTP 请求被拦截。这可以通过一个请求（+1）响应（-1）的计数器来解决这个问题。</p> <p>当然，我添加了一个延迟来让我们有时间能够看到 loader。</p> <p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/04.gif" alt="04"></p> <p>全局的 loader 听起来是个不错的主意，但是这个为什么不在列表中呢？可能它适合特定的应用，但是如果你同时加载多个，你可能想要对 loader 定制化。</p> <p>我将给你留下一些思考的空间。如果你用 <a href="https://www.learnrxjs.io/operators/transformation/switchmap.html" target="_blank" rel="noopener noreferrer">switchMap<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 去取消请求将会发生什么？</p> <h2 id="_8-转换"><a href="#_8-转换" class="header-anchor">#</a> 8.转换</h2> <p>当 API 返回一个我们不赞同的格式，我们能够使用拦截器去格式化成我们想要的样子。</p> <p>这能够从 XML 转换到 JSON，或者像例子中的属性名字从大驼峰拼写到小驼峰拼写。如果后端不关心 JSON/JS 转换，我们能够使用拦截器将全部属性名重命名为小驼峰。</p> <p>检查是否有 npm 包能够为你完成繁重的工作。在这个例子中我使用 <a href="https://www.npmjs.com/package/lodash" target="_blank" rel="noopener noreferrer">loadsh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <a href="https://lodash.com/docs#mapKeys" target="_blank" rel="noopener noreferrer">mapKeys<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://lodash.com/docs#camelCase" target="_blank" rel="noopener noreferrer">camelCase<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">event</span><span class="token operator">:</span> HttpEvent<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token keyword">instanceof</span> <span class="token class-name">HttpResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> camelCaseObject <span class="token operator">=</span> <span class="token function">mapKeys</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span>k</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">camelCase</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> modEvent <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">body</span><span class="token operator">:</span> camelCaseObjec <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> modEvent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>这个事情通常是后端来做，所以我通常不这么做。但是将这个加入到的兵器库，这样你需要的时候就能够使用了。</p> <p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/05.gif" alt="05"></p> <h2 id="_7-headers"><a href="#_7-headers" class="header-anchor">#</a> 7.Headers</h2> <p>通过操纵 headers 我们能够做许多事，例如：</p> <ul><li>认证（authentication）/ 授权（authorization）</li> <li>缓存行为；例如，If-Modified-Since</li> <li><a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" target="_blank" rel="noopener noreferrer">XSRF<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 保护</li></ul> <p>我们能够通过拦截器轻而易举的添加 headers。</p> <div class="language-js extra-class"><pre class="language-js"><code>cosnt modified <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">setHeaders</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;X-Man&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wolverine&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>modified<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后我们在开发者工具中就能够看到它被添加到了请求头中。</p> <p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/06.png" alt="06"></p> <p>Angular 使用拦截器来防范 <a href="https://angular.io/guide/http#security-xsrf-protection" target="_blank" rel="noopener noreferrer">跨站请求伪造<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（XSRF）。通过读取 cookie 中的 <code>XSRF-TOKEN</code> 并设置一个 <code>X-XSRF-TOKEN</code> 请求头来实现。仅仅运行在你的域名中的代码才能够读取 cookie，这样后端能够确定 HTTP 请求来自己客户端程序而不是攻击者。</p> <p>如你所见，在拦截器中能够直接操纵 headers。接下来我们将看到更多操纵 headers 的例子。</p> <h2 id="_6-通知"><a href="#_6-通知" class="header-anchor">#</a> 6.通知</h2> <p>这里有很多不同的例子用于展示消息。在我的例子中，每次从服务器获得 201 创建状态时，我会展示“Object created.”。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">hadle</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">event</span><span class="token operator">:</span> HttpEvent<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token keyword">instanceof</span> <span class="token class-name">HttpResponse</span> <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">201</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>toastr<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'Object created.'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者我们检查对象的类型来展示“Type created”。或者通过将数据和消息包裹到对象中创建一个定制的消息。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/08.gif" alt="08"></p> <p>当发生错误的时候，我们也可以通过拦截器展示通知。</p> <h2 id="_5-errors"><a href="#_5-errors" class="header-anchor">#</a> 5.Errors</h2> <p>在这个拦截器中我们实现了两个关于错误的用例。</p> <p>首先，我们能够<code>重试 HTTP 请求</code>。例如，网络中断在移动端场景很常见，再试一次可能会成功。值得考虑的事情是在放弃之前的重试次数。我们应该在重试前等待吗，或者立即重试？</p> <p>对于这点，我们使用 RxJS 中的 <a href="https://rxjs-dev.firebaseapp.com/api/operators/retry" target="_blank" rel="noopener noreferrer">retry<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 操作符重新订阅 observable。HttpClient 方法调用的重新订阅具有再次发出 HTTP 请求的效果。</p> <p>这种行为的更高级的示例：</p> <ul><li><a href="https://www.learnrxjs.io/operators/error_handling/retrywhen.html" target="_blank" rel="noopener noreferrer">当发生错误时，基于自定义标准重试 observable 序列<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://medium.com/angular-in-depth/power-of-rxjs-when-using-exponential-backoff-a4b8bde276b0" target="_blank" rel="noopener noreferrer">当使用幂等回退时 rxjs 的能力<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>第二点，检查异常的状态。基于状态，决定应该做什么。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">error</span><span class="token operator">:</span> HttpErrorResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 401 在 auth.interceptor 中处理了</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>toastr<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">throwError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>这个例子中，在检查错误状态前，我们重试了两次。如果状态不是 401，我们已弹出（toastr）的形式展示错误。所有的错误将重新抛出来进一步处理。</p> <p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/09.png" alt="09"></p> <p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/10.png" alt="10"></p> <p>更多的错误处理的知识，你可以在这里阅读我早期的文章：</p> <ul><li><a href="https://medium.com/angular-in-depth/expecting-the-unexpected-best-practices-for-error-handling-in-angular-21c3662ef9e4" target="_blank" rel="noopener noreferrer">期待意外 -- Angular 错误处理的最佳实践<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="_4-分析"><a href="#_4-分析" class="header-anchor">#</a> 4.分析</h2> <p>因为拦截器能够同时处理请求和响应，能够在一次完整的 HTTP 操作中计时和记日志。所以我们能够捕获请求和响应时间，记录经过的时间结果。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> started <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> ok<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">tap</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>event<span class="token operator">:</span> HttpEvent<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ok <span class="token operator">=</span> event <span class="token keyword">instanceof</span> <span class="token class-name">HttpResponse</span> <span class="token operator">?</span> <span class="token string">'successed'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>error<span class="token operator">:</span> HttpEventResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ok <span class="token operator">=</span> <span class="token string">'failed'</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// 响应 observable 结束或者完成的时候记日志</span>
    <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> elapsed <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> started<span class="token punctuation">;</span>
        <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>urlWithParams<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ok<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>elapsed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ms.</span><span class="token template-punctuation string">`</span></span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre></div><p>这有许多中可能，例如，我们能记录分析日志到数据库中做统计。这个例子中，我们输出到 console。</p> <p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/11.png" alt="11"></p> <h2 id="_3-伪造后端"><a href="#_3-伪造后端" class="header-anchor">#</a> 3. 伪造后端</h2> <p>当没有后端服务时，可以在开发中模拟或者伪装后端。你也可以将其用于 StackBlitz 中托管的代码。</p> <p>我们基于请求模拟返回，然后返回一个 HttpResponse observable。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'mock'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'Faker'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpResponse</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">body</span><span class="token operator">:</span> body <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/12.gif" alt="12"></p> <h2 id="_2-缓存"><a href="#_2-缓存" class="header-anchor">#</a> 2. 缓存</h2> <p>因为拦截器能够自己处理请求，没有转发到 <code>next.handle()</code>，所以我们利用这一点来缓存请求。</p> <p>在 key-value map 构成的缓存中，我们使用 URL 作为 key。如果我们响应在 map 中，我们能够通过 <code>next</code> handler 返回这个 observable 响应。</p> <p>当你已经有响应缓存时，你不需要一路走到后端，这个提升了性能。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpEvent<span class="token punctuation">,</span> HttpRequest<span class="token punctuation">,</span> HttpHandler<span class="token punctuation">,</span> HttpInterceptor<span class="token punctuation">,</span> HttpResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable<span class="token punctuation">,</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> tap<span class="token punctuation">,</span> shareReplay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CacheInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HttpInterceptor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token operator">&lt;</span>string<span class="token punctuation">,</span> any<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">intercept</span><span class="token punctuation">(</span>request<span class="token operator">:</span> HttpRequest<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> HttpHandler<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>HttpEvent<span class="token operator">&lt;</span>any<span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>method <span class="token operator">!==</span> <span class="token string">'Get'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> cacheResponse <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span>cacheResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
            <span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token keyword">instanceof</span> <span class="token class-name">HttpResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>如果我们运行这个请求，清空响应然后再次运行将使用缓存。</p> <p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/13.gif" alt="13"></p> <p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/14.png" alt="14"></p> <p>如果数据更新了，你需要使缓存失效，这会引入一些复杂性。但是现在不用担心！缓存生效的时候是真的爽！</p> <p>关于缓存的更多知识可以读 <a href="https://medium.com/u/6317765dd4e6?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">Dominic E.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的这篇很帮的文章：</p> <ul><li><a href="https://blog.thoughtram.io/angular/2018/03/05/advanced-caching-with-rxjs.html" target="_blank" rel="noopener noreferrer">RxJS 高级缓存<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="_1-认证"><a href="#_1-认证" class="header-anchor">#</a> 1.认证</h2> <p>清单中的第一个是认证！对于很多应用来说他是基本的，我们已经有了适当的认证系统。这是拦截器最常见的用例之一，有充分的理由。恰到好处！</p> <p>有几个和权限相关的事情我们能做：</p> <ol><li>添加 bearer token</li> <li>重新刷新 token</li> <li>重定向到登录页</li></ol> <p>当我们发送 bearer token 时，我们也应该有些过滤。如果我们还没 token，我们可能在登录，并不需要添加 token。或者如果我们调用其他域名，我们也不希望添加 token。例如，如果<a href="https://medium.com/dailyjs/how-to-send-errors-into-slack-dc552e30506f" target="_blank" rel="noopener noreferrer">向 Slack 发送错误信息<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>相比于其他拦截器这个会有点复杂。这是一个带有一些解释性注释的例子：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpEvent<span class="token punctuation">,</span> HttpInterceptor<span class="token punctuation">,</span> HttpHandler<span class="token punctuation">,</span> HttpRequest<span class="token punctuation">,</span> HttpErrorResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> throwError<span class="token punctuation">,</span> Observable<span class="token punctuation">,</span> BehaviorSubject<span class="token punctuation">,</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> catchError<span class="token punctuation">,</span> filter<span class="token punctuation">,</span> take<span class="token punctuation">,</span> switchMap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HttpInterceptor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token constant">AUTH_HEADER</span> <span class="token operator">=</span> <span class="token string">'Authorization'</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> token <span class="token operator">=</span> <span class="token string">'secrettoken'</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> refreshTokenInProgress <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> refreshTokenSubject<span class="token operator">:</span> BehaviorSubject<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">intercept</span><span class="token punctuation">(</span>req<span class="token operator">:</span> HttpRequest<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> next<span class="token operator">:</span> HttpHandler<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>HttpEvent<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            req <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                headers<span class="token operator">:</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/json'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        req <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addAuthenticationToken</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
            <span class="token function">cacheError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token operator">:</span> HttpErrorResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refreshTokenInProgress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>refreshTokenSubject<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                            <span class="token function">filter</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> result <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token function">take</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addAuthenticationToken</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>refreshTokenInProgress <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                        <span class="token comment">// 设置 refreshTokenSubject 为 null，这样随后的 API 将等到新的 token 被取回时才调用。</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>refreshTokenSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refreshAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                            <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>success<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                <span class="token keyword">this</span><span class="token punctuation">.</span>refreshTokenSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addAuthenticationToken</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

                            <span class="token comment">// 当我们调用刷新 token 方法完成时，重置 refreshTokenInProgress 为 false，</span>
                            <span class="token comment">// 这是为了下次 token 需要再次被刷新</span>
                            <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>refreshTokenInProgress <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                        <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">throwError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token function">refreshAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token string">'secret token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token function">addAuthenticationToken</span><span class="token punctuation">(</span>request<span class="token operator">:</span> HttpRequest<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> HttpRequest<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果还没有 token，不应该在 header 中设置 token。</span>
        <span class="token comment">// 首先我们应该从存储 token 的地方取回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> request<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 如果访问外部域名不应该添加 token</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">www.mydomain.com\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> request<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> request<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            headers<span class="token operator">:</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">AUTH_HEADER</span><span class="token punctuation">,</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>token<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>大吉大利，今晚吃鸡！🚀</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>拦截器是 Angular 4.3 中一个重要的功能，这里我们看到了很多很棒的功能。现在发挥你的创造力，我相信你可以想出一些有趣的东西！</p> <p>记住，通过使用拦截器，你可以像蝙蝠侠一样棒！</p> <p><img src="http://static.llccing.cn/front-end/top-10-ways-to-use-interceptors/15.jfif" alt="15"></p> <ul><li><p>10.x 版本，译者版本
<a href="https://github.com/llccing-demo/ng-interceptors" target="_blank" rel="noopener noreferrer">GitHub 示例代码 10.x版本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 📜
<a href="https://stackblitz.com/github/" target="_blank" rel="noopener noreferrer">StackBlitz 线上运行<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 🏃</p></li> <li><p>8.x 版本，作者版本
<a href="https://github.com/melcor76/interceptors" target="_blank" rel="noopener noreferrer">GitHub 示例代码 8.x版本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 📜
<a href="https://stackblitz.com/github/melcor76/interceptors" target="_blank" rel="noopener noreferrer">StackBlitz 线上运行<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 🏃</p></li></ul> <p>感谢 Angular In Depth 提供想法和帮助编辑文档。希望我没有忘记任何一个人，谢谢 <a href="https://medium.com/u/bd29063a4857?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">Max Koretskyi aka Wizard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://medium.com/u/802a7996f6b6?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">Tim Deschryver<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://medium.com/u/f7828ad40c7c?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">Alex Okrushko<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://medium.com/u/ae97ac398bf9?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">Alexander Poshtaruk<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://medium.com/u/f0e7507974eb?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">Lars Gyrup Brink Nielsen<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://medium.com/u/e0ccd74b3326?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">Nacho Vazquez Calleja<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://medium.com/u/73c42fbc4665?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">thekiba<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> &amp; <a href="https://medium.com/u/d59a9e801370?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">Alexey Zuev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>!</p> <h2 id="资源"><a href="#资源" class="header-anchor">#</a> 资源</h2> <ul><li><p><a href="https://medium.com/angular-in-depth/insiders-guide-into-interceptors-and-httpclient-mechanics-in-angular-103fbdb397bf" target="_blank" rel="noopener noreferrer">Angular 拦截器内部指南和 HttpClient 机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> by <a href="https://medium.com/u/bd29063a4857?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">Max Koretskyi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://medium.com/u/bd29063a4857?source=post_page-----db450f8a62d6--------------------------------" target="_blank" rel="noopener noreferrer">aka Wizard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://angular.io/guide/http#intercepting-requests-and-responses" target="_blank" rel="noopener noreferrer">Angular 文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>许多其他好文章中的点点滴滴</p></li></ul> <h2 id="译者参考"><a href="#译者参考" class="header-anchor">#</a> 译者参考</h2> <ul><li><a href="https://www.ruanyifeng.com/blog/2007/06/camelcase.html" target="_blank" rel="noopener noreferrer">驼峰拼写法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0" target="_blank" rel="noopener noreferrer">XSRF/CSRF<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="感谢阅读"><a href="#感谢阅读" class="header-anchor">#</a> 感谢阅读</h2> <p>感谢你阅读到这里，翻译的不好的地方，还请指点。希望我的内容能让你受用，再次感谢。<a href="https://llccing.github.io/FrontEnd/" target="_blank" rel="noopener noreferrer">by llccing 千里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2025-01-03 16:11:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/FrontEnd/blog/translate/" class="prev router-link-active">
        开篇
      </a></span> <span class="next"><a href="/FrontEnd/blog/translate/what-you-need-know-about-Vue-3-in-2020.html">
        2020年关于 Vue 3 你需要知道的事
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/FrontEnd/assets/js/app.563b61d9.js" defer></script><script src="/FrontEnd/assets/js/2.8adb25ba.js" defer></script><script src="/FrontEnd/assets/js/1.2b7865a3.js" defer></script><script src="/FrontEnd/assets/js/158.09162440.js" defer></script>
  </body>
</html>
